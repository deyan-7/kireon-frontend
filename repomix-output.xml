This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    build-check.yml
messages/
  de.json
  en.json
  es.json
  it.json
  ro.json
public/
  assets/
    images/
      agent-logo.svg
      ava_logo.svg
      deyan7_logo.svg
      icon_paperplane.svg
      logo.svg
  images/
    icon_ai-agent-masterclass.svg
    icon_bilderquiz.svg
    icon_coding_challenge.svg
    icon_evaluate_all.svg
    icon_generative_ai.svg
src/
  app/
    [locale]/
      (main)/
        conversation/
          [...conversationId]/
            layout.tsx
            page.tsx
        customer/
          page.tsx
        laws/
          acronyms/
            page.tsx
          rahmengesetze/
            page.tsx
          reports/
            page.tsx
          layout.tsx
          page.tsx
        layout.tsx
      signin/
        layout.tsx
        page.tsx
      layout.tsx
      page.tsx
  client/
    client.gen.ts
    index.ts
    sdk.gen.ts
    types.gen.ts
  components/
    customer/
      CustomerDetails.module.scss
      CustomerDetails.tsx
      CustomerList.module.scss
      CustomerList.tsx
      CustomerReportView.module.scss
      CustomerReportView.tsx
      CustomerView.module.scss
      CustomerView.tsx
    laws/
      BereicheSidebar.module.scss
      BereicheSidebar.tsx
      CreateDokumentModal.module.scss
      CreateDokumentModal.tsx
      DokumentPreviewTable.module.scss
      DokumentPreviewTable.tsx
      DokumentSummaryDialog.module.scss
      DokumentSummaryDialog.tsx
      GeneralLawDetailDialog.module.scss
      GeneralLawDetailDialog.tsx
      GeneralLawTable.module.scss
      GeneralLawTable.tsx
      LawAcronymsView.tsx
      LawMonitorChatPanel.tsx
      LawsDashboard.tsx
      PflichtDetailDialog.module.scss
      PflichtDetailDialog.tsx
      PflichtEditDialog.module.scss
      PflichtEditDialog.tsx
    shared/
      DetailPanel.module.scss
      DetailPanel.tsx
      RightSidebar.module.scss
      RightSidebar.tsx
      SearchableTagSelector.tsx
    ui/
      alert.tsx
      badge.tsx
      button.tsx
      card.tsx
      command.tsx
      dialog.tsx
      input.tsx
      label.tsx
      popover.tsx
      scroll-area.tsx
      select.tsx
      table.tsx
      tabs.tsx
      textarea.tsx
    ArtifactActionButton.module.scss
    ArtifactActionButton.tsx
    ArtifactEditor.module.scss
    ArtifactEditor.tsx
    ArtifactEval.tsx
    ArtifactForm.tsx
    ArtifactHeader.module.scss
    ArtifactHeader.tsx
    ArtifactLoading.module.scss
    ArtifactLoading.tsx
    ArtifactMarkdown.tsx
    ArtifactTaskInstruction.tsx
    ArtifactTimeline.module.scss
    ArtifactTimeline.tsx
    ArtifactView.module.scss
    ArtifactView.tsx
    BereicheSidebar.module.scss
    BereicheSidebar.tsx
    ChatMessage.module.scss
    ChatMessage.tsx
    CollapsibleSection.module.scss
    CollapsibleSection.tsx
    ConversationChat.module.scss
    ConversationChat.tsx
    Dashboard.module.scss
    Dashboard.tsx
    LawDetailDialog.module.scss
    LawDetailDialog.tsx
    LawsSplitView.module.scss
    LawsSplitView.tsx
    LawsTable.module.scss
    LawsTable.tsx
    LegalLinks.tsx
    Protected.tsx
    ResizableSplitView.module.scss
    ResizableSplitView.tsx
    ScrollDownButton.module.scss
    ScrollDownButton.tsx
    SendMessageInput.tsx
    Sidebar.module.scss
    Sidebar.tsx
    SignIn.module.scss
    SignIn.tsx
    SplitView.module.scss
    SplitView.tsx
    TagDisplay.module.scss
    TagDisplay.tsx
    TextInput.module.scss
    TextInput.tsx
  context/
    AgentStreamProvider.tsx
    AuthContext.tsx
    TaskContext.tsx
  domain/
    artifact.ts
    constants.ts
    conversation.ts
    custom-highlight.ts
    custom-keymaping.ts
    custom-math-block.ts
    custom-tab-extension.ts
    customer.ts
    markdown-service.ts
    persistent-code-block.ts
  i18n/
    navigation.ts
    request.ts
    routing.ts
  lib/
    hooks/
      useAgentStream.ts
      useAuthGuard.ts
      useCustomerData.ts
      useDokumentPreviews.ts
      useLaws.ts
      useLocale.ts
      useNormalizedParam.ts
    services/
      dokument-feedback-service.ts
      laws-service.ts
      pflicht-service.ts
    api.ts
    auth.ts
    utils.ts
  stores/
    rightPanelStore.ts
  styles/
    custom.scss
    globals.css
  types/
    counties.ts
    generic.ts
    laws.ts
    pflicht-preview.ts
    pflicht.ts
  utils/
    asset.tsx
  config.ts
  middleware.ts
.dockerignore
.env.example
.env.local
.gitignore
components.json
docker-compose.yaml
Dockerfile
eslint.config.mjs
next.config.ts
openapi-ts.config.ts
package.json
postcss.config.mjs
README.md
Taskfile.yml
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/components/laws/LawMonitorChatPanel.tsx">
"use client";

import { useEffect, useRef, useMemo } from "react";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";
import { useRightPanelStore } from "@/stores/rightPanelStore";
import { useAuth } from "@/context/AuthContext";
import ChatMessage from "@/components/ChatMessage";
import TextInput from "@/components/TextInput";
import { Role } from "@/domain/constants";
import { formatMarkdownHtml } from "@/domain/markdown-service";

const LawMonitorChatPanel = () => {
  const { chatMessages, isStreaming, sendMessage } = useAgentStreamContext();
  const { context } = useRightPanelStore();
  const { user } = useAuth();
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const threadId = useMemo(() => {
    if (!context) return "global";
    if (context.pflichtId) return `pflicht-${context.pflichtId}`;
    if (context.documentId) return `doc-${context.documentId}`;
    return "global";
  }, [context]);

  const handleSendMessage = async (message: string) => {
    if (!user || !context || !message?.trim()) return;
    const token = await user.getIdToken();
    const agentConfig = {
      pflicht_id: context.pflichtId,
      document_id: context.documentId,
    };

    console.log("agentConfig", agentConfig);
    await sendMessage(
      {
        thread_id: threadId,
        user_id: user.uid,
        message,
        agent_id: "law-monitor-agent",
        stream_tokens: true,
        agent_config: agentConfig,
      },
      token
    );
  };

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [chatMessages, isStreaming]);

  return (
    <div style={{ display: "flex", flexDirection: "column", height: "100%" }}>
      <div style={{ flex: 1, overflowY: "auto", padding: "1rem" }}>
        {chatMessages.map((msg, index) => (
          <ChatMessage
            key={msg.id || `msg-${index}`}
            role={(msg.role as Role) ?? Role.AI}
            isStartScreen={false}
            isLoadingArtifact={false}
          >
            <div
              className="markdown-chat"
              dangerouslySetInnerHTML={{
                __html: formatMarkdownHtml(msg.content ?? ""),
              }}
            />
          </ChatMessage>
        ))}
        {isStreaming && chatMessages[chatMessages.length - 1]?.role !== "ai" && (
          <ChatMessage role={Role.AI} isStartScreen={false} isLoadingArtifact={false} />
        )}
        <div ref={messagesEndRef} />
      </div>
      <div style={{ padding: "1rem", borderTop: "1px solid #e5e7eb" }}>
        <TextInput inputEnabled={!isStreaming} onSubmit={handleSendMessage} />
      </div>
    </div>
  );
};

export default LawMonitorChatPanel;
</file>

<file path="src/components/shared/DetailPanel.module.scss">
@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.panelOverlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.1);
  z-index: 40;
  display: flex;
  justify-content: flex-end;
}

.panel {
  width: 100%;
  max-width: 900px;
  height: 100%;
  background-color: #fff;
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  animation: slideInFromRight 0.3s ease-out;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  flex-shrink: 0;
}

.title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin: 0;
}

.closeButton {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.2s;
}

.closeButton:hover {
  background-color: #f3f4f6;
}

.closeIcon {
  width: 1.5rem;
  height: 1.5rem;
  color: #6b7280;
}

.content {
  padding: 1.5rem;
  overflow-y: auto;
  flex-grow: 1;
}
</file>

<file path="src/components/shared/DetailPanel.tsx">
"use client";

import React from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import styles from './DetailPanel.module.scss';

interface DetailPanelProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

const DetailPanel: React.FC<DetailPanelProps> = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;

  return (
    <div className={styles.panelOverlay}>
      <div className={styles.panel}>
        <div className={styles.header}>
          <h2 className={styles.title}>{title}</h2>
          <button className={styles.closeButton} onClick={onClose} aria-label="Schließen">
            <XMarkIcon className={styles.closeIcon} />
          </button>
        </div>
        <div className={styles.content}>{children}</div>
      </div>
    </div>
  );
};

export default DetailPanel;
</file>

<file path="src/components/ResizableSplitView.module.scss">
.splitViewContainer {
  display: flex;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.mainPanel {
  flex-grow: 1;
  height: 100%;
  overflow-y: auto;
  transition: width 0.2s ease-in-out;
}

.dragger {
  width: 5px;
  background-color: #e5e7eb; // border-gray-200
  cursor: col-resize;
  flex-shrink: 0;
  height: 100%;

  &:hover {
    background-color: #3b82f6; // blue-500
  }
}

.sidePanel {
  flex-shrink: 0;
  height: 100%;
  background-color: white;
  border-left: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidePanelHeader {
  display: flex;
  justify-content: flex-end;
  padding: 0.5rem;
  border-bottom: 1px solid #e5e7eb;
  flex-shrink: 0;
}

.closeButton {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.2s;
  
  &:hover {
    background-color: #f3f4f6; // gray-100
  }
}

.closeIcon {
  width: 1.25rem;
  height: 1.25rem;
  color: #6b7280; // gray-500
}

.sidePanelContent {
  flex-grow: 1;
  overflow-y: auto;
  height: 100%;
}
</file>

<file path="src/components/ResizableSplitView.tsx">
"use client";

import React, { useState, useRef, useEffect, useCallback } from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import styles from './ResizableSplitView.module.scss';

interface ResizableSplitViewProps {
  mainContent: React.ReactNode;
  sidePanelContent: React.ReactNode;
  isSidePanelOpen: boolean;
  onSidePanelClose: () => void;
  initialSidePanelWidth?: number;
  minSidePanelWidth?: number;
}

const ResizableSplitView: React.FC<ResizableSplitViewProps> = ({
  mainContent,
  sidePanelContent,
  isSidePanelOpen,
  onSidePanelClose,
  initialSidePanelWidth = 400,
  minSidePanelWidth = 300,
}) => {
  const [panelWidth, setPanelWidth] = useState(initialSidePanelWidth);
  const isResizing = useRef(false);

  const handleMouseMove = useCallback((e: MouseEvent) => {
    if (!isResizing.current) return;
    const newWidth = window.innerWidth - e.clientX;
    if (newWidth >= minSidePanelWidth) {
      setPanelWidth(newWidth);
    }
  }, [minSidePanelWidth]);

  const handleMouseUp = useCallback(() => {
    isResizing.current = false;
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mouseup', handleMouseUp);
  }, [handleMouseMove]);

  const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {
    e.preventDefault();
    isResizing.current = true;
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
  };

  useEffect(() => {
    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };
  }, [handleMouseMove, handleMouseUp]);

  return (
    <div className={styles.splitViewContainer}>
      <div
        className={styles.mainPanel}
        style={{ width: isSidePanelOpen ? `calc(100% - ${panelWidth}px - 5px)` : '100%' }}
      >
        {mainContent}
      </div>
      {isSidePanelOpen && (
        <>
          <div
            className={styles.dragger}
            onMouseDown={handleMouseDown}
          />
          <div className={styles.sidePanel} style={{ width: `${panelWidth}px` }}>
            <div className={styles.sidePanelHeader}>
              <button onClick={onSidePanelClose} className={styles.closeButton}>
                <XMarkIcon className={styles.closeIcon} />
              </button>
            </div>
            <div className={styles.sidePanelContent}>
              {sidePanelContent}
            </div>
          </div>
        </>
      )}
    </div>
  );
};

export default ResizableSplitView;
</file>

<file path="src/stores/rightPanelStore.ts">
import { create } from 'zustand';

interface ChatContext {
  documentId?: string;
  pflichtId?: number;
}

interface RightPanelState {
  isOpen: boolean;
  context: ChatContext | null;
  openPanel: (context: ChatContext) => void;
  closePanel: () => void;
}

export const useRightPanelStore = create<RightPanelState>((set) => ({
  isOpen: false,
  context: null,
  openPanel: (context) => set({ isOpen: true, context }),
  closePanel: () => set({ isOpen: false, context: null }),
}));
</file>

<file path=".github/workflows/build-check.yml">
name: Build Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'yarn'
        
    - name: Install dependencies
      run: yarn install --frozen-lockfile
      
    - name: Check for missing packages
      run: |
        echo "Checking for missing packages..."
        yarn check --verify-tree || (echo "Missing packages detected. Run 'yarn install' to fix." && exit 1)
        
    - name: Run ESLint
      run: yarn lint
      
    - name: Run TypeScript type checking
      run: npx tsc --noEmit
      
    - name: Build project
      run: yarn build
      
    - name: Build check completed successfully
      run: echo "✅ All checks passed! yarn build would complete without errors."
</file>

<file path="messages/es.json">
{
  "start_session_button": "Iniciar sesión",
  "start_guest_message": "Tómate 10 minutos para completar cuidadosamente las tareas.",
  "start_guest_button": "Comenzar prueba",
  "impressum": "Aviso legal",
  "privacy_policy": "Política de privacidad",
  "input_placeholder": "Enviar un mensaje...",
  "llm_disclaimer": "Esta es una prueba dinámica impulsada por un LLM. Recuerda que los LLM pueden cometer errores.",
  "llm_disclaimer_short": "Remember LLMs can make mistakes.",
  "email_placeholder": "user@example.com",
  "sign_in_error": "Error al iniciar sesión.",
  "show_password": "Mostrar contraseña",
  "hide_password": "Ocultar contraseña",
  "password_placeholder": "Password",
  "sign_in_button": "Sign in"
}
</file>

<file path="messages/it.json">
{
  "start_session_button": "Avvia sessione",
  "start_guest_message": "Prenditi 10 minuti per completare attentamente i compiti.",
  "start_guest_button": "Inizia il test",
  "impressum": "Note legali",
  "privacy_policy": "Informativa sulla privacy",
  "input_placeholder": "Invia un messaggio...",
  "llm_disclaimer": "Questo è un test dinamico alimentato da un LLM. Ricorda che gli LLM possono commettere errori.",
  "llm_disclaimer_short": "Remember LLMs can make mistakes.",
  "email_placeholder": "user@example.com",
  "sign_in_error": "Errore di accesso.",
  "show_password": "Mostra password",
  "hide_password": "Nascondere la password",
  "password_placeholder": "Password",
  "sign_in_button": "Sign in"
}
</file>

<file path="messages/ro.json">
{
  "start_session_button": "Începe sesiunea",
  "start_guest_message": "Ia-ți 10 minute pentru a finaliza cu atenție sarcinile.",
  "start_guest_button": "Începe testul",
  "impressum": "Imprint",
  "privacy_policy": "Politica de confidențialitate",
  "input_placeholder": "Trimite un mesaj...",
  "llm_disclaimer": "Acesta este un test dinamic bazat pe un LLM. Reține că LLM-urile pot greși.",
  "llm_disclaimer_short": "Remember LLMs can make mistakes.",
  "email_placeholder": "user@example.com",
  "sign_in_error": "Eroare la autentificare.",
  "show_password": "Arata parola",
  "hide_password": "Ascunde parola",
  "password_placeholder": "Parola",
  "sign_in_button": "Sign in"
}
</file>

<file path="public/assets/images/agent-logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" id="ai-brain" viewBox="0 0 64 64">
  <path d="m59.49,37.59l-5.01-7.3c-.08-5.59-2.42-10.95-6.44-14.77-4.05-3.84-9.33-5.79-14.87-5.5-10.53.56-18.94,9.41-19.16,20.15-.12,5.76,2.15,11.29,6.24,15.28l-2.11,6.14c-.83,2.42-.44,5.1,1.04,7.17,1.46,2.05,3.73,3.23,6.23,3.23h10.16c3.08,0,5.76-2.12,6.51-5.17l.62-2.52,3.03.56c1.91.35,3.87-.16,5.38-1.41,1.54-1.28,2.43-3.18,2.43-5.2v-5.11l4.33-1.1c.9-.23,1.64-.89,1.97-1.77.34-.89.22-1.89-.32-2.68Z" style="fill:#3df2e1"></path>
  <g>
    <path d="M27 2c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1V3c0-.55-.45-1-1-1ZM21 2c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1V3c0-.55-.45-1-1-1ZM15 2c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1V3c0-.55-.45-1-1-1ZM27 29c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1v-5c0-.55-.45-1-1-1ZM21 29c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1v-5c0-.55-.45-1-1-1ZM15 29c-.55 0-1 .45-1 1v5c0 .55.45 1 1 1s1-.45 1-1v-5c0-.55-.45-1-1-1ZM37 24h-5c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1ZM37 18h-5c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1ZM32 14h5c.55 0 1-.45 1-1s-.45-1-1-1h-5c-.55 0-1 .45-1 1s.45 1 1 1ZM10 24h-5c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1ZM10 18h-5c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1ZM10 12h-5c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1Z" style="fill:#085a8c"></path>
  </g>
  <rect width="24" height="24" x="9" y="7" rx="1" ry="1" style="fill:#0fb2f3"></rect>
  <g>
    <path d="M18.93 13.63c-.15-.38-.52-.63-.93-.63s-.78.25-.93.63l-4 10c-.21.51.04 1.09.56 1.3.52.21 1.09-.04 1.3-.56l.96-2.39s.07.02.11.02h4s.07-.02.11-.02l.96 2.39c.16.39.53.63.93.63.12 0 .25-.02.37-.07.51-.21.76-.79.56-1.3l-4-10Zm-2.25 6.37 1.32-3.31 1.32 3.31h-2.65ZM28 23h-.5v-8h.5c.55 0 1-.45 1-1s-.45-1-1-1h-3c-.55 0-1 .45-1 1s.45 1 1 1h.5v8h-.5c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1Z" style="fill:#fff"></path>
  </g>
  <path d="M42.18 44.03c-5.95 5.71-7.64 14.87-8.06 17.97h-2.02c.37-3.09 2.05-13.03 8.7-19.41.4-.38 1.03-.37 1.41.03.38.4.37 1.03-.03 1.41ZM26.54 62h-1.14c-.34 0-.68-.02-1.01-.07.93-2.08 3.72-9.08 2.94-15.85-.07-.54.33-1.04.87-1.1.56-.07 1.05.33 1.11.87.78 6.66-1.57 13.29-2.77 16.15Z" style="fill:#fff"></path>
  <g>
    <circle cx="43" cy="42" r="3" style="fill:#0fb2f3"></circle>
    <circle cx="28" cy="44" r="3" style="fill:#0fb2f3"></circle>
  </g>
</svg>
</file>

<file path="public/assets/images/ava_logo.svg">
<svg width="26" height="10" viewBox="0 0 26 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_130_346)">
<path d="M20.9247 2.30811L18.9797 6.63038H22.8332L20.9247 2.30811ZM24.3677 10L23.4547 7.94774H18.3909L17.4682 10H15.8417L20.309 0H21.5289L25.9981 10H24.36H24.3658H24.3677Z" fill="#FE5000"/>
<path d="M5.08491 2.30811L3.13995 6.63038H6.99343L5.08491 2.30811ZM8.526 10L7.61298 7.94774H2.55109L1.62848 10H0L4.4692 0H5.68912L10.1583 10H8.52025H8.526Z" fill="#FE5000"/>
<path d="M16.6626 0H18.2892L13.82 10H12.1934L16.6626 0Z" fill="#FE5000"/>
<path d="M13.8066 10H12.18L7.70889 0H9.33545L13.8046 10H13.8066Z" fill="#FE5000"/>
</g>
<defs>
<clipPath id="clip0_130_346">
<rect width="26" height="10" fill="white"/>
</clipPath>
</defs>
</svg>
</file>

<file path="public/assets/images/deyan7_logo.svg">
<svg width="93" height="26" viewBox="0 0 93 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_127_252)">
<mask id="mask0_127_252" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="93" height="26">
<path d="M93 0H0V26H93V0Z" fill="white"/>
</mask>
<g mask="url(#mask0_127_252)">
<path d="M82.9166 5.65527V7.9174H90.7577L83.1538 25.9999H85.3961L93 7.9174V5.65527H82.9166Z" fill="#E44200"/>
<path d="M13.4612 13.0434L13.4469 23.7378H5.60583V25.9999H15.6892V5.65527H13.4469L13.4612 13.0434Z" fill="#E44200"/>
<path d="M10.0905 15.8276H5.60583V20.3519H10.0905V15.8276Z" fill="#E44200"/>
<path d="M7.84104 0V10.1723L0 10.1578V20.3447H2.24235V12.4345H10.0834V2.26213H15.6893V0H7.84822H7.84104Z" fill="#E44200"/>
<path d="M78.4319 20.3446L71.7121 9.80976V20.3446H69.4697V5.65527H71.7121L78.4319 16.1901L78.4176 5.65527H80.6743V20.3519H78.4319V20.3446Z" fill="white"/>
<path d="M60.7951 9.04127L58.1143 15.3926H63.4255L60.7951 9.04127ZM65.5385 20.3447L64.2808 17.3285H57.3022L56.0301 20.3447H53.7877L59.947 5.64807H61.6288L67.788 20.3447H65.5313H65.5385Z" fill="white"/>
<path d="M50.9847 20.3447H48.7424L50.9416 15.1026L46.5 5.64807H48.7424L52.0628 12.4272L54.9016 5.64807H57.144L50.9847 20.3447Z" fill="white"/>
<path d="M35.2955 20.3446V5.65527H44.804V7.69989H37.5379V11.9921H43.6972V14.015H37.5379V18.3073H44.804V20.3519H35.2955V20.3446Z" fill="white"/>
<path d="M30.0059 8.7077C29.3806 8.01166 28.5397 7.69989 27.476 7.69989H24.6659V18.3073H27.476C28.5397 18.3073 29.3806 17.9882 30.0059 17.2994C30.7821 16.4366 30.7964 14.9721 30.7964 12.9057C30.7964 10.8393 30.7749 9.585 30.0059 8.7222M31.5511 18.938C30.6096 19.8878 29.2512 20.3519 27.706 20.3519H22.4092V5.65527H27.706C29.2512 5.65527 30.6096 6.1193 31.5511 7.0691C33.161 8.6932 33.0532 10.7306 33.0532 12.8984C33.0532 15.0663 33.161 17.3139 31.5511 18.938Z" fill="white"/>
</g>
</g>
<defs>
<clipPath id="clip0_127_252">
<rect width="93" height="26" fill="white"/>
</clipPath>
</defs>
</svg>
</file>

<file path="public/assets/images/icon_paperplane.svg">
<svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.19808 1.53397L18.5001 9.49997L2.19808 17.466C2.10503 17.5017 2.00345 17.509 1.90623 17.487C1.80902 17.4649 1.72056 17.4144 1.65208 17.342C1.5816 17.2676 1.53308 17.1752 1.51189 17.0749C1.49071 16.9747 1.4977 16.8705 1.53208 16.774L4.00008 9.49997L1.53208 2.22597C1.4977 2.12944 1.49071 2.02528 1.51189 1.92503C1.53308 1.82478 1.5816 1.73234 1.65208 1.65797C1.72056 1.58552 1.80902 1.53506 1.90623 1.51298C2.00345 1.4909 2.10503 1.49821 2.19808 1.53397Z" stroke="#58D8FF" stroke-width="1.5" stroke-linecap="round"/>
<path d="M4.00009 9.5H18.5001" stroke="#58D8FF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</file>

<file path="public/assets/images/logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96" id="ai-brain">
  <g>
    <g>
      <path fill="#40e0d0" d="M48,24.37V35H39a4,4,0,0,0-4,4V57a4,4,0,0,0,4,4h9V71.63A12.22,12.22,0,0,1,24.8,77a11.81,11.81,0,0,1-2.87.34,12.09,12.09,0,0,1-4.89-1A12.22,12.22,0,0,1,9.7,65.11,12.51,12.51,0,0,1,10,62.57,12.22,12.22,0,0,1,12.6,40.41,12.21,12.21,0,0,1,21.93,20.3a11.92,11.92,0,0,1,2.25.21A12.22,12.22,0,0,1,48,24.37Z"></path>
      <path fill="#fff" d="M34.83,81.69a12.11,12.11,0,0,1-4-4.7,11.81,11.81,0,0,1-2.87.34,12.09,12.09,0,0,1-4.89-1,12.22,12.22,0,0,1-7.34-11.2,12.51,12.51,0,0,1,.26-2.54,12.22,12.22,0,0,1,2.64-22.16A12.21,12.21,0,0,1,27.91,20.3a11.92,11.92,0,0,1,2.25.21,12.24,12.24,0,0,1,8.58-8,12.07,12.07,0,0,0-3-.38,12.23,12.23,0,0,0-11.6,8.36,11.92,11.92,0,0,0-2.25-.21A12.21,12.21,0,0,0,12.6,40.41,12.22,12.22,0,0,0,10,62.57a12.51,12.51,0,0,0-.26,2.54A12.22,12.22,0,0,0,17,76.31a12.09,12.09,0,0,0,4.89,1A11.81,11.81,0,0,0,24.8,77a12.15,12.15,0,0,0,14,6.48A12.14,12.14,0,0,1,34.83,81.69Z" opacity=".4"></path>
      <path fill="#633a82" d="M57,35H39a4,4,0,0,0-4,4V57a4,4,0,0,0,4,4H57a4,4,0,0,0,4-4V39A4,4,0,0,0,57,35ZM51,53.5H45a2,2,0,0,1-2-2v-7a2,2,0,0,1,2-2h6a2,2,0,0,1,2,2v7A2,2,0,0,1,51,53.5Z"></path>
      <rect width="10" height="11" x="43" y="42.5" fill="#f1fcfc" rx="2"></rect>
      <path fill="#40e0d0" d="M86,62.57a12.51,12.51,0,0,1,.26,2.54A12.22,12.22,0,0,1,79,76.31a12.09,12.09,0,0,1-4.89,1A11.81,11.81,0,0,1,71.2,77,12.22,12.22,0,0,1,48,71.63V61h9a4,4,0,0,0,4-4V39a4,4,0,0,0-4-4H48V24.37a12.22,12.22,0,0,1,23.82-3.86,11.92,11.92,0,0,1,2.25-.21A12.21,12.21,0,0,1,83.4,40.41,12.22,12.22,0,0,1,86,62.57Z"></path>
      <path d="M92,52.07a12.21,12.21,0,0,0-8.6-11.66A12.21,12.21,0,0,0,74.07,20.3a11.92,11.92,0,0,0-2.25.21,12.23,12.23,0,0,0-11.6-8.36,11.86,11.86,0,0,0-3,.39,12.24,12.24,0,0,1,8.56,8A11.92,11.92,0,0,1,68,20.3a12.21,12.21,0,0,1,9.33,20.11A12.22,12.22,0,0,1,80,62.57a12.51,12.51,0,0,1,.26,2.54,12.22,12.22,0,0,1-7.34,11.2,12.09,12.09,0,0,1-4.89,1A11.81,11.81,0,0,1,65.16,77a12.22,12.22,0,0,1-7.94,6.47,11.86,11.86,0,0,0,3,.39A12.24,12.24,0,0,0,71.2,77a11.81,11.81,0,0,0,2.87.34,12.09,12.09,0,0,0,4.89-1,12.22,12.22,0,0,0,7.34-11.2A12.51,12.51,0,0,0,86,62.57,12.23,12.23,0,0,0,92,52.07Z" opacity=".2"></path>
      <circle cx="71.16" cy="32.08" r="4.5" fill="#633a82"></circle>
      <circle cx="73.18" cy="63.96" r="4.5" fill="#633a82"></circle>
      <circle cx="16.52" cy="55.5" r="4.5" fill="#633a82"></circle>
      <circle cx="27.92" cy="28.22" r="4.5" fill="#633a82"></circle>
      <path fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M48,71.63A12.22,12.22,0,0,1,24.8,77a11.81,11.81,0,0,1-2.87.34,12.09,12.09,0,0,1-4.89-1A12.22,12.22,0,0,1,9.7,65.11,12.51,12.51,0,0,1,10,62.57,12.22,12.22,0,0,1,12.6,40.41,12.21,12.21,0,0,1,21.93,20.3a11.92,11.92,0,0,1,2.25.21A12.22,12.22,0,0,1,48,24.37"></path>
      <path fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M57,35H39a4,4,0,0,0-4,4V57a4,4,0,0,0,4,4H57a4,4,0,0,0,4-4V39A4,4,0,0,0,57,35ZM51,53.5H45a2,2,0,0,1-2-2v-7a2,2,0,0,1,2-2h6a2,2,0,0,1,2,2v7A2,2,0,0,1,51,53.5Z"></path>
      <rect width="10" height="11" x="43" y="42.5" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" rx="2"></rect>
      <path fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M48 24.37a12.22 12.22 0 0 1 23.82-3.86 11.92 11.92 0 0 1 2.25-.21 12.2 12.2 0 0 1 12 9.8M85.58 69.24A12.26 12.26 0 0 1 79 76.31a12.09 12.09 0 0 1-4.89 1A11.81 11.81 0 0 1 71.2 77 12.22 12.22 0 0 1 48 71.63M88.51 43.53a12.21 12.21 0 0 1-2.47 19 12.51 12.51 0 0 1 .26 2.54 12 12 0 0 1-.72 4.13M86.06 30.1A12.21 12.21 0 0 1 83.4 40.41M73.18 36.1C77.56 42 83.4 40.41 83.4 40.41"></path>
      <circle cx="71.16" cy="32.08" r="4.5" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></circle>
      <circle cx="73.18" cy="63.96" r="4.5" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></circle>
      <circle cx="16.52" cy="55.5" r="4.5" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></circle>
      <circle cx="27.92" cy="28.22" r="4.5" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></circle>
      <line x1="41.43" x2="41.43" y1="29.08" y2="35" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="48" x2="48" y1="29.08" y2="35" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="54.57" x2="54.57" y1="29.08" y2="35" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="61" x2="66.92" y1="53.74" y2="53.74" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="61" x2="66.92" y1="47.17" y2="47.17" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="61" x2="66.92" y1="40.6" y2="40.6" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="29.02" x2="34.94" y1="53.8" y2="53.8" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="29.02" x2="34.94" y1="47.23" y2="47.23" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="29.02" x2="34.94" y1="40.66" y2="40.66" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="41.43" x2="41.43" y1="61" y2="66.92" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="48" x2="48" y1="61" y2="66.92" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <line x1="54.57" x2="54.57" y1="61" y2="66.92" fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"></line>
      <path fill="none" stroke="#192965" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M12.6 40.41s8.86 2.88 5.86 11M25.62 24.36a6.54 6.54 0 0 1-1.44-3.85M24.8 77S22.9 70.66 26 66.34M74.3 68.31c-.1 4.4-3.1 8.68-3.1 8.68M86 62.57s-6.12-1.93-2.64-9.73M24.22 72.65S31.8 77.56 37 70.84M70 79s-4.36-7.7-11.56-2"></path>
    </g>
  </g>
</svg>
</file>

<file path="public/images/icon_ai-agent-masterclass.svg">
<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.5315 12.0659C19.3425 12.0659 20 11.4124 20 10.6063C20 9.80012 19.3425 9.14661 18.5315 9.14661C17.7205 9.14661 17.063 9.80012 17.063 10.6063C17.063 11.4124 17.7205 12.0659 18.5315 12.0659Z" stroke="#FE5000" stroke-miterlimit="10"/>
<path d="M15.9456 10.6062H11.1077" stroke="white" stroke-miterlimit="10"/>
<path d="M11.0473 7.13707H13.0187L14.9397 4.50769" stroke="white" stroke-miterlimit="10"/>
<path d="M11.0473 14.0754H13.0187L14.9397 16.7048" stroke="white" stroke-miterlimit="10"/>
<path d="M16.5199 3.91931C17.3309 3.91931 17.9884 3.2658 17.9884 2.45966C17.9884 1.65351 17.3309 1 16.5199 1C15.7089 1 15.0515 1.65351 15.0515 2.45966C15.0515 3.2658 15.7089 3.91931 16.5199 3.91931Z" stroke="#FE5000" stroke-miterlimit="10"/>
<path d="M16.5199 20.2125C17.3309 20.2125 17.9884 19.559 17.9884 18.7529C17.9884 17.9467 17.3309 17.2932 16.5199 17.2932C15.7089 17.2932 15.0515 17.9467 15.0515 18.7529C15.0515 19.559 15.7089 20.2125 16.5199 20.2125Z" stroke="#FE5000" stroke-miterlimit="10"/>
<path d="M6.47158 14.6054C5.69711 15.1153 5.19421 15.9951 5.19421 16.9849C5.19421 18.5645 6.48164 19.8542 8.08086 19.8542C9.68008 19.8542 10.9675 18.5745 10.9675 16.9849V4.22785C10.9675 2.64822 9.68008 1.35852 8.08086 1.35852C6.48164 1.35852 5.19421 2.63822 5.19421 4.22785C5.19421 5.21762 5.70717 6.09741 6.47158 6.60729" stroke="white" stroke-miterlimit="10" stroke-linecap="square"/>
<path d="M6.23016 11.546C6.23016 10.1064 5.05338 8.94666 3.61508 8.94666C2.17679 8.94666 1 10.1164 1 11.546C1 12.6558 1.694 13.5856 2.66963 13.9655C2.28742 14.3454 2.05609 14.8653 2.05609 15.4451C2.05609 16.6149 3.0116 17.5546 4.17833 17.5546C4.4499 17.5546 4.70135 17.5046 4.94274 17.4147" stroke="white" stroke-linecap="square" stroke-linejoin="round"/>
<path d="M4.90248 3.27808C3.69552 3.27808 2.72995 4.24785 2.72995 5.43757C2.72995 5.81748 2.83053 6.1674 3.00151 6.46733C2.1667 6.72727 1.55316 7.48709 1.55316 8.40687C1.55316 8.77679 1.65374 9.1267 1.83479 9.42663" stroke="white" stroke-linecap="square" stroke-linejoin="round"/>
</svg>
</file>

<file path="public/images/icon_bilderquiz.svg">
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.89286 17.7143H3.78571C3.0469 17.7143 2.33834 17.4208 1.81592 16.8984C1.29349 16.3759 1 15.6674 1 14.9286V3.78571C1 3.0469 1.29349 2.33834 1.81592 1.81592C2.33834 1.29349 3.0469 1 3.78571 1H14.9286C15.6674 1 16.3759 1.29349 16.8984 1.81592C17.4208 2.33834 17.7143 3.0469 17.7143 3.78571V8.89286" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M11.9286 14.8213C11.9286 15.5886 12.2334 16.3244 12.7759 16.8669C13.3184 17.4094 14.0542 17.7142 14.8214 17.7142C15.5887 17.7142 16.3245 17.4094 16.867 16.8669C17.4095 16.3244 17.7143 15.5886 17.7143 14.8213C17.7143 14.0541 17.4095 13.3183 16.867 12.7758C16.3245 12.2332 15.5887 11.9285 14.8214 11.9285C14.0542 11.9285 13.3184 12.2332 12.7759 12.7758C12.2334 13.3183 11.9286 14.0541 11.9286 14.8213Z" stroke="#FE5000" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M17.0714 17.0715L19 19.0001" stroke="#FE5000" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M1 12.5713L5.5 8.03598C6.3352 7.22596 7.3648 7.22596 8.2 8.03598L10 9.85012" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</file>

<file path="public/images/icon_coding_challenge.svg">
<svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.94115 12.2941H1.94117C1.69156 12.2941 1.45217 12.1949 1.27566 12.0184C1.09916 11.8419 1 11.6025 1 11.3529V1.94117C1 1.69156 1.09916 1.45217 1.27566 1.27566C1.45217 1.09916 1.69156 1 1.94117 1H17C17.2496 1 17.489 1.09916 17.6655 1.27566C17.842 1.45217 17.9411 1.69156 17.9411 1.94117V9.47057" stroke="white" stroke-linecap="square" stroke-linejoin="round"/>
<path d="M4.76477 16.0588H8.52947" stroke="white" stroke-linecap="square" stroke-linejoin="round"/>
<path d="M6.64691 12.2939V16.0586" stroke="white" stroke-linecap="square" stroke-linejoin="round"/>
<path d="M16.9999 17L18.8823 15.1177L16.9999 13.2354" stroke="#FE5000" stroke-linecap="square" stroke-linejoin="round"/>
<path d="M14.1767 13.2354L12.2943 15.1177L14.1767 17" stroke="#FE5000" stroke-linecap="square" stroke-linejoin="round"/>
</svg>
</file>

<file path="public/images/icon_evaluate_all.svg">
<svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M10 1V5C10 5.26522 10.1054 5.51957 10.2929 5.70711C10.4804 5.89464 10.7348 6 11 6H15" stroke="white" stroke-linecap="round"/>
  <path d="M8 19H3C2.46957 19 1.96086 18.7893 1.58579 18.4142C1.21071 18.0391 1 17.5304 1 17V3C1 2.46957 1.21071 1.96086 1.58579 1.58579C1.96086 1.21071 2.46957 1 3 1H10L15 6V9.5" stroke="white" stroke-linecap="square"/>
  <line x1="5" y1="14" x2="5" y2="9" stroke="white" stroke-linecap="round"/>
  <line x1="9" y1="14" x2="9" y2="7" stroke="white" stroke-linecap="round"/>
  <line x1="13" y1="14" x2="13" y2="11" stroke="white" stroke-linecap="round"/>
  <polyline points="5,12 9,10 13,12" stroke="white" fill="none" stroke-linecap="round"/>
  <path d="M15 20.5C15.2053 19.6513 15.6406 18.8755 16.2581 18.2581C16.8755 17.6406 17.6513 17.2053 18.5 17C17.6513 16.7947 16.8755 16.3594 16.2581 15.7419C15.6406 15.1245 15.2053 14.3487 15 13.5C14.7947 14.3487 14.3594 15.1245 13.7419 15.7419C13.1245 16.3594 12.3487 16.7947 11.5 17C12.3487 17.2053 13.1245 17.6406 13.7419 18.2581C14.3594 18.8755 14.7947 19.6513 15 20.5Z" stroke="#FE5000" stroke-linecap="round"/>
</svg>
</file>

<file path="public/images/icon_generative_ai.svg">
<svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 1V5C10 5.26522 10.1054 5.51957 10.2929 5.70711C10.4804 5.89464 10.7348 6 11 6H15" stroke="white" stroke-linecap="round"/>
<path d="M8 19H3C2.46957 19 1.96086 18.7893 1.58579 18.4142C1.21071 18.0391 1 17.5304 1 17V3C1 2.46957 1.21071 1.96086 1.58579 1.58579C1.96086 1.21071 2.46957 1 3 1H10L15 6V9.5" stroke="white" stroke-linecap="square"/>
<path d="M5 7H6" stroke="white" stroke-linecap="square"/>
<path d="M5 11H11" stroke="white" stroke-linecap="square"/>
<path d="M5 15H8" stroke="white" stroke-linecap="square"/>
<path d="M15 20.5C15.2053 19.6513 15.6406 18.8755 16.2581 18.2581C16.8755 17.6406 17.6513 17.2053 18.5 17C17.6513 16.7947 16.8755 16.3594 16.2581 15.7419C15.6406 15.1245 15.2053 14.3487 15 13.5C14.7947 14.3487 14.3594 15.1245 13.7419 15.7419C13.1245 16.3594 12.3487 16.7947 11.5 17C12.3487 17.2053 13.1245 17.6406 13.7419 18.2581C14.3594 18.8755 14.7947 19.6513 15 20.5Z" stroke="#FE5000" stroke-linecap="round"/>
</svg>
</file>

<file path="src/app/[locale]/(main)/conversation/[...conversationId]/layout.tsx">
import SplitView from "@/components/SplitView";

export default function ChatLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <SplitView>{children}</SplitView>;
}
</file>

<file path="src/app/[locale]/(main)/conversation/[...conversationId]/page.tsx">
"use client";

import ConversationChat from "@/components/ConversationChat";
import Protected from "@/components/Protected";

const ConversationsPage: React.FC = () => {
  return (
    <Protected>
      <ConversationChat />
    </Protected>
  );
};

export default ConversationsPage;
</file>

<file path="src/app/[locale]/(main)/laws/acronyms/page.tsx">
import { LawsDashboard } from '@/components/laws/LawsDashboard';
import { LawAcronymsView } from '@/components/laws/LawAcronymsView';

export default function LawAcronymsPage() {
  return (
    <LawsDashboard>
      <LawAcronymsView />
    </LawsDashboard>
  );
}
</file>

<file path="src/app/[locale]/(main)/laws/rahmengesetze/page.tsx">
"use client";

import { useLaws } from '@/lib/hooks/useLaws';
import GeneralLawTable from '@/components/laws/GeneralLawTable';
import GeneralLawDetailDialog from '@/components/laws/GeneralLawDetailDialog';
import LawsSplitView from '@/components/LawsSplitView';
import BereicheSidebar from '@/components/BereicheSidebar';
import Link from 'next/link';
import { ArrowLeftIcon } from '@heroicons/react/24/outline';

export default function RahmengesetzePage() {
  const {
    bereiche,
    bereichCounts,
    filteredLaws,
    selectedLaw,
    filterText,
    selectedBereich,
    setFilterText,
    selectBereich,
    selectLaw,
    closeDialog,
  } = useLaws();

  const sidebar = (
    <BereicheSidebar
      bereiche={bereiche}
      bereichCounts={bereichCounts}
      selected={selectedBereich}
      onSelect={selectBereich}
    />
  );

  return (
    <div style={{ height: 'calc(100vh - 5rem)', display: 'flex', flexDirection: 'column' }}>
      <LawsSplitView sidebar={sidebar}>
        <div style={{ marginBottom: '1rem' }}>
          <Link 
            href="/laws" 
            style={{ 
              display: 'inline-flex', 
              alignItems: 'center', 
              gap: '0.5rem',
              color: '#3b82f6',
              textDecoration: 'none',
              fontSize: '0.875rem',
              marginBottom: '1rem'
            }}
          >
            <ArrowLeftIcon style={{ width: '1rem', height: '1rem' }} />
            Zurück zur Gesetzesübersicht
          </Link>
        </div>
        
        <h1>Rahmengesetze</h1>
        <p style={{ marginBottom: '2rem', color: '#666' }}>
          {selectedBereich ? `Anzeigen von Rahmengesetzen für: ${selectedBereich.name}` : "Alle Rahmengesetze anzeigen"}
        </p>
        
        <GeneralLawTable
          laws={filteredLaws}
          filterText={filterText}
          onFilterChange={setFilterText}
          onSelectLaw={selectLaw}
        />
      </LawsSplitView>

      {selectedLaw && (
        <GeneralLawDetailDialog
          law={selectedLaw}
          onClose={closeDialog}
        />
      )}
    </div>
  );
}
</file>

<file path="src/app/[locale]/(main)/laws/reports/page.tsx">
import { CustomerReportView } from "@/components/customer/CustomerReportView";

export default function CustomerReportsPage() {
  return <CustomerReportView />;
}
</file>

<file path="src/app/[locale]/(main)/laws/layout.tsx">
import { ReactNode } from 'react';

export default function LawsLayout({
  children,
}: {
  children: ReactNode;
}) {
  return <>{children}</>;
}
</file>

<file path="src/app/[locale]/(main)/layout.tsx">
import Sidebar from "@/components/Sidebar";

export default function MainAppLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div style={{ display: "flex", height: "100vh" }}>
      <Sidebar />
      <main style={{ flex: 1, overflowY: "auto" }}>{children}</main>
    </div>
  );
}
</file>

<file path="src/app/[locale]/signin/layout.tsx">
"use client";
import { useAuthGuard } from "@/lib/hooks/useAuthGuard";
import { ReactNode } from "react";

export default function StartGuestLayout({
  children,
}: {
  children: ReactNode;
}) {
  useAuthGuard();
  return <section>{children}</section>;
}
</file>

<file path="src/app/[locale]/signin/page.tsx">
"use client";

import SignInPage from "@/components/SignIn";

const StartGuestPage: React.FC = () => {
  return <SignInPage />;
};

export default StartGuestPage;
</file>

<file path="src/client/client.gen.ts">
// This file is auto-generated by @hey-api/openapi-ts

import type { ClientOptions } from "./types.gen";
import {
  type Config,
  type ClientOptions as DefaultClientOptions,
  createClient,
  createConfig,
} from "@hey-api/client-fetch";

/**
 * The `createClientConfig()` function will be called on client initialization
 * and the returned object will become the client's initial configuration.
 *
 * You may want to initialize your client this way instead of calling
 * `setConfig()`. This is useful for example if you're using Next.js
 * to ensure your client always has the correct values.
 */
export type CreateClientConfig<T extends DefaultClientOptions = ClientOptions> =
  (
    override?: Config<DefaultClientOptions & T>
  ) => Config<Required<DefaultClientOptions> & T>;

export const client = createClient(
  createConfig<ClientOptions>({
    baseUrl:
      process.env.NEXT_PUBLIC_BACKEND_URL ||
      "https://hiring-agent-backend-staging-474483908861.europe-west3.run.app",
  })
);
</file>

<file path="src/client/index.ts">
// This file is auto-generated by @hey-api/openapi-ts
export * from './types.gen';
export * from './sdk.gen';
</file>

<file path="src/client/sdk.gen.ts">
// This file is auto-generated by @hey-api/openapi-ts

import type { Options as ClientOptions, TDataShape, Client } from '@hey-api/client-fetch';
import type { InfoInfoGetData, InfoInfoGetResponse, InvokeInvokePostData, InvokeInvokePostResponse, InvokeInvokePostError, InvokeAgentIdInvokePostData, InvokeAgentIdInvokePostResponse, InvokeAgentIdInvokePostError, StreamStreamPostData, StreamStreamPostResponse, StreamStreamPostError, StreamAgentIdStreamPostData, StreamAgentIdStreamPostResponse, StreamAgentIdStreamPostError, FeedbackFeedbackPostData, FeedbackFeedbackPostResponse, FeedbackFeedbackPostError, HistoryHistoryPostData, HistoryHistoryPostResponse, HistoryHistoryPostError, HealthCheckHealthGetData, ReadinessReadinessGetData, ReadinessReadinessGetResponse } from './types.gen';
import { client as _heyApiClient } from './client.gen';

export type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {
    /**
     * You can provide a client instance returned by `createClient()` instead of
     * individual options. This might be also useful if you want to implement a
     * custom client.
     */
    client?: Client;
    /**
     * You can pass arbitrary values through the `meta` object. This can be
     * used to access values that aren't defined as part of the SDK function.
     */
    meta?: Record<string, unknown>;
};

/**
 * Info
 */
export const infoInfoGet = <ThrowOnError extends boolean = false>(options?: Options<InfoInfoGetData, ThrowOnError>) => {
    return (options?.client ?? _heyApiClient).get<InfoInfoGetResponse, unknown, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/info',
        ...options
    });
};

/**
 * Invoke
 * Invoke an agent with user input to retrieve a final response.
 *
 * If agent_id is not provided, the default agent will be used.
 * Use thread_id to persist and continue a multi-turn conversation. run_id kwarg
 * is also attached to messages for recording feedback.
 * Use user_id to persist and continue a conversation across multiple threads.
 */
export const invokeInvokePost = <ThrowOnError extends boolean = false>(options: Options<InvokeInvokePostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<InvokeInvokePostResponse, InvokeInvokePostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/invoke',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * Invoke
 * Invoke an agent with user input to retrieve a final response.
 *
 * If agent_id is not provided, the default agent will be used.
 * Use thread_id to persist and continue a multi-turn conversation. run_id kwarg
 * is also attached to messages for recording feedback.
 * Use user_id to persist and continue a conversation across multiple threads.
 */
export const invokeAgentIdInvokePost = <ThrowOnError extends boolean = false>(options: Options<InvokeAgentIdInvokePostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<InvokeAgentIdInvokePostResponse, InvokeAgentIdInvokePostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/{agent_id}/invoke',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * Stream
 * Stream an agent's response to a user input, including intermediate messages and tokens.
 *
 * If agent_id is not provided, the default agent will be used.
 * Use thread_id to persist and continue a multi-turn conversation. run_id kwarg
 * is also attached to all messages for recording feedback.
 * Use user_id to persist and continue a conversation across multiple threads.
 *
 * Set `stream_tokens=false` to return intermediate messages but not token-by-token.
 */
export const streamStreamPost = <ThrowOnError extends boolean = false>(options: Options<StreamStreamPostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<StreamStreamPostResponse, StreamStreamPostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/stream',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * Stream
 * Stream an agent's response to a user input, including intermediate messages and tokens.
 *
 * If agent_id is not provided, the default agent will be used.
 * Use thread_id to persist and continue a multi-turn conversation. run_id kwarg
 * is also attached to all messages for recording feedback.
 * Use user_id to persist and continue a conversation across multiple threads.
 *
 * Set `stream_tokens=false` to return intermediate messages but not token-by-token.
 */
export const streamAgentIdStreamPost = <ThrowOnError extends boolean = false>(options: Options<StreamAgentIdStreamPostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<StreamAgentIdStreamPostResponse, StreamAgentIdStreamPostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/{agent_id}/stream',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * Feedback
 * Record feedback for a run to LangSmith.
 *
 * This is a simple wrapper for the LangSmith create_feedback API, so the
 * credentials can be stored and managed in the service rather than the client.
 * See: https://api.smith.langchain.com/redoc#tag/feedback/operation/create_feedback_api_v1_feedback_post
 */
export const feedbackFeedbackPost = <ThrowOnError extends boolean = false>(options: Options<FeedbackFeedbackPostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<FeedbackFeedbackPostResponse, FeedbackFeedbackPostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/feedback',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * History
 * Get chat history.
 */
export const historyHistoryPost = <ThrowOnError extends boolean = false>(options: Options<HistoryHistoryPostData, ThrowOnError>) => {
    return (options.client ?? _heyApiClient).post<HistoryHistoryPostResponse, HistoryHistoryPostError, ThrowOnError>({
        security: [
            {
                scheme: 'bearer',
                type: 'http'
            }
        ],
        url: '/history',
        ...options,
        headers: {
            'Content-Type': 'application/json',
            ...options?.headers
        }
    });
};

/**
 * Health Check
 * Health check endpoint.
 */
export const healthCheckHealthGet = <ThrowOnError extends boolean = false>(options?: Options<HealthCheckHealthGetData, ThrowOnError>) => {
    return (options?.client ?? _heyApiClient).get<unknown, unknown, ThrowOnError>({
        url: '/health',
        ...options
    });
};

/**
 * Readiness
 * Readiness check endpoint.
 */
export const readinessReadinessGet = <ThrowOnError extends boolean = false>(options?: Options<ReadinessReadinessGetData, ThrowOnError>) => {
    return (options?.client ?? _heyApiClient).get<ReadinessReadinessGetResponse, unknown, ThrowOnError>({
        url: '/readiness',
        ...options
    });
};
</file>

<file path="src/client/types.gen.ts">
// This file is auto-generated by @hey-api/openapi-ts

/**
 * https://docs.aws.amazon.com/bedrock/latest/userguide/models-supported.html
 */
export type AwsModelName = "bedrock-3.5-haiku" | "bedrock-3.5-sonnet";

/**
 * Info about an available agent.
 */
export type AgentInfo = {
  /**
   * Agent key.
   */
  key: string;
  /**
   * Description of the agent.
   */
  description: string;
};

/**
 * https://docs.anthropic.com/en/docs/about-claude/models#model-names
 */
export type AnthropicModelName =
  | "claude-3-haiku"
  | "claude-3.5-haiku"
  | "claude-3.5-sonnet";

/**
 * Azure OpenAI model names
 */
export type AzureOpenAiModelName = "azure-gpt-4o" | "azure-gpt-4o-mini";

export type ChatHistory = {
  messages: Array<ChatMessage>;
};

/**
 * Input for retrieving chat history.
 */
export type ChatHistoryInput = {
  /**
   * Thread ID to persist and continue a multi-turn conversation.
   */
  thread_id: string;
};

/**
 * Message in a chat.
 */
export type ChatMessage = {
  /**
   * Role of the message.
   */
  type: "human" | "ai" | "tool" | "custom" | "system";
  /**
   * Content of the message.
   */
  content: string;
  /**
   * Tool calls in the message.
   */
  tool_calls?: Array<ToolCall>;
  /**
   * Tool call that this message is responding to.
   */
  tool_call_id?: string | null;
  /**
   * Run ID of the message.
   */
  run_id?: string | null;
  /**
   * Response metadata. For example: response headers, logprobs, token counts.
   */
  response_metadata?: {
    [key: string]: unknown;
  };
  /**
   * Custom message data.
   */
  custom_data?: {
    [key: string]: unknown;
  };
};

/**
 * https://api-docs.deepseek.com/quick_start/pricing
 */
export type DeepseekModelName = "deepseek-chat";

/**
 * Fake model for testing.
 */
export type FakeModelName = "fake";

/**
 * Feedback for a run, to record to LangSmith.
 */
export type Feedback = {
  /**
   * Run ID to record feedback for.
   */
  run_id: string;
  /**
   * Feedback key.
   */
  key: string;
  /**
   * Feedback score.
   */
  score: number;
  /**
   * Additional feedback kwargs, passed to LangSmith.
   */
  kwargs?: {
    [key: string]: unknown;
  };
};

export type FeedbackResponse = {
  status?: "success";
};

/**
 * https://ai.google.dev/gemini-api/docs/models/gemini
 */
export type GoogleModelName = "gemini-1.5-pro" | "gemini-2.0-flash";

/**
 * https://console.groq.com/docs/models
 */
export type GroqModelName =
  | "llama-3.1-8b"
  | "llama-3.3-70b"
  | "meta-llama/llama-guard-4-12b";

export type HttpValidationError = {
  detail?: Array<ValidationError>;
};

/**
 * https://ollama.com/search
 */
export type OllamaModelName = "ollama";

/**
 * https://platform.openai.com/docs/guides/text-generation
 */
export type OpenAiCompatibleName = "openai-compatible";

/**
 * https://platform.openai.com/docs/models/gpt-4o
 */
export type OpenAiModelName = "gpt-4o-mini" | "gpt-4o";

/**
 * Metadata about the service including available agents and models.
 */
export type ServiceMetadata = {
  /**
   * List of available agents.
   */
  agents: Array<AgentInfo>;
  /**
   * List of available LLMs.
   */
  models: Array<
    | OpenAiModelName
    | OpenAiCompatibleName
    | AzureOpenAiModelName
    | DeepseekModelName
    | AnthropicModelName
    | GoogleModelName
    | VertexAiModelName
    | GroqModelName
    | AwsModelName
    | OllamaModelName
    | FakeModelName
  >;
  /**
   * Default agent used when none is specified.
   */
  default_agent: string;
  /**
   * Default model used when none is specified.
   */
  default_model:
    | OpenAiModelName
    | OpenAiCompatibleName
    | AzureOpenAiModelName
    | DeepseekModelName
    | AnthropicModelName
    | GoogleModelName
    | VertexAiModelName
    | GroqModelName
    | AwsModelName
    | OllamaModelName
    | FakeModelName;
};

/**
 * User input for streaming the agent's response.
 */
export type StreamInput = {
  /**
   * User input to the agent.
   */
  message: string;
  /**
   * LLM Model to use for the agent.
   */
  model?:
    | OpenAiModelName
    | OpenAiCompatibleName
    | AzureOpenAiModelName
    | DeepseekModelName
    | AnthropicModelName
    | GoogleModelName
    | VertexAiModelName
    | GroqModelName
    | AwsModelName
    | OllamaModelName
    | FakeModelName
    | null;
  /**
   * Thread ID to persist and continue a multi-turn conversation.
   */
  thread_id?: string | null;
  /**
   * User ID to persist and continue a conversation across multiple threads.
   */
  user_id?: string | null;
  /**
   * Additional configuration to pass through to the agent
   */
  agent_config?: {
    [key: string]: unknown;
  };
  /**
   * Whether to stream LLM tokens to the client.
   */
  stream_tokens?: boolean;
};

/**
 * Represents a request to call a tool.
 */
export type ToolCall = {
  name: string;
  args: {
    [key: string]: unknown;
  };
  id: string | null;
  type?: "tool_call";
};

/**
 * Basic user input for the agent.
 */
export type UserInput = {
  /**
   * User input to the agent.
   */
  message: string;
  /**
   * LLM Model to use for the agent.
   */
  model?:
    | OpenAiModelName
    | OpenAiCompatibleName
    | AzureOpenAiModelName
    | DeepseekModelName
    | AnthropicModelName
    | GoogleModelName
    | VertexAiModelName
    | GroqModelName
    | AwsModelName
    | OllamaModelName
    | FakeModelName
    | null;
  /**
   * Thread ID to persist and continue a multi-turn conversation.
   */
  thread_id?: string | null;
  /**
   * User ID to persist and continue a conversation across multiple threads.
   */
  user_id?: string | null;
  /**
   * Additional configuration to pass through to the agent
   */
  agent_config?: {
    [key: string]: unknown;
  };
};

export type ValidationError = {
  loc: Array<string | number>;
  msg: string;
  type: string;
};

/**
 * https://ai.google.dev/gemini-api/docs/models/gemini
 */
export type VertexAiModelName =
  | "gemini-1.5-pro-002"
  | "gemini-2.0-flash"
  | "models/gemini-2.5-flash-preview-04-17"
  | "gemini-2.5-pro-preview-05-06"
  | "gemini-2.5-pro-exp-03-25";

export type InfoInfoGetData = {
  body?: never;
  path?: never;
  query?: never;
  url: "/info";
};

export type InfoInfoGetResponses = {
  /**
   * Successful Response
   */
  200: ServiceMetadata;
};

export type InfoInfoGetResponse =
  InfoInfoGetResponses[keyof InfoInfoGetResponses];

export type InvokeInvokePostData = {
  body: UserInput;
  path?: never;
  query?: {
    agent_id?: string;
  };
  url: "/invoke";
};

export type InvokeInvokePostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type InvokeInvokePostError =
  InvokeInvokePostErrors[keyof InvokeInvokePostErrors];

export type InvokeInvokePostResponses = {
  /**
   * Successful Response
   */
  200: ChatMessage;
};

export type InvokeInvokePostResponse =
  InvokeInvokePostResponses[keyof InvokeInvokePostResponses];

export type InvokeAgentIdInvokePostData = {
  body: UserInput;
  path: {
    agent_id: string;
  };
  query?: never;
  url: "/{agent_id}/invoke";
};

export type InvokeAgentIdInvokePostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type InvokeAgentIdInvokePostError =
  InvokeAgentIdInvokePostErrors[keyof InvokeAgentIdInvokePostErrors];

export type InvokeAgentIdInvokePostResponses = {
  /**
   * Successful Response
   */
  200: ChatMessage;
};

export type InvokeAgentIdInvokePostResponse =
  InvokeAgentIdInvokePostResponses[keyof InvokeAgentIdInvokePostResponses];

export type StreamStreamPostData = {
  body: StreamInput;
  path?: never;
  query?: {
    agent_id?: string;
  };
  url: "/stream";
};

export type StreamStreamPostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type StreamStreamPostError =
  StreamStreamPostErrors[keyof StreamStreamPostErrors];

export type StreamStreamPostResponses = {
  /**
   * Server Sent Event Response
   */
  200: string;
};

export type StreamStreamPostResponse =
  StreamStreamPostResponses[keyof StreamStreamPostResponses];

export type StreamAgentIdStreamPostData = {
  body: StreamInput;
  path: {
    agent_id: string;
  };
  query?: never;
  url: "/{agent_id}/stream";
};

export type StreamAgentIdStreamPostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type StreamAgentIdStreamPostError =
  StreamAgentIdStreamPostErrors[keyof StreamAgentIdStreamPostErrors];

export type StreamAgentIdStreamPostResponses = {
  /**
   * Server Sent Event Response
   */
  200: string;
};

export type StreamAgentIdStreamPostResponse =
  StreamAgentIdStreamPostResponses[keyof StreamAgentIdStreamPostResponses];

export type FeedbackFeedbackPostData = {
  body: Feedback;
  path?: never;
  query?: never;
  url: "/feedback";
};

export type FeedbackFeedbackPostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type FeedbackFeedbackPostError =
  FeedbackFeedbackPostErrors[keyof FeedbackFeedbackPostErrors];

export type FeedbackFeedbackPostResponses = {
  /**
   * Successful Response
   */
  200: FeedbackResponse;
};

export type FeedbackFeedbackPostResponse =
  FeedbackFeedbackPostResponses[keyof FeedbackFeedbackPostResponses];

export type HistoryHistoryPostData = {
  body: ChatHistoryInput;
  path?: never;
  query?: never;
  url: "/history";
};

export type HistoryHistoryPostErrors = {
  /**
   * Validation Error
   */
  422: HttpValidationError;
};

export type HistoryHistoryPostError =
  HistoryHistoryPostErrors[keyof HistoryHistoryPostErrors];

export type HistoryHistoryPostResponses = {
  /**
   * Successful Response
   */
  200: ChatHistory;
};

export type HistoryHistoryPostResponse =
  HistoryHistoryPostResponses[keyof HistoryHistoryPostResponses];

export type HealthCheckHealthGetData = {
  body?: never;
  path?: never;
  query?: never;
  url: "/health";
};

export type HealthCheckHealthGetResponses = {
  /**
   * Successful Response
   */
  200: unknown;
};

export type ReadinessReadinessGetData = {
  body?: never;
  path?: never;
  query?: never;
  url: "/readiness";
};

export type ReadinessReadinessGetResponses = {
  /**
   * Successful Response
   */
  200: {
    [key: string]: unknown;
  };
};

export type ReadinessReadinessGetResponse =
  ReadinessReadinessGetResponses[keyof ReadinessReadinessGetResponses];

export type ClientOptions = {
  baseUrl:
    | "https://hiring-agent-backend-staging-474483908861.europe-west3.run.app"
    | (string & {});
};
</file>

<file path="src/components/customer/CustomerDetails.module.scss">
.container {
  display: flex;
  flex-direction: column;
  height: 100%;
  background-color: #f8f9fa;
}

.header {
  padding: 1.5rem 2rem;
  background-color: white;
  border-bottom: 1px solid #e0e0e0;
}

.headerContent {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.customerName {
  font-size: 1.75rem;
  font-weight: 600;
  color: #1a1a1a;
  margin-bottom: 0.25rem;
}

.customerAddress {
  font-size: 0.95rem;
  color: #666;
  margin-bottom: 0.25rem;
}

.customerMetadata {
  font-size: 0.875rem;
  color: #999;
}

.logoContainer {
  flex-shrink: 0;
}

.content {
  flex: 1;
  padding: 2rem;
  overflow-y: auto;
  background-color: #f8f9fa;
}

.section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);

  &:last-child {
    margin-bottom: 0;
  }
}
</file>

<file path="src/components/customer/CustomerDetails.tsx">
"use client";

import { Customer, OTHER_TAGS } from "@/domain/customer";
import { SearchableTagSelector } from "@/components/shared/SearchableTagSelector";
import { Stichwort } from "@/types/laws";
import { MarketsAll, CountryName } from "@/types/counties";
import Image from "next/image";
import styles from "./CustomerDetails.module.scss";

interface CustomerDetailsProps {
  customer: Customer;
  onUpdate: (
    customerId: string,
    updates: Partial<
      Pick<Customer, "subscribedLaws" | "subscribedCountries" | "otherTags">
    >
  ) => void;
}

export function CustomerDetails({ customer, onUpdate }: CustomerDetailsProps) {
  // Get all law enum values
  const ALL_LAWS: Stichwort[] = Object.values(Stichwort);

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <div className={styles.headerContent}>
          <div>
            <h1 className={styles.customerName}>{customer.name}</h1>
            <p className={styles.customerAddress}>{customer.address}</p>
            <p className={styles.customerMetadata}>{customer.metadata}</p>
          </div>
          <div className={styles.logoContainer}>
            <Image src="/assets/images/logo.png" alt="Logo" width={60} height={60} priority />
          </div>
        </div>
      </div>

      <div className={styles.content}>
        <div className={styles.section}>
          <SearchableTagSelector
            label="Abonnierte Rahmengesetze"
            options={ALL_LAWS}
            selected={customer.subscribedLaws}
            onChange={(newLaws) =>
              onUpdate(customer.id, { subscribedLaws: newLaws as Stichwort[] })
            }
          />
        </div>

        <div className={styles.section}>
          <SearchableTagSelector
            label="Abonnierte Länder"
            options={MarketsAll}
            optionNames={CountryName}
            selected={customer.subscribedCountries}
            onChange={(newCountries) =>
              onUpdate(customer.id, {
                subscribedCountries: newCountries as typeof MarketsAll[number][],
              })
            }
          />
        </div>

        <div className={styles.section}>
          <SearchableTagSelector
            label="Weitere Tags"
            options={OTHER_TAGS}
            selected={customer.otherTags}
            onChange={(newTags) =>
              onUpdate(customer.id, { otherTags: newTags })
            }
          />
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/customer/CustomerList.module.scss">
.container {
  display: flex;
  flex-direction: column;
  height: 100%;
  background-color: white;
  border-right: 1px solid #e0e0e0;
}

.searchBox {
  padding: 1rem;
  background-color: #fafafa;
  border-bottom: 1px solid #e0e0e0;
}

.searchInput {
  width: 100%;
  padding: 0.625rem 1rem;
  border: 1px solid #d0d0d0;
  border-radius: 6px;
  font-size: 0.875rem;
  background-color: white;
  transition: all 0.2s;

  &:focus {
    outline: none;
    border-color: #4a90e2;
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  }

  &::placeholder {
    color: #999;
  }
}

.customerList {
  flex: 1;
  overflow-y: auto;
  background-color: #fafafa;
}

.customerItem {
  padding: 1rem 1.25rem;
  margin: 0.5rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  background-color: white;
  border: 1px solid transparent;

  &:hover {
    background-color: #f8f9fa;
    transform: translateX(2px);
  }

  &.selected {
    background-color: #e8f2ff;
    border-color: #4a90e2;
    box-shadow: 0 2px 4px rgba(74, 144, 226, 0.15);
  }
}

.customerName {
  font-weight: 600;
  color: #2c2c2c;
  margin-bottom: 0.375rem;
  font-size: 0.95rem;
}

.customerMeta {
  font-size: 0.8125rem;
  color: #777;
  line-height: 1.4;
}
</file>

<file path="src/components/customer/CustomerList.tsx">
"use client";

import { Customer } from "@/domain/customer";
import styles from "./CustomerList.module.scss";

interface CustomerListProps {
  customers: Customer[];
  selectedCustomerId: string | null;
  searchQuery: string;
  onSelectCustomer: (customerId: string) => void;
  onSearchChange: (query: string) => void;
}

export function CustomerList({
  customers,
  selectedCustomerId,
  searchQuery,
  onSelectCustomer,
  onSearchChange,
}: CustomerListProps) {
  return (
    <div className={styles.container}>
      <div className={styles.searchBox}>
        <input
          type="text"
          placeholder="Kunden suchen..."
          value={searchQuery}
          onChange={(e) => onSearchChange(e.target.value)}
          className={styles.searchInput}
        />
      </div>
      <div className={styles.customerList}>
        {customers.map((customer) => (
          <div
            key={customer.id}
            className={`${styles.customerItem} ${
              selectedCustomerId === customer.id ? styles.selected : ""
            }`}
            onClick={() => onSelectCustomer(customer.id)}
          >
            <div className={styles.customerName}>{customer.name}</div>
            <div className={styles.customerMeta}>{customer.metadata}</div>
          </div>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/components/customer/CustomerReportView.module.scss">
.container {
  padding: 2rem;
  max-width: 100%;
  overflow-x: auto;
}

.header {
  margin-bottom: 2rem;
  
  h1 {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #1f2937;
  }
  
  p {
    color: #6b7280;
    font-size: 1rem;
  }
}

.tableContainer {
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  overflow: hidden;
}

.table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.875rem;
  
  thead {
    background-color: #f9fafb;
    
    th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }
  }
  
  tbody {
    tr {
      border-bottom: 1px solid #e5e7eb;
      
      &:hover {
        background-color: #f9fafb;
      }
      
      &:last-child {
        border-bottom: none;
      }
    }
    
    td {
      padding: 1rem;
      vertical-align: top;
      border-bottom: 1px solid #f3f4f6;
    }
  }
}

.customerName {
  font-weight: 600;
  color: #1f2937;
  min-width: 150px;
}

.address {
  color: #6b7280;
  min-width: 200px;
}

.metadata {
  color: #6b7280;
  min-width: 150px;
}

.laws,
.countries,
.otherTags {
  min-width: 200px;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.tag {
  background-color: #e5e7eb;
  color: #374151;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
}

.actions {
  text-align: left;
  width: 180px;
  vertical-align: middle;
  padding-left: 1rem;
}

.icon {
  width: 1rem;
  height: 1rem;
}

// Expandable row styles
.expandCell {
  width: 50px;
  text-align: center;
  padding: 1rem 0.5rem !important;
  vertical-align: middle;
}

.expandButton {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 0.375rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  width: 2rem;
  height: 2rem;
  margin-top: -0.25rem; // Button etwas höher positionieren
  
  &:hover {
    background-color: #f3f4f6;
  }
  
  &:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }
}

.chevronIcon {
  width: 1rem;
  height: 1rem;
  color: #6b7280;
  transition: transform 0.2s;
}

.mainRow {
  cursor: pointer;
  
  &:hover {
    background-color: #f9fafb;
  }
  
  td {
    vertical-align: middle;
  }
}

.detailRow {
  background-color: #f8fafc;
  
  td {
    border-top: none;
    padding: 0;
  }
}

.detailCell {
  padding: 1.5rem !important;
  background-color: #f8fafc;
}

.detailsContainer {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.detailSection {
  h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
}

// Responsive design
@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }
  
  .table {
    font-size: 0.75rem;
    
    th,
    td {
      padding: 0.75rem 0.5rem;
    }
  }
  
  .customerName,
  .address,
  .metadata {
    min-width: 120px;
  }
  
  .laws,
  .countries,
  .otherTags {
    min-width: 150px;
  }
  
  .actions {
    width: 140px;
    padding-left: 0.5rem;
  }
  
  .detailsContainer {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .detailSection {
    h4 {
      font-size: 0.75rem;
    }
  }
}
</file>

<file path="src/components/customer/CustomerView.module.scss">
.container {
  display: flex;
  height: calc(100vh - 64px);
  background-color: #f8f9fa;
}

.sidebar {
  width: 340px;
  flex-shrink: 0;
  background-color: white;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
  z-index: 10;
}

.main {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.placeholder {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: white;
  margin: 2rem;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);

  p {
    color: #999;
    font-size: 1.125rem;
    font-weight: 300;
  }
}
</file>

<file path="src/components/customer/CustomerView.tsx">
"use client";

import { useCustomerData } from "@/lib/hooks/useCustomerData";
import { CustomerList } from "./CustomerList";
import { CustomerDetails } from "./CustomerDetails";
import styles from "./CustomerView.module.scss";

export function CustomerView() {
  const {
    filteredCustomers,
    selectedCustomer,
    selectedCustomerId,
    searchQuery,
    selectCustomer,
    updateCustomer,
    setSearchQuery,
  } = useCustomerData();

  return (
    <div className={styles.container}>
      <aside className={styles.sidebar}>
        <CustomerList
          customers={filteredCustomers}
          selectedCustomerId={selectedCustomerId}
          searchQuery={searchQuery}
          onSelectCustomer={selectCustomer}
          onSearchChange={setSearchQuery}
        />
      </aside>
      <main className={styles.main}>
        {selectedCustomer ? (
          <CustomerDetails
            customer={selectedCustomer}
            onUpdate={updateCustomer}
          />
        ) : (
          <div className={styles.placeholder}>
            <p>Wählen Sie einen Kunden aus, um Details anzuzeigen</p>
          </div>
        )}
      </main>
    </div>
  );
}
</file>

<file path="src/components/laws/BereicheSidebar.module.scss">
.sidebar {
  width: 100%;
  height: 100%;
  background-color: #f8fafc;
  border-right: 1px solid #e2e8f0;
  display: flex;
  flex-direction: column;
}

.sidebarHeader {
  padding: 1rem;
  border-bottom: 1px solid #e2e8f0;
  background-color: #ffffff;
}

.sidebarHeader h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.125rem;
  font-weight: 600;
  color: #1f2937;
}

.totalCount {
  font-size: 0.875rem;
  color: #6b7280;
  font-weight: 500;
}

.sidebarContent {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem 0;
}

.sidebarItem {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  border: none;
  background: none;
  text-align: left;
  cursor: pointer;
  transition: background-color 0.15s ease-in-out;
  font-size: 0.875rem;
  color: #374151;

  &:hover {
    background-color: #f1f5f9;
  }

  &.active {
    background-color: #dbeafe;
    color: #1e40af;
    font-weight: 500;
  }
}

.itemName {
  flex: 1;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.itemCount {
  background-color: #e5e7eb;
  color: #6b7280;
  padding: 0.125rem 0.5rem;
  border-radius: 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  min-width: 1.5rem;
  text-align: center;
  margin-left: 0.5rem;
}

.sidebarItem.active .itemCount {
  background-color: #3b82f6;
  color: #ffffff;
}

// Responsive design
@media (max-width: 768px) {
  .sidebar {
    border-right: none;
    border-bottom: 1px solid #e2e8f0;
  }

  .sidebarHeader {
    padding: 0.75rem;
  }

  .sidebarHeader h3 {
    font-size: 1rem;
  }

  .sidebarItem {
    padding: 0.625rem 0.75rem;
    font-size: 0.8125rem;
  }

  .itemCount {
    font-size: 0.6875rem;
    padding: 0.125rem 0.375rem;
  }
}
</file>

<file path="src/components/laws/BereicheSidebar.tsx">
import React from 'react';
import styles from './BereicheSidebar.module.scss';

interface BereicheSidebarProps {
  bereiche: string[];
  bereichCounts: Map<string, number>;
  selected: string | null;
  onSelect: (bereich: string | null) => void;
  totalCount: number;
}

const BereicheSidebar: React.FC<BereicheSidebarProps> = ({
  bereiche,
  bereichCounts,
  selected,
  onSelect,
  totalCount,
}) => {
  return (
    <div className={styles.sidebar}>
      <div className={styles.sidebarHeader}>
        <h3>Bereiche</h3>
        <div className={styles.totalCount}>
          {totalCount} Einträge
        </div>
      </div>
      
      <div className={styles.sidebarContent}>
        <button
          className={`${styles.sidebarItem} ${selected === null ? styles.active : ''}`}
          onClick={() => onSelect(null)}
        >
          <span className={styles.itemName}>Alle Bereiche</span>
          <span className={styles.itemCount}>{totalCount}</span>
        </button>
        
        {bereiche.map((bereich) => {
          const count = bereichCounts.get(bereich) || 0;
          return (
            <button
              key={bereich}
              className={`${styles.sidebarItem} ${selected === bereich ? styles.active : ''}`}
              onClick={() => onSelect(bereich)}
            >
              <span className={styles.itemName}>{bereich}</span>
              <span className={styles.itemCount}>{count}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
};

export default BereicheSidebar;
</file>

<file path="src/components/laws/DokumentSummaryDialog.module.scss">
// src/components/laws/DokumentSummaryDialog.module.scss

.dialogContent {
  max-width: 800px;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.dialogHeader {
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 1.5rem;
  position: relative;
}

.dialogTitle {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  line-height: 1.4;
}

.dialogBody {
  flex-grow: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  padding-right: 1rem; // space for scrollbar
}

.metadataGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  padding: 1rem;
  background-color: #fafafa;
  border-radius: 0.5rem;
  border: 1px solid #e5e7eb;
}

.fieldGroup {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.fieldLabel {
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
}

.fieldValue {
  font-size: 0.875rem;
  color: #1f2937;
}

.summarySection {
  margin-top: 1rem;
}

.summaryContent {
  font-size: 0.9rem;
  color: #374151;
  line-height: 1.6;
  white-space: pre-wrap;
}

.loadingContainer,
.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  text-align: center;
}

.loadingSpinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.errorIcon {
  width: 2.5rem;
  height: 2.5rem;
  color: #ef4444;
  margin-bottom: 1rem;
}

.errorMessage {
  color: #b91c1c;
}
</file>

<file path="src/components/laws/DokumentSummaryDialog.tsx">
// src/components/laws/DokumentSummaryDialog.tsx
import React, { useState, useEffect, useCallback } from 'react';
import { Dokument } from '@/types/pflicht';
import { Button } from '@/components/ui/button';
import { getDokumentDetails } from '@/lib/services/pflicht-service';
import { AlertCircle } from 'lucide-react';
import styles from './DokumentSummaryDialog.module.scss';

interface DokumentSummaryDialogProps {
  dokumentId: string | null;
}

const DokumentSummaryDialog: React.FC<DokumentSummaryDialogProps> = ({
  dokumentId,
}) => {
  const [dokument, setDokument] = useState<Dokument | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const loadDokumentDetails = useCallback(async () => {
    if (!dokumentId) return;

    setLoading(true);
    setError(null);
    try {
      const data = await getDokumentDetails(dokumentId);
      setDokument(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Fehler beim Laden der Dokument-Details');
    } finally {
      setLoading(false);
    }
  }, [dokumentId]);

  useEffect(() => {
    if (dokumentId) {
      loadDokumentDetails();
    }
  }, [dokumentId, loadDokumentDetails]);

  if (!dokumentId) return null;

  const renderContent = () => {
    if (loading) {
      return (
        <div className={styles.loadingContainer}>
          <div className={styles.loadingSpinner} />
          <p>Lade Dokument-Details...</p>
        </div>
      );
    }

    if (error) {
      return (
        <div className={styles.errorContainer}>
          <AlertCircle className={styles.errorIcon} />
          <p className={styles.errorMessage}>{error}</p>
          <Button onClick={loadDokumentDetails} variant="outline" className="mt-4">
            Erneut versuchen
          </Button>
        </div>
      );
    }

    if (!dokument) return null;

    return (
      <div className={styles.dialogBody}>
        <div className={styles.metadataGrid}>
          <div className={styles.fieldGroup}>
            <label className={styles.fieldLabel}>Gesetzgebung</label>
            <span className={styles.fieldValue}>{dokument.gesetzgebung || '-'}</span>
          </div>
          <div className={styles.fieldGroup}>
            <label className={styles.fieldLabel}>Bereich</label>
            <span className={styles.fieldValue}>{dokument.bereich || '-'}</span>
          </div>
          <div className={styles.fieldGroup}>
            <label className={styles.fieldLabel}>Gesetzeskürzel</label>
            <span className={styles.fieldValue}>{dokument.gesetzeskuerzel || '-'}</span>
          </div>
        </div>
        <div className={styles.summarySection}>
          <h3 className={styles.fieldLabel}>Zusammenfassung</h3>
          <p className={styles.summaryContent}>{dokument.zusammenfassung || 'Keine Zusammenfassung verfügbar.'}</p>
        </div>
      </div>
    );
  };

  return renderContent();
};

export default DokumentSummaryDialog;
</file>

<file path="src/components/laws/GeneralLawDetailDialog.module.scss">
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
  padding: 1rem;
  animation: fadeIn 0.2s ease-out;

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .dialog {
    background-color: white;
    border-radius: 0.75rem;
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    animation: slideUp 0.3s ease-out;

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;

      .title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
        margin: 0;
        padding-right: 1rem;
      }

      .closeButton {
        background: none;
        border: none;
        padding: 0.5rem;
        cursor: pointer;
        border-radius: 0.375rem;
        transition: background-color 0.2s;

        &:hover {
          background-color: #f3f4f6;
        }

        .closeIcon {
          width: 1.5rem;
          height: 1.5rem;
          color: #6b7280;
        }
      }
    }

    .content {
      padding: 1.5rem;

      .parameterList {
        display: flex;
        flex-direction: column;
        gap: 1rem;

        .parameter {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;

          .parameterLabel {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
          }

          .parameterValue {
            color: #111827;
            font-size: 0.875rem;
          }
        }
      }

      .infoSection,
      .recommendationsSection {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #f9fafb;
        border-radius: 0.5rem;

        h3 {
          margin: 0 0 1rem 0;
          font-size: 1.125rem;
          font-weight: 600;
          color: #111827;
        }

        p {
          margin: 0;
          color: #4b5563;
          line-height: 1.6;
          font-size: 0.875rem;
        }
      }

      .recommendationsSection {
        background-color: #fef3c7;
      }
    }
  }
}
</file>

<file path="src/components/laws/GeneralLawDetailDialog.tsx">
import React from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import { Rahmengesetzgebung } from '@/types/laws';
import TagDisplay from '@/components/TagDisplay';
import CollapsibleSection from '@/components/CollapsibleSection';
import styles from './GeneralLawDetailDialog.module.scss';

interface GeneralLawDetailDialogProps {
  law: Rahmengesetzgebung;
  onClose: () => void;
}

const GeneralLawDetailDialog: React.FC<GeneralLawDetailDialogProps> = ({ law, onClose }) => {
  const handleOverlayClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div className={styles.overlay} onClick={handleOverlayClick}>
      <div className={styles.dialog}>
        <div className={styles.header}>
          <h2 className={styles.title}>{law.kurztitel}</h2>
          <button 
            className={styles.closeButton}
            onClick={onClose}
            aria-label="Schließen"
          >
            <XMarkIcon className={styles.closeIcon} />
          </button>
        </div>

        <div className={styles.content}>
          <TagDisplay tags={[law.stichwort]} title="Stichwort" />

          <CollapsibleSection title="Weitere Parameter">
            <div className={styles.parameterList}>
              <div className={styles.parameter}>
                <span className={styles.parameterLabel}>Gesetz:</span>
                <span className={styles.parameterValue}>{law.gesetz}</span>
              </div>
              <div className={styles.parameter}>
                <span className={styles.parameterLabel}>Englischer Titel:</span>
                <span className={styles.parameterValue}>{law.shortTitle}</span>
              </div>
            </div>
          </CollapsibleSection>

          <div className={styles.infoSection}>
            <h3>Informationen</h3>
            <p>
              Weitere Informationen zu diesem Rahmengesetz werden hier angezeigt.
            </p>
          </div>

          <div className={styles.recommendationsSection}>
            <h3>Konkrete Empfehlungen</h3>
            <p>
              Handlungsempfehlungen für dieses Rahmengesetz werden hier aufgeführt.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default GeneralLawDetailDialog;
</file>

<file path="src/components/laws/GeneralLawTable.module.scss">
.lawsTable {
  width: 100%;

  .filterContainer {
    margin-bottom: 1.5rem;

    .filterInput {
      width: 100%;
      max-width: 400px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      background-color: white;
      transition: border-color 0.2s, box-shadow 0.2s;

      &:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      &::placeholder {
        color: #9ca3af;
      }
    }
  }

  .tableContainer {
    overflow-x: auto;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    background-color: white;

    .table {
      width: 100%;
      border-collapse: collapse;

      thead {
        background-color: #f9fafb;
        border-bottom: 1px solid #e5e7eb;

        tr {
          th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
          }
        }
      }

      tbody {
        tr {
          border-bottom: 1px solid #f3f4f6;

          &.clickableRow {
            cursor: pointer;
            transition: background-color 0.15s;

            &:hover {
              background-color: #f9fafb;
            }
          }

          &:last-child {
            border-bottom: none;
          }

          td {
            padding: 1rem;
            font-size: 0.875rem;
            color: #111827;

            .stichwort {
              display: inline-block;
              padding: 0.25rem 0.625rem;
              background-color: #ede9fe;
              color: #6b21a8;
              border-radius: 0.375rem;
              font-size: 0.75rem;
              font-weight: 600;
            }
          }

          td.noResults {
            text-align: center;
            color: #6b7280;
            padding: 2rem;
            font-style: italic;
          }
        }
      }
    }
  }
}
</file>

<file path="src/components/laws/GeneralLawTable.tsx">
import React from 'react';
import { Rahmengesetzgebung } from '@/types/laws';
import styles from './GeneralLawTable.module.scss';

interface GeneralLawTableProps {
  laws: Rahmengesetzgebung[];
  filterText: string;
  onFilterChange: (text: string) => void;
  onSelectLaw: (law: Rahmengesetzgebung) => void;
}

const GeneralLawTable: React.FC<GeneralLawTableProps> = ({ 
  laws, 
  filterText, 
  onFilterChange, 
  onSelectLaw 
}) => {
  return (
    <div className={styles.lawsTable}>
      <div className={styles.filterContainer}>
        <input
          type="text"
          className={styles.filterInput}
          placeholder="Rahmengesetze durchsuchen..."
          value={filterText}
          onChange={(e) => onFilterChange(e.target.value)}
        />
      </div>
      
      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th>Kurztitel</th>
              <th>Gesetz</th>
              <th>Stichwort</th>
            </tr>
          </thead>
          <tbody>
            {laws.map((law, index) => (
              <tr 
                key={index} 
                onClick={() => onSelectLaw(law)}
                className={styles.clickableRow}
              >
                <td>{law.kurztitel}</td>
                <td>{law.gesetz}</td>
                <td>
                  <span className={styles.stichwort}>
                    {law.stichwort}
                  </span>
                </td>
              </tr>
            ))}
            {laws.length === 0 && (
              <tr>
                <td colSpan={3} className={styles.noResults}>
                  Keine Rahmengesetze gefunden
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default GeneralLawTable;
</file>

<file path="src/components/shared/RightSidebar.module.scss">
// src/components/shared/RightSidebar.module.scss
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideIn {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 100;
  animation: fadeIn 0.3s ease-out;
}

.sidebar {
  position: absolute;
  top: 0;
  right: 0;
  width: 100%;
  max-width: 500px;
  height: 100%;
  background-color: white;
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  animation: slideIn 0.3s ease-out;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  flex-shrink: 0;
}

.title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
}

.closeButton {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.2s;
  &:hover {
    background-color: #f3f4f6;
  }
}

.closeIcon {
  width: 1.5rem;
  height: 1.5rem;
  color: #6b7280;
}

.content {
  padding: 1.5rem;
  overflow-y: auto;
  flex-grow: 1;
}
</file>

<file path="src/components/shared/RightSidebar.tsx">
// src/components/shared/RightSidebar.tsx
import React from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import styles from './RightSidebar.module.scss';

interface RightSidebarProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

const RightSidebar: React.FC<RightSidebarProps> = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) {
    return null;
  }

  const handleOverlayClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div className={styles.overlay} onClick={handleOverlayClick}>
      <div className={styles.sidebar}>
        <div className={styles.header}>
          <h2 className={styles.title}>{title}</h2>
          <button
            className={styles.closeButton}
            onClick={onClose}
            aria-label="Schließen"
          >
            <XMarkIcon className={styles.closeIcon} />
          </button>
        </div>
        <div className={styles.content}>
          {children}
        </div>
      </div>
    </div>
  );
};

export default RightSidebar;
</file>

<file path="src/components/ui/alert.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="src/components/ui/badge.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="src/components/ui/command.tsx">
"use client"

import * as React from "react"
import { Command as CommandPrimitive } from "cmdk"
import { SearchIcon } from "lucide-react"

import { cn } from "@/lib/utils"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className
      )}
      {...props}
    />
  )
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string
  description?: string
  className?: string
  showCloseButton?: boolean
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn("overflow-hidden p-0", className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        {...props}
      />
    </div>
  )
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className
      )}
      {...props}
    />
  )
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  )
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className
      )}
      {...props}
    />
  )
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  )
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="src/components/ui/label.tsx">
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="src/components/ui/popover.tsx">
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }
</file>

<file path="src/components/ui/scroll-area.tsx">
"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }
</file>

<file path="src/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="src/components/ui/table.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/components/ui/tabs.tsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="src/components/ArtifactActionButton.module.scss">
.loadingDots {
  display: inline-flex;
  gap: 4px;

  span {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: white;
    animation: loading-bounce 1.4s ease-in-out infinite both;

    &:nth-child(1) {
      animation-delay: -0.32s;
    }

    &:nth-child(2) {
      animation-delay: -0.16s;
    }
  }
}

@keyframes loading-bounce {
  0%,
  80%,
  100% {
    transform: scale(0.8);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}
</file>

<file path="src/components/ArtifactEditor.module.scss">
.bubbleMenu {
  background-color: #fff;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  border-radius: 6px;
  display: flex;
  padding: 4px;
  transition: all 0.3s ease-in-out;

  button {
    height: 36px;
    width: 36px;
    border-radius: 50%;
    background-color: transparent;
    color: #4a4a4a;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease-in-out;

    &:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    &.isActive {
      background-color: #007aff;
      color: white;
    }
  }
}

.saveChangesBtn {
  background-color: black;
  color: white;
  padding: 8px 10px;
  margin-bottom: 0;
  border-radius: 4px;
  font-size: 0.875rem;
  border: none;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;

  &:hover {
    background-color: #333;
  }
}
</file>

<file path="src/components/ArtifactEditor.tsx">
"use client";

import { useEditor, EditorContent } from "@tiptap/react";
import StarterKit from "@tiptap/starter-kit";
import Table from "@tiptap/extension-table";
import TableRow from "@tiptap/extension-table-row";
import TableCell from "@tiptap/extension-table-cell";
import TableHeader from "@tiptap/extension-table-header";
import Image from "@tiptap/extension-image";
import Link from "@tiptap/extension-link";
import { createLowlight } from "lowlight";
import CodeBlockLowlight from "@tiptap/extension-code-block-lowlight";
import { common } from "lowlight";

import { formatHtmlMarkdown } from "@/domain/markdown-service";
import CustomHighlight from "@/domain/custom-highlight";
import MathBlock from "@/domain/custom-math-block";
import { CustomTabExtension } from "@/domain/custom-tab-extension";
import { PersistentCodeBlock } from "@/domain/persistent-code-block";
import { CodeBlockNewlineFix } from "@/domain/custom-keymaping";

type Props = {
  artifact: any;
  versions: any[];
  onModified: (updatedArtifact: any) => void;
};

const lowlight = createLowlight(common);

const ArtifactEditor = ({ artifact, onModified }: Props) => {
  const originalMarkdown =
    typeof artifact.payload === "string"
      ? artifact.payload
      : artifact.content?.artifact_content ??
        artifact.content?.task_content?.content ??
        "";

  const editor = useEditor({
    extensions: [
      StarterKit.configure({ hardBreak: false }),
      Table.configure({ resizable: true }),
      TableRow,
      TableHeader,
      PersistentCodeBlock,
      TableCell,
      CodeBlockLowlight.configure({ lowlight }),
      MathBlock,
      CustomHighlight,
      CustomTabExtension,
      Image,
      Link,
      CodeBlockNewlineFix,
    ],
    content: artifact.isCodeBlock
      ? {
          type: "doc",
          content: [
            {
              type: "codeBlock",
              attrs: { language: artifact.language || "" },
              content: [{ type: "text", text: originalMarkdown.trim() }],
            },
          ],
        }
      : originalMarkdown,
    onUpdate: ({ editor }) => {
      const html = editor.getHTML();
      const currentMarkdown = formatHtmlMarkdown(html).trim();
      onModified({
        ...artifact,
        content: currentMarkdown,
        version: (artifact.version ?? 0) + 1,
      });
    },
  });

  return (
    <div className="flex-grow markdown-chat">
      <EditorContent editor={editor} />
    </div>
  );
};

export default ArtifactEditor;
</file>

<file path="src/components/ArtifactEval.tsx">
"use client";

import { formatMarkdownHtml } from "@/domain/markdown-service";

type Props = {
  artifact: any;
};

const ArtifactEval = ({ artifact }: Props) => {
  return (
    <div className="flex flex-col h-full">
      <div
        className="flex-grow markdown-chat mb-8"
        dangerouslySetInnerHTML={{
          __html: formatMarkdownHtml(artifact.content ?? ""),
        }}
      />
    </div>
  );
};

export default ArtifactEval;
</file>

<file path="src/components/ArtifactHeader.module.scss">
.artifactHeader {
  background-color: var(--artifact-bg);
  height: 5rem;
}

.tabButton {
  background-color: var(--chat-message-bg);
  border: 1px solid var(--chat-message-bg);
  color: var(--primary-text);
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
  margin-bottom: 0px;
}

.tabButton.active {
  background-color: var(--artifact-bg, #ddd);
  font-weight: bold;
}

.tabButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.headerButton {
  transition: all 0.2s ease;
  padding: 0.5rem;
  border-radius: 0.375rem;
  background-color: transparent;
  border: none;
  
  &:hover {
    background-color: transparent;
    
    svg {
      color: white;
    }
  }
}

.headerLink {
  transition: all 0.2s ease;
  padding: 0.5rem;
  border-radius: 0.375rem;
  display: inline-block;
  
  &:hover {
    background-color: transparent;
    
    img {
      filter: brightness(0) invert(1);
    }
  }
}
</file>

<file path="src/components/ArtifactLoading.tsx">
"use client";

import { useEffect, useState } from "react";
import styles from "./ArtifactLoading.module.scss";

type Props = {
  loading: boolean;
  artifactTitle?: string;
  artifactId: string;
  artifactVersion: number;
  onArtifactSelected?: (artifact: { id: string; version: number }) => void;
};

const ArtifactLoading = ({
  loading,
  artifactTitle = "",
  artifactId,
  artifactVersion,
  onArtifactSelected,
}: Props) => {
  const [currentTitle, setCurrentTitle] = useState(artifactTitle);

  useEffect(() => {
    setCurrentTitle(artifactTitle);
  }, [artifactTitle]);

  const truncatedTitle =
    currentTitle.length > 50
      ? currentTitle.substring(0, 50) + "..."
      : currentTitle;

  const handleClick = () => {
    if (!loading && onArtifactSelected) {
      onArtifactSelected({ id: artifactId, version: artifactVersion });
    }
  };

  return (
    <div
      className={`artifact-loading-container flex ${
        !loading ? "cursor-pointer" : ""
      }`}
      onClick={handleClick}
    >
      <div className="artifact-loading-right flex flex-col justify-center">
        {loading ? (
          <p className="text-gray-400">Generiere Antwort</p>
        ) : currentTitle ? (
          <p className={`artifact-title ${styles.linkOrange}`} data-icon="→">
            {truncatedTitle}
          </p>
        ) : null}
      </div>
    </div>
  );
};

export default ArtifactLoading;
</file>

<file path="src/components/ArtifactMarkdown.tsx">
"use client";

import {
  formatMarkdownHtml,
  splitMarkdownIntoChunks,
} from "@/domain/markdown-service";
import ArtifactEditor from "./ArtifactEditor";

type Props = {
  artifact: any;
  onModified: (updatedArtifact: any) => void;
};

const ArtifactMarkdown = ({ artifact, onModified }: Props) => {
  const markdown =
    typeof artifact.payload === "string"
      ? artifact.payload
      : artifact.content?.artifact_content ??
        artifact.content?.task_content?.content ??
        "";

  const chunks = splitMarkdownIntoChunks(markdown);

  return (
    <div className="flex-grow space-y-4">
      {chunks.map((chunk, index) =>
        chunk.type === "markdown" ? (
          <div
            key={index}
            className="markdown-chat"
            dangerouslySetInnerHTML={{
              __html: formatMarkdownHtml(chunk.content),
            }}
          />
        ) : (
          <ArtifactEditor
            key={index}
            artifact={{
              ...artifact,
              payload: chunk.content,
              isCodeBlock: true,
              language: chunk.language,
            }}
            versions={[]}
            onModified={onModified}
          />
        )
      )}
    </div>
  );
};

export default ArtifactMarkdown;
</file>

<file path="src/components/ArtifactTaskInstruction.tsx">
"use client";

import { formatMarkdownHtml } from "@/domain/markdown-service";

type Props = {
  artifact: any;
};

const ArtifactTaskInstruction = ({ artifact }: Props) => {
  return (
    <div className="flex flex-col h-full">
      <div
        className="flex-grow markdown-chat"
        dangerouslySetInnerHTML={{
          __html: formatMarkdownHtml(artifact.content ?? ""),
        }}
      />
    </div>
  );
};

export default ArtifactTaskInstruction;
</file>

<file path="src/components/ArtifactTimeline.tsx">
"use client";

import type { Task } from "@/types/generic";
import Image from "next/image";
import styles from "./ArtifactTimeline.module.scss";

type Props = {
  tasks: Task[];
  currentTask: number;
  totalTasks: number;
};

const ArtifactTimeline = ({ tasks, currentTask, totalTasks }: Props) => {
  const progressWidth =
    totalTasks > 1 ? `${(currentTask / (totalTasks - 1)) * 100}%` : "0%";

  return (
    <div
      className={`${styles.artifactTimeline} flex justify-between items-center min-h-[55px] relative`}
    >
      <div
        id="artifactTimelineProgressContainer"
        className="absolute top-1/2 left-[2.5rem] right-[2.5rem] h-[2px] z-5 bg-[#747F9E]"
      >
        <div
          id="artifactTimelineProgress"
          className="bg-[#71D8FC] h-[2px] transition-all"
          style={{ width: progressWidth }}
        />
      </div>

      <div
        className={`${styles.artifactTimelineBubbles} flex justify-between items-center w-full z-10 relative`}
      >
        {tasks.map((task) => {
          const taskIndex = task.original_index;
          const done = taskIndex < currentTask;
          const active = taskIndex === currentTask;

          const bubbleClass = [
            styles.timelineItem,
            done && styles.timelineDone,
            active && styles.timelineActive,
          ]
            .filter(Boolean)
            .join(" ");

          return (
            <div
              key={taskIndex}
              className={bubbleClass}
              title={task.task_title}
            >
              <Image
                src={task.task_icon}
                alt={task.task_title}
                width={48}
                height={48}
                className="task-icon w-12 h-12"
              />
            </div>
          );
        })}
      </div>
    </div>
  );
};

export default ArtifactTimeline;
</file>

<file path="src/components/BereicheSidebar.module.scss">
.sidebar {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.header {
  padding: 1.5rem 1rem;
  border-bottom: 1px solid var(--border-color, #e1e4e8);
  
  h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary, #1a1a1a);
  }
}

.bereichList {
  list-style: none;
  margin: 0;
  padding: 0.5rem 0;
  flex: 1;
  overflow-y: auto;
}

.bereichItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
  
  &:hover {
    background-color: var(--hover-background, #f0f1f3);
  }
  
  &.active {
    background-color: var(--primary-light, #e3f2fd);
    border-left: 3px solid var(--primary, #2196f3);
    padding-left: calc(1rem - 3px);
    
    .bereichName {
      font-weight: 600;
      color: var(--primary, #2196f3);
    }
  }
}

.bereichName {
  flex: 1;
  font-size: 0.875rem;
  color: var(--text-secondary, #4a4a4a);
}

.count {
  background-color: var(--badge-background, #e8e8e8);
  color: var(--text-secondary, #666);
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
  min-width: 1.5rem;
  text-align: center;
}
</file>

<file path="src/components/BereicheSidebar.tsx">
import React from 'react';
import styles from './BereicheSidebar.module.scss';
import { Bereich } from '@/lib/hooks/useLaws';

type Props = {
  bereiche: Bereich[];
  bereichCounts: Map<string, number>;
  selected: Bereich | null;
  onSelect: (bereich: Bereich | null) => void;
};

export default function BereicheSidebar({ bereiche, bereichCounts, selected, onSelect }: Props) {
  return (
    <div className={styles.sidebar}>
      <div className={styles.header}>
        <h3>Bereiche</h3>
      </div>
      <ul className={styles.bereichList}>
        <li 
          className={`${styles.bereichItem} ${!selected ? styles.active : ''}`}
          onClick={() => onSelect(null)}
        >
          <span className={styles.bereichName}>Alle anzeigen</span>
          <span className={styles.count}>
            {Array.from(bereichCounts.values()).reduce((a, b) => a + b, 0)}
          </span>
        </li>
        {bereiche.map((bereich) => {
          const count = bereichCounts.get(bereich.name) || 0;
          return (
            <li
              key={bereich.name}
              className={`${styles.bereichItem} ${
                selected?.name === bereich.name ? styles.active : ''
              }`}
              onClick={() => onSelect(bereich)}
            >
              <span className={styles.bereichName}>{bereich.name}</span>
              <span className={styles.count}>{count}</span>
            </li>
          );
        })}
      </ul>
    </div>
  );
}
</file>

<file path="src/components/ChatMessage.tsx">
"use client";

import React from "react";
import config from "@/config";
import { Role } from "@/domain/constants";
import Image from "next/image";

type Props = {
  role: Role;
  message?: any;
  isLoadingArtifact: boolean;
  isStartScreen: boolean;
  onArtifactSelected?: (artifact: { id: string; version: number }) => void;
  children?: React.ReactNode;
};

const ChatMessage: React.FC<Props> = ({
  role = Role.AI,
  isStartScreen,
  children,
}) => {
  const showAvatar = (role === Role.TOOL || role === Role.AI) && !isStartScreen;

  const roleConfigMap = {
    [Role.TOOL]: config.system,
    [Role.AI]: config.agent,
    [Role.CUSTOM]: config.agent,
    [Role.HUMAN]: config.user,
  };

  const roleConfig = roleConfigMap[role];
  const Icon = roleConfig.icon;
  const iconColor = roleConfig.iconColor;

  return (
    <div className={`chat-message ${role === Role.HUMAN ? "user" : "ai"}`}>
      {showAvatar && Icon && (
        <div className="icon_agent h-10 w-10 shrink-0 mr-4 mt-[0.2rem] flex items-center justify-center bg-[var(--darkblue)] rounded-full">
          {typeof Icon === "string" ? (
            <Image
              width="26"
              height="10"
              alt={`${role} icon`}
              src={`/assets/images/${Icon}`}
              className={iconColor}
            />
          ) : (
            <Icon className={iconColor} />
          )}
        </div>
      )}

      <div className="flex-grow mt-2.5">
        <div className="leading-relaxed whitespace-pre-wrap">
          {children ?? <span className="text-gray-400">Loading...</span>}
        </div>
      </div>
    </div>
  );
};

export default ChatMessage;
</file>

<file path="src/components/CollapsibleSection.module.scss">
.collapsibleSection {
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  overflow: hidden;
  margin: 1rem 0;

  .header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background-color: #f9fafb;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;

    &:hover {
      background-color: #f3f4f6;
    }

    .title {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
      text-align: left;
    }

    .icon {
      width: 1.25rem;
      height: 1.25rem;
      color: #6b7280;
      transition: transform 0.3s ease;

      &.rotated {
        transform: rotate(180deg);
      }
    }
  }

  .content {
    padding: 1rem;
    background-color: white;
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
</file>

<file path="src/components/CollapsibleSection.tsx">
import React, { useState } from 'react';
import { ChevronUpIcon } from '@heroicons/react/24/outline';
import styles from './CollapsibleSection.module.scss';

interface CollapsibleSectionProps {
  title: string;
  children: React.ReactNode;
}

const CollapsibleSection: React.FC<CollapsibleSectionProps> = ({ title, children }) => {
  const [isOpen, setIsOpen] = useState(true);

  const toggleOpen = () => {
    setIsOpen(!isOpen);
  };

  return (
    <div className={styles.collapsibleSection}>
      <button
        className={styles.header}
        onClick={toggleOpen}
        aria-expanded={isOpen}
      >
        <span className={styles.title}>{title}</span>
        <ChevronUpIcon 
          className={`${styles.icon} ${!isOpen ? styles.rotated : ''}`}
        />
      </button>
      {isOpen && (
        <div className={styles.content}>
          {children}
        </div>
      )}
    </div>
  );
};

export default CollapsibleSection;
</file>

<file path="src/components/ConversationChat.module.scss">
.chatContainer {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%;
  overflow: hidden;
  position: relative;
  min-width: 325px;

  @media (max-width: 768px) {
    height: auto;
  }
}

.messagesWrapper {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;

  // Firefox scrollbar
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-color) transparent;

  // WebKit scrollbar (using :global correctly in SCSS)
  :global(.messagesWrapper::-webkit-scrollbar) {
    width: 8px;
  }

  :global(.messagesWrapper::-webkit-scrollbar-track) {
    background: transparent;
  }

  :global(.messagesWrapper::-webkit-scrollbar-thumb) {
    background-color: var(--scrollbar-color);
    border: 3px solid transparent;
    border-radius: 10px;
    background-clip: padding-box;
  }
}

.messagesContent {
  position: relative;
  min-height: min-content;
  width: 100%;
  max-width: var(--container-width);
  margin: 0 auto;
  padding: 1.5rem 2rem;
}

.inputWrapper {
  position: relative;
  width: 100%;
  flex-shrink: 0;
}

.scrollButtonContainer {
  position: absolute;
  bottom: 110%;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;

  svg {
    color: #fe5000 !important;
  }
}
</file>

<file path="src/components/LawDetailDialog.module.scss">
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
  padding: 1rem;
  animation: fadeIn 0.2s ease-out;

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .dialog {
    background-color: white;
    border-radius: 0.75rem;
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    animation: slideUp 0.3s ease-out;

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;

      .title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
        margin: 0;
        padding-right: 1rem;
      }

      .closeButton {
        background: none;
        border: none;
        padding: 0.5rem;
        cursor: pointer;
        border-radius: 0.375rem;
        transition: background-color 0.2s;

        &:hover {
          background-color: #f3f4f6;
        }

        .closeIcon {
          width: 1.5rem;
          height: 1.5rem;
          color: #6b7280;
        }
      }
    }

    .content {
      padding: 1.5rem;

      .parameterList {
        display: flex;
        flex-direction: column;
        gap: 1rem;

        .parameter {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;

          .parameterLabel {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
          }

          .parameterValue {
            color: #111827;
            font-size: 0.875rem;
          }
        }
      }

      .infoSection,
      .recommendationsSection {
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #f9fafb;
        border-radius: 0.5rem;

        h3 {
          margin: 0 0 1rem 0;
          font-size: 1.125rem;
          font-weight: 600;
          color: #111827;
        }

        p {
          margin: 0;
          color: #4b5563;
          line-height: 1.6;
          font-size: 0.875rem;
        }
      }

      .recommendationsSection {
        background-color: #fef3c7;
      }
    }
  }
}
</file>

<file path="src/components/LawDetailDialog.tsx">
import React from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import { Rahmengesetzgebung } from '@/types/laws';
import TagDisplay from './TagDisplay';
import CollapsibleSection from './CollapsibleSection';
import styles from './LawDetailDialog.module.scss';

interface LawDetailDialogProps {
  law: Rahmengesetzgebung;
  onClose: () => void;
}

const LawDetailDialog: React.FC<LawDetailDialogProps> = ({ law, onClose }) => {
  const handleOverlayClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div className={styles.overlay} onClick={handleOverlayClick}>
      <div className={styles.dialog}>
        <div className={styles.header}>
          <h2 className={styles.title}>{law.kurztitel}</h2>
          <button 
            className={styles.closeButton}
            onClick={onClose}
            aria-label="Schließen"
          >
            <XMarkIcon className={styles.closeIcon} />
          </button>
        </div>

        <div className={styles.content}>
          <TagDisplay tags={[law.stichwort]} title="Stichwort" />

          <CollapsibleSection title="Weitere Parameter">
            <div className={styles.parameterList}>
              <div className={styles.parameter}>
                <span className={styles.parameterLabel}>Gesetz:</span>
                <span className={styles.parameterValue}>{law.gesetz}</span>
              </div>
              <div className={styles.parameter}>
                <span className={styles.parameterLabel}>Englischer Titel:</span>
                <span className={styles.parameterValue}>{law.shortTitle}</span>
              </div>
            </div>
          </CollapsibleSection>

          <div className={styles.infoSection}>
            <h3>Informationen</h3>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor 
              incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud 
              exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute 
              irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla 
              pariatur.
            </p>
          </div>

          <div className={styles.recommendationsSection}>
            <h3>Konkrete Empfehlungen</h3>
            <p>
              Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt 
              mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit 
              voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae 
              ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LawDetailDialog;
</file>

<file path="src/components/LawsSplitView.module.scss">
.splitViewContainer {
  display: flex;
  height: 100%;
  width: 100%;
  gap: 0;
}

.sidebarPanel {
  width: 280px;
  background-color: var(--background-secondary, #f8f9fa);
  border-right: 1px solid var(--border-color, #e1e4e8);
  overflow-y: auto;
  flex-shrink: 0;
}

.contentPanel {
  flex: 1;
  padding: 2rem;
  overflow-y: auto;
  background-color: var(--background, #ffffff);
}
</file>

<file path="src/components/LawsSplitView.tsx">
import React from 'react';
import styles from './LawsSplitView.module.scss';

type Props = {
  sidebar: React.ReactNode;
  children: React.ReactNode;
};

export default function LawsSplitView({ sidebar, children }: Props) {
  return (
    <div className={styles.splitViewContainer}>
      <aside className={styles.sidebarPanel}>{sidebar}</aside>
      <main className={styles.contentPanel}>{children}</main>
    </div>
  );
}
</file>

<file path="src/components/LawsTable.module.scss">
.lawsTable {
  width: 100%;

  .filterContainer {
    margin-bottom: 1.5rem;

    .filterInput {
      width: 100%;
      max-width: 400px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      background-color: white;
      transition: border-color 0.2s, box-shadow 0.2s;

      &:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      &::placeholder {
        color: #9ca3af;
      }
    }
  }

  .tableContainer {
    overflow-x: auto;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    background-color: white;

    .table {
      width: 100%;
      border-collapse: collapse;

      thead {
        background-color: #f9fafb;
        border-bottom: 1px solid #e5e7eb;

        tr {
          th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
          }
        }
      }

      tbody {
        tr {
          border-bottom: 1px solid #f3f4f6;

          &.clickableRow {
            cursor: pointer;
            transition: background-color 0.15s;

            &:hover {
              background-color: #f9fafb;
            }
          }

          &:last-child {
            border-bottom: none;
          }

          td {
            padding: 1rem;
            font-size: 0.875rem;
            color: #111827;

            .stichwort {
              display: inline-block;
              padding: 0.25rem 0.625rem;
              background-color: #ede9fe;
              color: #6b21a8;
              border-radius: 0.375rem;
              font-size: 0.75rem;
              font-weight: 600;
            }
          }

          td.noResults {
            text-align: center;
            color: #6b7280;
            padding: 2rem;
            font-style: italic;
          }
        }
      }
    }
  }
}
</file>

<file path="src/components/LawsTable.tsx">
import React from 'react';
import { Rahmengesetzgebung } from '@/types/laws';
import styles from './LawsTable.module.scss';

interface LawsTableProps {
  laws: Rahmengesetzgebung[];
  filterText: string;
  onFilterChange: (text: string) => void;
  onSelectLaw: (law: Rahmengesetzgebung) => void;
}

const LawsTable: React.FC<LawsTableProps> = ({ 
  laws, 
  filterText, 
  onFilterChange, 
  onSelectLaw 
}) => {
  return (
    <div className={styles.lawsTable}>
      <div className={styles.filterContainer}>
        <input
          type="text"
          className={styles.filterInput}
          placeholder="Gesetzestexte durchsuchen..."
          value={filterText}
          onChange={(e) => onFilterChange(e.target.value)}
        />
      </div>
      
      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th>Kurztitel</th>
              <th>Gesetz</th>
              <th>Stichwort</th>
            </tr>
          </thead>
          <tbody>
            {laws.map((law, index) => (
              <tr 
                key={index} 
                onClick={() => onSelectLaw(law)}
                className={styles.clickableRow}
              >
                <td>{law.kurztitel}</td>
                <td>{law.gesetz}</td>
                <td>
                  <span className={styles.stichwort}>
                    {law.stichwort}
                  </span>
                </td>
              </tr>
            ))}
            {laws.length === 0 && (
              <tr>
                <td colSpan={3} className={styles.noResults}>
                  Keine Gesetzestexte gefunden
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default LawsTable;
</file>

<file path="src/components/LegalLinks.tsx">
"use client";

import { useTranslations } from "next-intl";

interface LegalLinksProps {
  className?: string;
}

const LegalLinks = ({ className = "" }: LegalLinksProps) => {
  const t = useTranslations();
  return (
    <div className={`flex gap-2 sm:gap-4 text-xs ${className}`}>
      <a
        href="https://deyan7.de/impressum/"
        target="_blank"
        rel="noopener noreferrer"
        className="text-blue-400 hover:text-blue-300 underline hover:no-underline transition-colors whitespace-nowrap"
      >
        {t("impressum")}
      </a>
      <a
        href="https://deyan7.de/datenschutz/"
        target="_blank"
        rel="noopener noreferrer"
        className="text-blue-400 hover:text-blue-300 underline hover:no-underline transition-colors whitespace-nowrap"
      >
        {t("privacy_policy")}
      </a>
    </div>
  );
};

export default LegalLinks;
</file>

<file path="src/components/Protected.tsx">
"use client";

import { useAuth } from "@/context/AuthContext";
import { useRouter } from "next/navigation";
import { ReactNode, useEffect } from "react";

const Protected = ({ children }: { children: ReactNode }) => {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.replace("/signin");
    }
  }, [loading, user, router]);

  if (loading || !user) {
    return null;
  }

  return <>{children}</>;
};

export default Protected;
</file>

<file path="src/components/ScrollDownButton.tsx">
"use client";

import styles from "./ScrollDownButton.module.scss";

interface ScrollDownButtonProps {
  onClick: () => void;
}

const ScrollDownButton = ({ onClick }: ScrollDownButtonProps) => {
  return (
    <div
      onClick={(e) => {
        e.preventDefault();
        onClick();
      }}
      className="border-black/10 border-2 bg-white hover:bg-gray-100 mx-auto z-10 rounded-full cursor-pointer"
    >
      <svg
        width="32"
        height="32"
        viewBox="0 0 24 24"
        fill="none"
        className={`m-1 ${styles.textOrange}`}
      >
        <path
          d="M17 13L12 18L7 13M12 6L12 17"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
      </svg>
    </div>
  );
};

export default ScrollDownButton;
</file>

<file path="src/components/Sidebar.module.scss">
.sidebar {
  width: 240px;
  background-color: #ffffff;
  height: 100vh;
  transition: width 0.3s ease;
  display: flex;
  flex-direction: column;
  border-right: 1px solid #e5e7eb;
  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
  position: relative;
  z-index: 10;

  &.collapsed {
    width: 60px;
    
    &:hover {
      width: 240px;

      .navLabel {
        opacity: 1;
        width: auto;
        transition-delay: 0.1s;
      }

      .navLink {
        justify-content: flex-start;
        padding: 0.75rem 1.5rem;
      }

      .navIcon {
        margin-right: 1rem;
      }
    }
  }
}

.sidebarContent {
  flex-grow: 1;
  padding-top: 2rem;
}

.navList {
  list-style: none;
  padding: 0;
  margin: 0;
}

.navLink {
  display: flex;
  align-items: center;
  padding: 0.75rem 1.5rem;
  color: #4b5563;
  text-decoration: none;
  white-space: nowrap;
  overflow: hidden;
  transition: all 0.2s ease;

  &:hover {
    background-color: #f3f4f6;
    color: #1f2937;
  }

  &.active {
    background-color: #fee2e2;
    color: #dc2626;
    font-weight: 600;
    border-left: 3px solid #dc2626;
  }
}

.navIcon {
  width: 1.5rem;
  height: 1.5rem;
  margin-right: 1rem;
  flex-shrink: 0;
  transition: margin 0.2s ease;
}

.navLabel {
  transition: opacity 0.3s ease, width 0.3s ease;
}

.collapsed .navLabel {
  opacity: 0;
  width: 0;
  overflow: hidden;
}

.collapsed .navLink {
  justify-content: center;
  padding: 0.75rem 0.5rem;
}

.collapsed .navIcon {
  margin-right: 0;
}

.toggleButton {
  padding: 1rem;
  background-color: transparent;
  border: none;
  border-top: 1px solid #e5e7eb;
  cursor: pointer;
  color: #6b7280;
  transition: all 0.2s ease;

  &:hover {
    background-color: #f9fafb;
    color: #374151;
  }
}
</file>

<file path="src/components/SplitView.tsx">
"use client";
import {
  useEffect,
  useRef,
  useState,
  useCallback,
  createContext,
  useContext,
} from "react";
import { useMediaQuery } from "react-responsive";
import ArtifactView from "@/components/ArtifactView";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";
import SendMessageInput from "./SendMessageInput";
import styles from "./SplitView.module.scss";

declare global {
  interface Window {
    mobileLayoutControls?: {
      expandLeftPane: () => void;
      collapseLeftPane: () => void;
      isMobile: boolean;
    };
  }
}

const MIN_WIDTH = 450;
const COMPACT_BREAKPOINT = 570;

type SplitViewContextType = {
  containerWidth: number;
  isCompact: boolean;
};

const SplitViewContext = createContext<SplitViewContextType>({
  containerWidth: 600,
  isCompact: false,
});

export const useSplitViewContext = () => useContext(SplitViewContext);

const SplitViewLayout = ({ children }: { children: React.ReactNode }) => {
  const [leftWidth, setLeftWidth] = useState<number>(600);
  const isCompact = leftWidth < COMPACT_BREAKPOINT;
  const [maxLeftWidth, setMaxLeftWidth] = useState<number>(1000);
  const [isLeftPaneExpanded, setIsLeftPaneExpanded] = useState<boolean>(false);

  const { chatMessages, artifacts } = useAgentStreamContext();

  const lastChatId = useRef<string | null>(null);
  const lastArtifactId = useRef<string | null>(null);

  const startX = useRef(0);
  const startWidth = useRef(0);
  const inputRef = useRef<HTMLDivElement>(null);

  const isMobile = useMediaQuery({ query: "(max-width: 767px)" });

  useEffect(() => {
    if (!isMobile) {
      const initial = window.innerWidth * 0.3;
      setLeftWidth(Math.max(MIN_WIDTH, initial));
      setMaxLeftWidth(window.innerWidth * 0.7);
    }
  }, [isMobile]);

  const expandLeftPane = useCallback(() => {
    if (isMobile && !isLeftPaneExpanded) {
      setIsLeftPaneExpanded(true);
    }
  }, [isMobile, isLeftPaneExpanded]);

  const collapseLeftPane = useCallback(() => {
    if (isMobile && isLeftPaneExpanded) {
      setIsLeftPaneExpanded(false);
    }
  }, [isMobile, isLeftPaneExpanded]);

  useEffect(() => {
    const handleResize = () => {
      if (!isMobile) {
        setMaxLeftWidth(window.innerWidth * 0.7);
        setLeftWidth((current) => Math.min(current, window.innerWidth * 0.7));
      }
    };
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, [isMobile]);

  useEffect(() => {
    if (isMobile) {
      const chatContent = document.querySelector(".mobile-chat-content");
      const textarea = chatContent?.querySelector("textarea");
      const sendButton = chatContent?.querySelector("a");

      const handleFocus = () => {
        setIsLeftPaneExpanded(true);
      };

      const handleSendClick = (e: Event) => {
        e.preventDefault();
        setIsLeftPaneExpanded(false);
      };

      const handleKeyPress = (e: KeyboardEvent) => {
        if (e.key === "Enter" && !e.shiftKey) {
          setIsLeftPaneExpanded(false);
        }
      };

      if (textarea) {
        textarea.addEventListener("focus", handleFocus);
        textarea.addEventListener("keypress", handleKeyPress);
      }

      if (sendButton) {
        sendButton.addEventListener("click", handleSendClick);
      }

      return () => {
        if (textarea) {
          textarea.removeEventListener("focus", handleFocus);
          textarea.removeEventListener("keypress", handleKeyPress);
        }
        if (sendButton) {
          sendButton.removeEventListener("click", handleSendClick);
        }
      };
    }
  }, [isMobile, isLeftPaneExpanded]);

  const startResize = (e: React.MouseEvent) => {
    e.preventDefault();
    startX.current = e.clientX;
    startWidth.current = leftWidth;
    window.addEventListener("mousemove", resize);
    window.addEventListener("mouseup", stopResize);
  };

  const resize = (e: MouseEvent) => {
    const deltaX = e.clientX - startX.current;
    const proposedWidth = startWidth.current + deltaX;

    const minWidth = MIN_WIDTH;

    const newWidth = Math.max(minWidth, Math.min(proposedWidth, maxLeftWidth));
    setLeftWidth(newWidth);
  };

  const stopResize = () => {
    window.removeEventListener("mousemove", resize);
    window.removeEventListener("mouseup", stopResize);
  };

  const toggleLeftPane = () => {
    setIsLeftPaneExpanded(!isLeftPaneExpanded);
  };

  useEffect(() => {
    if (!isMobile) return;

    const latestChat = chatMessages.at(-1);
    const latestArtifact = artifacts.at(-1);

    const newChatMessage =
      latestChat?.id && latestChat.id !== lastChatId.current;
    const newArtifact =
      latestArtifact?.id && latestArtifact.id !== lastArtifactId.current;

    if (newChatMessage) {
      lastChatId.current = latestChat.id;
      expandLeftPane(); // show chat
    }

    if (newArtifact) {
      lastArtifactId.current = latestArtifact.id;
      collapseLeftPane(); // show artifact
    }
  }, [chatMessages, artifacts, isMobile, expandLeftPane, collapseLeftPane]);

  if (isMobile) {
    return (
      <div className={styles.mobileLayout}>
        <div className={styles.mobileArtifact}>
          <ArtifactView />
        </div>

        <div
          className={`${styles.mobileChatPanel} ${
            isLeftPaneExpanded
              ? styles.mobileChatExpanded
              : styles.mobileChatCollapsed
          }`}
        >
          <button
            onClick={collapseLeftPane}
            className={styles.mobileCloseButton}
            aria-label="Close chat"
          >
            <svg
              className={styles.mobileCloseIcon}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
          <div className={`${styles.mobileChatContent} overflow-y-auto h-full`}>
            <div className={styles.mobileMessagesOnly}>{children}</div>
          </div>
        </div>

        <div className={styles.mobileInputFixed} ref={inputRef}>
          <button
            onClick={toggleLeftPane}
            className={styles.mobileToggle}
            aria-label={isLeftPaneExpanded ? "Collapse chat" : "Expand chat"}
          >
            <svg
              className={`${styles.mobileChevron} ${
                isLeftPaneExpanded
                  ? styles.mobileChevronDown
                  : styles.mobileChevronUp
              }`}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M5 15l7-7 7 7"
              />
            </svg>
          </button>
          <div className="ml-6 w-full">
            <SendMessageInput />
          </div>
        </div>
      </div>
    );
  } else {
    return (
      <div className="flex h-screen overflow-hidden">
        <div
          className="flex flex-col"
          style={{ width: `${leftWidth}px`, minWidth: `${MIN_WIDTH}px` }}
        >
          <SplitViewContext.Provider
            value={{ containerWidth: leftWidth, isCompact }}
          >
            <main className="flex-grow overflow-hidden">{children}</main>
          </SplitViewContext.Provider>
        </div>
        <div
          className="w-1 bg-gray-200 cursor-col-resize"
          onMouseDown={startResize}
        />

        <div
          className="relative h-screen"
          style={{ width: `calc(100% - ${leftWidth}px)` }}
        >
          <div className="absolute w-full h-full">
            <ArtifactView />
          </div>
        </div>
      </div>
    );
  }
};

export default SplitViewLayout;
</file>

<file path="src/components/TagDisplay.module.scss">
.tagDisplay {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
  margin: 0.5rem 0;

  .title {
    font-weight: 600;
    color: #374151;
    font-size: 0.875rem;
  }

  .tagContainer {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background-color: #e5e7eb;
    color: #374151;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    transition: background-color 0.2s;

    &:hover {
      background-color: #d1d5db;
    }
  }
}
</file>

<file path="src/components/TagDisplay.tsx">
import React from 'react';
import styles from './TagDisplay.module.scss';

interface TagDisplayProps {
  tags: string[];
  title?: string;
}

const TagDisplay: React.FC<TagDisplayProps> = ({ tags, title }) => {
  return (
    <div className={styles.tagDisplay}>
      {title && <span className={styles.title}>{title}:</span>}
      <div className={styles.tagContainer}>
        {tags.map((tag, index) => (
          <span key={index} className={styles.tag}>
            {tag}
          </span>
        ))}
      </div>
    </div>
  );
};

export default TagDisplay;
</file>

<file path="src/components/TextInput.module.scss">
.textareaWrapper {
  opacity: 1 !important;
  background: var(--gradientTurquoise) !important;
  border-radius: 10px;
  margin: 0;
  padding: 0;

  @media (max-width: 767px) {
    width: calc(100% - 2rem);
    margin: 0 auto;
  }
}

.textareaWrapper:has(textarea:disabled) {
  opacity: 0.5 !important;
  pointer-events: none;
}
</file>

<file path="src/components/TextInput.tsx">
"use client";
import { useTranslations } from "next-intl";
import Image from "next/image";
import {
  useEffect,
  useImperativeHandle,
  useRef,
  useState,
  forwardRef,
} from "react";
import styles from "./TextInput.module.scss";

type TextInputProps = {
  inputEnabled: boolean;
  placeholder?: string;
  onSubmit: (text: string) => void;
};

export type TextInputRef = {
  focusInput: () => void;
};

const TextInput = forwardRef<TextInputRef, TextInputProps>(
  ({ inputEnabled, placeholder, onSubmit }, ref) => {
    const [typedText, setTypedText] = useState("");
    const textareaRef = useRef<HTMLTextAreaElement | null>(null);

    const t = useTranslations();

    useImperativeHandle(ref, () => ({
      focusInput: () => {
        textareaRef.current?.focus();
      },
    }));

    useEffect(() => {
      requestAnimationFrame(() => adjustHeight());
    });

    const submitMessage = () => {
      onSubmit(typedText);
      setTypedText("");
      requestAnimationFrame(() => adjustHeight());

      if (
        typeof window !== "undefined" &&
        window.mobileLayoutControls?.isMobile
      ) {
        window.mobileLayoutControls.collapseLeftPane();
      }
    };

    const adjustHeight = () => {
      const textarea = textareaRef.current;
      if (!textarea) return;
      textarea.style.height = "auto";
      textarea.style.overflowY = "hidden";
      const lineHeight =
        parseFloat(getComputedStyle(textarea).lineHeight) || 30;
      const maxHeight = lineHeight * 4;
      textarea.style.height = textarea.scrollHeight + "px";
      if (textarea.scrollHeight > maxHeight) {
        textarea.style.height = maxHeight + "px";
        textarea.style.overflowY = "auto";
      }
    };

    const handleFocus = () => {
      if (
        typeof window !== "undefined" &&
        window.mobileLayoutControls?.isMobile
      ) {
        window.mobileLayoutControls.expandLeftPane();
      }
    };

    return (
      <div className={`relative ${styles.textareaWrapper}`}>
        <textarea
          ref={textareaRef}
          className="rounded-xl relative min-w-64"
          name="chatInput"
          placeholder={placeholder || t("input_placeholder")}
          aria-disabled={!inputEnabled}
          disabled={!inputEnabled}
          required
          value={typedText}
          onChange={(e) => {
            setTypedText(e.target.value);
            adjustHeight();
          }}
          onKeyDown={(e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              submitMessage();
            }
          }}
          onFocus={handleFocus}
          rows={1}
          style={{
            lineHeight: "2em",
            maxHeight: "7em",
            overflow: "hidden",
          }}
        />
        <a
          href="#"
          onClick={(e) => {
            e.preventDefault();
            submitMessage();
          }}
        >
          <Image
            alt=""
            width="21"
            height="21"
            src="/assets/images/icon_paperplane.svg"
            className="absolute bottom-[1.1rem] right-4"
          />
        </a>
      </div>
    );
  }
);

TextInput.displayName = "TextInput";
export default TextInput;
</file>

<file path="src/context/AuthContext.tsx">
"use client";

import {
  createContext,
  useContext,
  useEffect,
  useState,
  ReactNode,
} from "react";
import {
  onAuthStateChanged,
  signInAnonymously,
  setPersistence,
  browserLocalPersistence,
  signOut as firebaseSignOut,
  signInWithEmailAndPassword as firebaseSignInWithEmailAndPassword,
  User,
} from "firebase/auth";
import { auth } from "@/lib/auth";

type AuthContextType = {
  user: User | null;
  loading: boolean;
  signOut: () => Promise<void>;
  signInWithEmail: (email: string, password: string) => Promise<void>;
};

const AuthContext = createContext<AuthContextType>({
  user: null,
  loading: true,
  signOut: async () => {},
  signInWithEmail: async () => {},
});

export const useAuth = () => useContext(AuthContext);

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const setupAuth = async () => {
      try {
        await setPersistence(auth, browserLocalPersistence);

        const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {
          try {
            if (firebaseUser) {
              setUser(firebaseUser);
            } else if (process.env.NEXT_PUBLIC_ALLOW_ANONYMOUS === "true") {
              const result = await signInAnonymously(auth);
              setUser(result.user);
            } else {
              setUser(null);
            }
          } catch (err) {
            console.error("Error during anonymous sign-in:", err);
          } finally {
            setLoading(false);
          }
        });

        return unsubscribe;
      } catch (err) {
        console.error("Auth setup error:", err);
        setLoading(false);
      }
    };

    const unsubscribePromise = setupAuth();

    return () => {
      unsubscribePromise.then((unsubscribe) => {
        if (typeof unsubscribe === "function") unsubscribe();
      });
    };
  }, []);

  const signOut = async () => {
    await firebaseSignOut(auth);
    setUser(null);
  };

  const signInWithEmail = async (email: string, password: string) => {
    const result = await firebaseSignInWithEmailAndPassword(
      auth,
      email,
      password
    );
    setUser(result.user);
  };

  if (loading) {
    return null;
  }

  return (
    <AuthContext.Provider
      value={{ user, loading: false, signOut, signInWithEmail }}
    >
      {children}
    </AuthContext.Provider>
  );
};
</file>

<file path="src/context/TaskContext.tsx">
"use client";

import {
  createContext,
  useContext,
  useState,
  useCallback,
  ReactNode,
} from "react";
import { Task } from "@/types/generic";

type TaskContextType = {
  tasks: Task[];
  currentTaskIndex: number;
  updateTasks: (tasks: Task[], index: number) => void;
};

const TaskContext = createContext<TaskContextType>({
  tasks: [],
  currentTaskIndex: 0,
  updateTasks: () => {},
});

export const useTaskContext = () => useContext(TaskContext);

export const TaskProvider = ({ children }: { children: ReactNode }) => {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [currentTaskIndex, setCurrentTaskIndex] = useState(0);

  const updateTasks = useCallback((newTasks: Task[], index: number) => {
    setTasks(newTasks);
    setCurrentTaskIndex(index);
  }, []);

  return (
    <TaskContext.Provider value={{ tasks, currentTaskIndex, updateTasks }}>
      {children}
    </TaskContext.Provider>
  );
};
</file>

<file path="src/domain/artifact.ts">
export interface ArtifactIdDictionary {
  [key: string]: any[];
}

export const parseArtifactPayload = <T>(
  payload: { [key: string]: unknown } | null | undefined
): T => {
  return typeof payload === "object" && payload !== null
    ? (payload as T)
    : ({} as T);
};
</file>

<file path="src/domain/constants.ts">
export enum ArtifactType {
  Markdown = "markdown",
  MarkdownEditor = "markdown_editor",
  JsonForm = "json_form",
  TaskInstruction = "task_instruction",
  TaskEvaluation = "task_evaluation",
  ChatTask = "chat_task",
  EvaluateAll = "evaluate_all",
}

export enum Role {
  AI = "ai",
  TOOL = "tool",
  HUMAN = "human",
  CUSTOM = "custom",
}
</file>

<file path="src/domain/conversation.ts">
import { ChatHistory, historyHistoryPost } from "@/client";
import { customClient } from "@/lib/api";

import { NetworkingError } from "@/types/generic";

export const getConversation = async (
  uuid: string
): Promise<ChatHistory | NetworkingError> => {
  try {
    const response = await historyHistoryPost({
      client: customClient,
      body: { thread_id: uuid },
    });
    if (!response.data) {
      return new NetworkingError(null, "No conversation returned");
    }
    return response.data;
  } catch (err: unknown) {
    const message = err instanceof Error ? err.message : "unknown error";
    return new NetworkingError(null, message);
  }
};
</file>

<file path="src/domain/custom-highlight.ts">
import { Mark } from '@tiptap/core';
import { EditorState, Transaction } from 'prosemirror-state';
import {
  Mark as ProseMirrorMark,
  Node as ProseMirrorNode,
} from 'prosemirror-model';

export interface CustomExtensionOptions {
  multicolor: boolean;
  onHighlight?: (selectedText: string) => void;
}

declare module '@tiptap/core' {
  interface Commands<ReturnType> {
    customExtension: {
      /**
       * Comments will be added to the autocomplete.
       */
      unsetAllHighlights: (someProp: unknown) => ReturnType;
      customHighlight: (color: string) => ReturnType;
    };
  }
}

const CustomHighlight = Mark.create<CustomExtensionOptions>({
  name: 'customHighlight',

  addOptions() {
    return {
      multicolor: false, // Optional: Add multicolor support like the Highlight extension
    };
  },

  addAttributes() {
    return {
      color: {
        default: null,
        parseHTML: (element) => element.getAttribute('data-color'),
        renderHTML: (attributes) => {
          if (!attributes.color) {
            return {};
          }

          return {
            'data-color': attributes.color,
            style: `background-color: ${attributes.color};`,
          };
        },
      },
    };
  },

  parseHTML() {
    return [
      {
        tag: 'mark[data-color]',
      },
    ];
  },

  renderHTML({ HTMLAttributes }) {
    return ['mark', HTMLAttributes, 0];
  },

  addCommands() {
    return {
      customHighlight:
        (color: string) =>
        ({ commands, editor }) => {
          const { from, to } = editor.state.selection;
          const selectedText = editor.state.doc.textBetween(from, to, ' ');

          // Dispatch the selected text for external handling
          if (this.options.onHighlight) {
            this.options.onHighlight(selectedText); // Pass the selected text to the Vue component
          }

          return commands.setMark(this.name, { color });
        },
      unsetAllHighlights:
        () =>
        ({
          state,
          dispatch,
        }: {
          state: EditorState;
          dispatch: ((tr: Transaction) => void) | undefined;
        }) => {
          const { doc, tr } = state; // Access the document and transaction

          // Traverse the document and remove all customHighlight marks
          doc.descendants((node: ProseMirrorNode, pos: number) => {
            if (node.isText && node.marks.length) {
              node.marks.forEach((mark: ProseMirrorMark) => {
                if (mark.type.name === 'customHighlight') {
                  tr.removeMark(pos, pos + node.nodeSize, mark.type);
                }
              });
            }
          });

          // Apply the transaction if any changes were made
          if (dispatch) {
            dispatch(tr);
            return true;
          }

          return false;
        },
    };
  },
});

export default CustomHighlight;
</file>

<file path="src/domain/custom-keymaping.ts">
import { Extension } from "@tiptap/core";
import { keymap } from "prosemirror-keymap";
import { EditorState, Transaction } from "prosemirror-state";

export const CodeBlockNewlineFix = Extension.create({
  name: "codeBlockNewlineFix",

  addProseMirrorPlugins() {
    return [
      keymap({
        Enter(
          state: EditorState,
          dispatch?: (tr: Transaction) => void
        ): boolean {
          const { $head } = state.selection;
          if ($head.parent.type.name === "codeBlock") {
            if (dispatch) {
              dispatch(state.tr.insertText("\n"));
            }
            return true;
          }
          return false;
        },
        "Shift-Enter"(
          state: EditorState,
          dispatch?: (tr: Transaction) => void
        ): boolean {
          const { $head } = state.selection;
          if ($head.parent.type.name === "codeBlock") {
            if (dispatch) {
              dispatch(state.tr.insertText("\n"));
            }
            return true;
          }
          return false;
        },
      }),
    ];
  },
});
</file>

<file path="src/domain/custom-math-block.ts">
// MathBlock.ts

import { Node, nodeInputRule, mergeAttributes } from "@tiptap/core";

export interface MathBlockOptions {
  /**
   * Callback to be called when a math block is inserted or parsed.
   */
  onInsert?: (formula: string) => void;
}

declare module "@tiptap/core" {
  interface Commands<ReturnType> {
    mathBlock: {
      /**
       * Inserts a mathBlock node with the specified formula.
       */
      setMathBlock: (formula: string) => ReturnType;
    };
  }
}

export const MathBlock = Node.create<MathBlockOptions>({
  name: "mathBlock",

  group: "block",

  // Removed 'atom: true' to allow proper block-level behavior
  // atom: true,

  addAttributes() {
    return {
      formula: {
        default: "",
      },
    };
  },

  parseHTML() {
    return [
      {
        tag: "div[data-block-math]",
        priority: 1000,
        getAttrs: (el) => {
          const element = el as HTMLElement;
          const formula = element.textContent?.trim() || "";
          return { formula };
        },
      },
      {
        tag: "p",
        priority: 1000,
        getAttrs: (el) => {
          const element = el as HTMLElement;
          const text = element.textContent?.trim() || "";

          const match = text.match(/^\$\$\s*([\s\S]+?)\s*\$\$$/);
          if (match) {
            const formula = match[1].trim();
            if (this.options.onInsert) {
              this.options.onInsert(formula);
            }
            return { formula };
          }

          return false; // Do not parse as MathBlock if no match
        },
      },
    ];
  },

  renderHTML({ node, HTMLAttributes }) {
    const merged = mergeAttributes(HTMLAttributes, {
      "data-block-math": "true",
    });
    return ["div", merged, node.attrs.formula];
  },

  addCommands() {
    return {
      setMathBlock:
        (formula: string) =>
        ({ commands }) => {
          return commands.insertContent({
            type: this.name,
            attrs: { formula },
          });
        },
    };
  },

  addInputRules() {
    return [
      nodeInputRule({
        find: /\$\$\s*([\s\S]+?)\s*\$\$/,
        type: this.type,
        getAttributes: (match) => {
          const formula = match[1].trim();
          if (this.options.onInsert) {
            this.options.onInsert(formula);
          }
          return { formula };
        },
      }),
    ];
  },
});

export default MathBlock;
</file>

<file path="src/domain/custom-tab-extension.ts">
import { Extension } from '@tiptap/core'

const TAB_CHAR = '\u0009';

export const CustomTabExtension = Extension.create({
  addKeyboardShortcuts() {
    return {
      Tab: () => {
        // Using the Tiptap chain/command API
        this.editor
          .chain()
          // If you also want to indent list items (optional):
          .sinkListItem('listItem')
          .command(({ tr }) => {
            // Insert 4 spaces at the current cursor position
            tr.insertText(TAB_CHAR)
            return true
          })
          .run()

        // Return true to stop the default behavior
        return true
      },
    }
  },
})
</file>

<file path="src/domain/markdown-service.ts">
import MarkdownIt from "markdown-it";
import TurndownService from "turndown";

// Convert markdown to HTML
export const formatMarkdownHtml = (text: string): string => {
  const md = new MarkdownIt();
  return md.render(text);
};

// Convert HTML to markdown
export const formatHtmlMarkdown = (html: string): string => {
  const turndownService = new TurndownService({
    bulletListMarker: "-",
  });

  // Optional: custom escaping of markdown syntax
  const markdownReplacements: [RegExp, string][] = [
    [/\\/g, "\\\\"],
    [/\*/g, "\\*"],
    [/^-/g, "\\-"],
    [/^\+ /g, "\\+ "],
    [/^(=+)/g, "\\$1"],
    [/^(#{1,6}) /g, "\\$1 "],
    [/`/g, "\\`"],
    [/^~~~/g, "\\~~~"],
    [/^>/g, "\\>"],
    [/_/g, "\\_"],
    [/^(\d+)\. /g, "$1\\. "],
  ];

  turndownService.escape = (text: string): string =>
    markdownReplacements.reduce(
      (result, [regex, replacement]) => result.replace(regex, replacement),
      text
    );

  return turndownService.turndown(html);
};

type MarkdownChunk =
  | { type: "markdown"; content: string }
  | { type: "code"; language: string; content: string };

export function splitMarkdownIntoChunks(markdown: string): MarkdownChunk[] {
  const chunks: MarkdownChunk[] = [];
  const codeBlockRegex = /```([^\s]*)\n([\s\S]*?)```/g;

  let lastIndex = 0;
  let match: RegExpExecArray | null;

  while ((match = codeBlockRegex.exec(markdown)) !== null) {
    const [fullMatch, lang = "", code] = match;
    const index = match.index;

    // Push the plain markdown before the code block
    if (index > lastIndex) {
      chunks.push({
        type: "markdown",
        content: markdown.slice(lastIndex, index),
      });
    }

    // Push the code block
    chunks.push({
      type: "code",
      language: lang,
      content: code,
    });

    lastIndex = index + fullMatch.length;
  }

  // Any remaining markdown after the last code block
  if (lastIndex < markdown.length) {
    chunks.push({
      type: "markdown",
      content: markdown.slice(lastIndex),
    });
  }

  return chunks;
}
</file>

<file path="src/domain/persistent-code-block.ts">
import { Extension } from "@tiptap/core";
import { Plugin, PluginKey, TextSelection } from "prosemirror-state";

export const PersistentCodeBlock = Extension.create({
  name: "persistentCodeBlock",

  addProseMirrorPlugins() {
    return [
      new Plugin({
        key: new PluginKey("persistentCodeBlock"),
        appendTransaction: (transactions, oldState, newState) => {
          const { doc } = newState;

          // if doc has no codeBlock anymore
          if (
            doc.childCount !== 1 ||
            doc.firstChild?.type.name !== "codeBlock"
          ) {
            const tr = newState.tr;

            const emptyCodeBlock = newState.schema.nodes.codeBlock.create(
              doc.firstChild?.attrs ?? {},
              []
            );

            tr.replaceWith(0, doc.content.size, emptyCodeBlock);

            tr.setSelection(TextSelection.create(tr.doc, 1));

            return tr;
          }

          return null;
        },
      }),
    ];
  },
});
</file>

<file path="src/i18n/navigation.ts">
import { createNavigation } from "next-intl/navigation";
import { routing } from "./routing";

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);
</file>

<file path="src/i18n/request.ts">
import { getRequestConfig } from "next-intl/server";
import { hasLocale } from "next-intl";
import { routing } from "./routing";

export default getRequestConfig(async ({ requestLocale }) => {
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;

  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default,
  };
});
</file>

<file path="src/i18n/routing.ts">
import { defineRouting } from "next-intl/routing";

export const routing = defineRouting({
  locales: ["en", "de", "ro", "it", "es"],
  defaultLocale: "de",
});
</file>

<file path="src/lib/hooks/useAuthGuard.ts">
"use client";

import { useEffect } from "react";
import { useRouter, usePathname } from "next/navigation";
import { useAuth } from "@/context/AuthContext";

export const useAuthGuard = () => {
  const router = useRouter();
  const pathname = usePathname();
  const { user, loading } = useAuth();

  useEffect(() => {
    if (loading) return;

    const onSignIn = pathname === "/signin";

    if (!user && !onSignIn) {
      router.replace("/signin");
      return;
    }

    if (user && onSignIn) {
      router.replace("/");
      return;
    }

    if (user) {
      router.replace("/");
    }
  }, [pathname, user, loading, router]);
};
</file>

<file path="src/lib/hooks/useLocale.ts">
"use client";

import { usePathname } from "next/navigation";

export const useLocale = (): string => {
  const pathname = usePathname();
  const locale = pathname?.split("/")?.[1] || "en";
  return locale;
};
</file>

<file path="src/lib/hooks/useNormalizedParam.ts">
import { useParams } from "next/navigation";

export const useNormalizedParam = (key: string): string | undefined => {
  const params = useParams();
  const value = params?.[key];
  if (Array.isArray(value)) return value[0];
  return typeof value === "string" ? value : undefined;
};
</file>

<file path="src/lib/auth.ts">
import { initializeApp } from "firebase/app";
import {
  getAuth,
  GoogleAuthProvider,
  signInAnonymously,
  signInWithPopup,
  signOut,
  type User,
} from "firebase/auth";
import config from "@/config";

export const firebaseApp = initializeApp(config.firebaseConfig);
export const auth = getAuth(firebaseApp);

const provider = new GoogleAuthProvider();

provider.setCustomParameters({
  hd: "deyan7.de",
});

export const googleSignIn = async (): Promise<User | null> => {
  try {
    const result = await signInWithPopup(auth, provider);
    const email = result.user.email;

    if (!email?.endsWith("@deyan7.de")) {
      console.error("Unauthorized domain:", email);
      await signOut(auth);
      return null;
    }

    return result.user;
  } catch (error) {
    console.error("Google Sign-In Error:", error);
    return null;
  }
};

export const ensureAnonymousUser = async (): Promise<void> => {
  if (!auth.currentUser) {
    await signInAnonymously(auth);
  }
};
</file>

<file path="src/lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/types/generic.ts">
export class NetworkingError {
  code: number | null;
  message: string;

  constructor(code: number | null, message: string) {
    this.code = code;
    this.message = message;
  }
}

export interface SourceDocument {
  id: string;
  filename: string;
  content: string;
  created?: Date;
  updated?: Date;
}

export interface Task {
  original_index: number;
  task_title: string;
  task_type: string;
  task_icon: string;
}
</file>

<file path="src/utils/asset.tsx">
export const getAssetImageUrl = (name: string): string => {
  return `/assets/images/${name}`;
};
</file>

<file path="src/middleware.ts">
import createMiddleware from "next-intl/middleware";
import { routing } from "./i18n/routing";

export default createMiddleware(routing);

export const config = {
  matcher: "/((?!api|trpc|_next|_vercel|.*\\..*).*)",
};
</file>

<file path=".dockerignore">
node_modules
.next
.dockerignore
Dockerfile
*.log
*.env
</file>

<file path=".env.example">
NEXT_PUBLIC_BACKEND_URL=https://hiring-agent-backend-staging-474483908861.europe-west3.run.app
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/app/globals.scss",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/lib/hooks"
  }
}
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    files: ["**/*.ts", "**/*.tsx"],
    rules: {
      "@typescript-eslint/no-explicit-any": "off",
    },
  },
];

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";
import createNextIntlPlugin from "next-intl/plugin";

const nextConfig: NextConfig = {
  output: "standalone",
};

const withNextIntl = createNextIntlPlugin();
export default withNextIntl(nextConfig);
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="Taskfile.yml">
version: '3'

tasks:
  docker:build:
    desc: Build Docker image for the project
    cmds:
      - docker compose build

  docker:up:
    desc: Start Docker containers
    cmds:
      - docker compose up -d

  docker:down:
    desc: Stop Docker containers
    cmds:
      - docker compose down

  docker:logs:
    desc: Show Docker container logs
    cmds:
      - docker compose logs -f

  docker:run:
    desc: Build and run Docker containers
    cmds:
      - task: docker:build
      - task: docker:up

  docker:restart:
    desc: Restart Docker containers
    cmds:
      - task: docker:down
      - task: docker:up

  docker:clean:
    desc: Clean up Docker containers, networks, and volumes
    cmds:
      - docker compose down -v --remove-orphans
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="src/app/[locale]/(main)/customer/page.tsx">
import { CustomerView } from "@/components/customer/CustomerView";

export default function CustomerPage() {
  return <CustomerView />;
}
</file>

<file path="src/app/[locale]/page.tsx">
"use client";

import Protected from "@/components/Protected";
import Dashboard from "@/components/Dashboard";

const DashboardPage: React.FC = () => {
  return (
    <Protected>
      <Dashboard />
    </Protected>
  );
};

export default DashboardPage;
</file>

<file path="src/components/laws/LawsDashboard.tsx">
'use client';

import { usePathname } from 'next/navigation';
import { Link } from '@/i18n/navigation';
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ReactNode } from 'react';

interface LawsDashboardProps {
  children: ReactNode;
}

export function LawsDashboard({ children }: LawsDashboardProps) {
  const pathname = usePathname();
  
  // Extract the current tab from pathname
  const isAcronymsPage = pathname.includes('/laws/acronyms');
  const currentTab = isAcronymsPage ? 'acronyms' : 'overview';

  return (
    <div className="container mx-auto py-6">
      <div className="mb-6">
        <h1 className="text-3xl font-bold mb-2">Gesetzes-Dashboard</h1>
        <p className="text-muted-foreground">
          Verwalten Sie Dokumente und Gesetzeskürzel
        </p>
      </div>

      <Tabs value={currentTab} className="mb-6">
        <TabsList className="grid w-full max-w-md grid-cols-2">
          <TabsTrigger value="overview" asChild>
            <Link href="/laws">Übersicht</Link>
          </TabsTrigger>
          <TabsTrigger value="acronyms" asChild>
            <Link href="/laws/acronyms">Gesetzeskürzel verwalten</Link>
          </TabsTrigger>
        </TabsList>
      </Tabs>

      <div>{children}</div>
    </div>
  );
}
</file>

<file path="src/components/laws/PflichtEditDialog.module.scss">
.dialogContent {
  max-width: 900px;
  max-height: 85vh;
  overflow-y: auto;
}

.dialogHeader {
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 1.5rem;
  position: relative;
}

.dialogTitle {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  padding-right: 3rem;
  line-height: 1.4;
  word-wrap: break-word;
  hyphens: auto;
}

.closeButton {
  position: absolute;
  top: 0;
  right: 0;
  padding: 0.5rem;
  min-width: auto;
  height: 2rem;
  width: 2rem;
}

.dialogBody {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.compactGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  padding: 1rem;
  background-color: #fafafa;
  border-radius: 0.5rem;
  border: 1px solid #e5e7eb;
}

.bottomRow {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.fieldGroupFullWidth {
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.fieldGroup {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.fieldLabel {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.fieldValue {
  font-size: 0.875rem;
  color: #1f2937;
  line-height: 1.5;
  word-break: break-word;
}

.fieldInput {
  font-size: 0.875rem;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  background-color: white;
  width: 100%;
  box-sizing: border-box;
  
  &:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
}

.textarea {
  font-size: 0.875rem;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  background-color: white;
  resize: vertical;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  min-height: 60px;
  
  &:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
}

.iconValue {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.loadingContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  text-align: center;
}

.loadingSpinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  text-align: center;
}

.errorIcon {
  width: 3rem;
  height: 3rem;
  color: #ef4444;
  margin-bottom: 1rem;
}

.errorMessage {
  color: #ef4444;
  margin-bottom: 1rem;
  font-weight: 500;
}

.actions {
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
  margin-top: 1rem;
}

.actionButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

// Responsive design
@media (max-width: 768px) {
  .dialogContent {
    max-width: 95vw;
    max-height: 95vh;
  }

  .dialogHeader {
    padding-bottom: 0.75rem;
    margin-bottom: 1rem;
  }

  .dialogTitle {
    font-size: 1.125rem;
  }

  .dialogBody {
    gap: 1.5rem;
  }

  .compactGrid {
    grid-template-columns: 1fr;
    gap: 1rem;
    padding: 0.75rem;
  }


  .fieldLabel {
    font-size: 0.8125rem;
  }

  .fieldInput {
    font-size: 0.8125rem;
  }

  .textarea {
    font-size: 0.8125rem;
  }

  .actions {
    flex-direction: column;
    gap: 0.5rem;
  }

  .actionButton {
    width: 100%;
    justify-content: center;
  }
}
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
        destructive:
          "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-rose-100 hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="src/components/ui/dialog.tsx">
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-white data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="src/components/ArtifactActionButton.tsx">
"use client";

import styles from "./ArtifactActionButton.module.scss";

type Props = {
  label: string;
  disabled: boolean;
  onAction: () => void;
  isLoading?: boolean;
};

const ArtifactActionButton = ({
  label,
  disabled,
  onAction,
  isLoading = false,
}: Props) => {
  const showLoading = isLoading;

  return (
    <div className="relative z-[2] mb-[10px] w-full">
      <div className="mx-auto container text-center">
        <button
          className="action-btn mb-3 pt-3 pb-4 w-full rounded-xl disabled:opacity-50"
          disabled={disabled || showLoading || !label}
          aria-disabled={disabled || showLoading}
          onClick={onAction}
        >
          {showLoading ? (
            <span className={styles.loadingDots}>
              <span></span>
              <span></span>
              <span></span>
            </span>
          ) : (
            label
          )}
        </button>
      </div>
    </div>
  );
};

export default ArtifactActionButton;
</file>

<file path="src/components/ArtifactForm.tsx">
"use client";

import {
  useEffect,
  useImperativeHandle,
  useMemo,
  useRef,
  useState,
  forwardRef,
} from "react";

import { JsonForms } from "@jsonforms/react";
import { vanillaRenderers, vanillaCells } from "@jsonforms/vanilla-renderers";
import { formatMarkdownHtml } from "@/domain/markdown-service";

type Props = {
  artifact: any;
  onModified: (val: any) => void;
};

export type ArtifactFormRef = {
  getUpdatedArtifact: () => any;
};

const ArtifactForm = forwardRef<ArtifactFormRef, Props>(
  ({ artifact, onModified }, ref) => {
    const stableString = useMemo(() => {
      return typeof artifact.content === "string"
        ? artifact.content
        : JSON.stringify(artifact.content ?? {});
    }, [artifact.content]);

    const parsedContent = useMemo(() => {
      try {
        return JSON.parse(stableString);
      } catch {
        return {};
      }
    }, [stableString]);

    const payloadArray = parsedContent.payload;
    const markdown = parsedContent.content ?? "";

    const { schema, uischema, initialData } = useMemo(() => {
      if (!Array.isArray(payloadArray)) {
        return {
          schema: { type: "object", properties: {} },
          uischema: { type: "Group", elements: [] },
          initialData: {},
        };
      }

      const properties: Record<string, any> = {};
      const uiElements: any[] = [];
      const formData: Record<string, any> = {};

      for (const field of payloadArray) {
        // Unpack all potential properties from the backend payload
        const { key, type, title, enum: enumVals, uischema, data, format } = field;

        if (!key) continue;

        // Build the schema property for this field
        properties[key] = {
          type,
          title,
          // FIX: Include the 'format' property if it exists (for date-pickers)
          ...(format && { format }),
          ...(enumVals && { enum: enumVals }),
        };

        // Build the UI schema element for this field
        if (uischema) {
          uiElements.push({
            type: "Control",
            scope: `#/properties/${key}`,
            // FIX: Pass through all options from the backend directly
            // This allows for things like multi-line text areas, radios, etc.
            ...(uischema.options && { options: uischema.options }),
          });
        }

        // Set the initial form data for this field
        formData[key] = data ?? "";
      }

      return {
        schema: {
          type: "object",
          properties,
        },
        uischema: {
          type: "Group",
          elements: uiElements,
        },
        initialData: formData,
      };
    }, [payloadArray]);

    const [formData, setFormData] = useState(initialData);
    const originalData = useRef(JSON.stringify(initialData));

    const buildUpdatedArtifact = (): any => ({
      ...artifact,
      payload: {
        schema,
        uischema,
        data: formData,
      },
      version: (artifact.version ?? 0) + 1,
    });

    useImperativeHandle(ref, () => ({
      getUpdatedArtifact: () => buildUpdatedArtifact(),
    }));

    useEffect(() => {
      const isModified = JSON.stringify(formData) !== originalData.current;
      if (isModified) {
        onModified(buildUpdatedArtifact());
      } else {
        onModified(null);
      }
    }, [formData]); // eslint-disable-line react-hooks/exhaustive-deps

    useEffect(() => {
      setFormData(initialData);
      originalData.current = JSON.stringify(initialData);
    }, [initialData]);

    const handleChange = ({ data }: { data: Record<string, unknown> }) => {
      setFormData(data);
    };

    return (
      <div className="flex-grow overflow-y-auto">
        {markdown && (
          <div
            className="markdown-chat mb-10"
            dangerouslySetInnerHTML={{
              __html: formatMarkdownHtml(markdown),
            }}
          />
        )}

        <JsonForms
          data={formData}
          schema={schema}
          uischema={uischema}
          cells={vanillaCells}
          renderers={vanillaRenderers}
          onChange={handleChange}
          config={{ validationMode: "NoValidation", useDefaults: true }}
        />
      </div>
    );
  }
);

ArtifactForm.displayName = "ArtifactForm";
export default ArtifactForm;
</file>

<file path="src/components/ArtifactLoading.module.scss">
.linkOrange {
  color: var(--rosewood);
  font-weight: 700;

  &::after {
    content: attr(data-icon);
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    display: inline-block;
    text-align: center;
    line-height: 30px;
    margin-left: 10px;
    transition: margin-left 300ms ease 0ms;
  }

  &:hover::after {
    margin-left: 15px;
  }
}
</file>

<file path="src/components/ArtifactTimeline.module.scss">
.artifactTimeline {
  position: relative;
  background-color: var(--artifact-bg);
  z-index: 10;
  
  &::before {
    height: 1px;
    width: 100%;
    content: "";
    position: absolute;
    top: calc(50% - 0.5px);
    background-color: #747f9e;
    z-index: 1;
  }
  
  .artifactTimelineBubbles {
    width: 100%;
  }
  
  .timelineItem {
    width: 38px;
    height: 38px;
    border-radius: 30px;
    border: 1px solid #747f9e;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #F5F5F5 !important;
    z-index: 10;
    padding: 0.4rem;
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative;
    
    img {
      filter: invert(49%) sepia(9%) saturate(262%) hue-rotate(183deg);
      transition: filter 0.3s ease;
    }
    
    &.timelineDone {
      border: 2px solid var(--red-crayola);
      background-color: #FAFAFA !important;
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
    
    &.timelineActive {
      width: 55px !important;
      height: 55px !important;
      border: 2px solid var(--red-crayola);
      padding: 0.65rem !important;
      background-color: var(--melon) !important;
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1) !important;
      
      &::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background: linear-gradient(45deg, rgba(232, 76, 90, 0.3), rgba(246, 189, 182, 0.2), rgba(232, 76, 90, 0.3)) !important;
        background-size: 200% 200%;
        z-index: 0;
        animation: backgroundShift 6s ease-in-out infinite;
        opacity: 0.3;
      }
      
      &::after {
        content: '';
        position: absolute;
        inset: -3px;
        border-radius: 50%;
        background: conic-gradient(from 0deg, transparent 0deg, var(--red-crayola) 90deg, transparent 180deg, var(--melon) 270deg, transparent 360deg);
        z-index: -1;
        animation: rotateRing 8s linear infinite;
        opacity: 0.3;
      }
      
      img {
        filter: invert(80%) sepia(9%) saturate(262%) hue-rotate(183deg);
        position: relative;
        z-index: 1;
        animation: iconPulse 4s ease-in-out infinite;
      }
    }
  }
}

@keyframes backgroundShift {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

@keyframes rotateRing {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@keyframes iconPulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.9;
    transform: scale(0.98);
  }
}

#artifactTimelineProgressContainer {
  width: calc(100% - 5rem);
  height: 2px;
  position: absolute;
  z-index: 5;
}

#artifactTimelineProgress {
  height: 2px;
  background: linear-gradient(90deg, var(--red-crayola), var(--melon));
  top: calc(50% - 1px);
  transition: width 0.5s ease-in-out;
}
</file>

<file path="src/components/ArtifactView.module.scss">
.artifactContainer {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%;
  overflow: hidden;
  position: relative;
}

.artifactContent {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;

  // Firefox scrollbar
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-color) transparent;

  // WebKit scrollbar
  &::-webkit-scrollbar {
    width: 12px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-color);
    border: 3px solid transparent;
    border-radius: 10px;
    background-clip: padding-box;
  }
}

.artifactInnerContent {
  display: flex;
  flex-direction: column;
  margin-bottom: 50px;
  margin-top: 60px;
}

.fadeIn {
  position: absolute;
  top: 50px;
  left: 0;
  width: calc(100% - 30px);
  height: 60px;
  pointer-events: none;
  background: linear-gradient(
    to bottom,
    #F5F5F5,
    rgba(245, 245, 245, 0)
  );
  z-index: 1;
}

.fadeOut {
  position: absolute;
  bottom: 80px;
  left: 0;
  width: calc(100% - 30px);
  height: 60px;
  pointer-events: none;
  background: linear-gradient(
    to top,
    #F5F5F5,
    rgba(245, 245, 245, 0)
  );
  z-index: 1;
}

.artifactActionFooter {
  position: relative;
  z-index: 2;
  margin-bottom: 10px;
}

.artifact {
  background-color: var(--artifact-bg);
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-color) transparent;

  &::-webkit-scrollbar {
    width: 12px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-color);
    border: 3px solid transparent;
    border-radius: 10px;
    background-clip: padding-box;
  }
}

.notification {
  position: absolute;
  bottom: 4rem;
  right: 1rem;
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  transition: opacity 0.3s ease;
}

.formLoadingPlaceholder {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 16px 0;
  opacity: 0.4; /* fade everything together */
  filter: grayscale(100%); /* turn all colors to gray */
}

.shimmerBlock {
  height: 2.5rem; /* match your input height */
  width: 100%;
  background: linear-gradient(to right, #e0e0e0 0%, #f8f8f8 50%, #e0e0e0 100%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 6px;
}

.shimmerBlock.short {
  width: 60%;
}

@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}
</file>

<file path="src/components/ArtifactView.tsx">
"use client";

import { useEffect, useRef, useState, useMemo } from "react";
import ArtifactEval from "./ArtifactEval";
import ArtifactForm from "./ArtifactForm";
import ArtifactHeader from "@/components/ArtifactHeader";
import ArtifactActionButton from "@/components/ArtifactActionButton";
import { ArtifactType } from "@/domain/constants";
import clsx from "clsx";
import { useAuth } from "@/context/AuthContext";
import { useTaskContext } from "@/context/TaskContext";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";
import { useNormalizedParam } from "@/lib/hooks/useNormalizedParam";
import { useMediaQuery } from "react-responsive";

import styles from "./ArtifactView.module.scss";
import ArtifactMarkdown from "./ArtifactMarkdown";

const ArtifactView = () => {
  const { user, loading } = useAuth();

  const isMobile = useMediaQuery({ query: "(max-width: 767px)" });
  const [isActionLoading, setIsActionLoading] = useState(false);
  const [updatedArtifact, setUpdatedArtifact] = useState<any>(null);

  const {
    artifacts: streamedArtifacts,
    chatMessages,
    sendMessage,
    clearArtifacts,
  } = useAgentStreamContext();

  const lastMessage = chatMessages.at(-1);
  const nextCommand = (lastMessage?.meta?.available_commands as any[])?.[0];
  const conversationUuid = useNormalizedParam("conversationId") as string;

  const scrollAnchorRef = useRef<HTMLDivElement | null>(null);
  const artifactScrollRef = useRef<HTMLDivElement | null>(null);

  const { tasks: taskSummary, currentTaskIndex } = useTaskContext();

  const latestArtifact = streamedArtifacts.at(-1);

  const parsedContent = useMemo(() => {
    try {
      if (typeof latestArtifact?.content === "string") {
        const trimmed = latestArtifact.content.trim();
        const isLikelyJson =
          (trimmed.startsWith("{") && trimmed.endsWith("}")) ||
          (trimmed.startsWith("[") && trimmed.endsWith("]"));
        if (isLikelyJson) {
          try {
            return JSON.parse(trimmed);
          } catch {
            return trimmed;
          }
        }
      }
      return latestArtifact?.content ?? {};
    } catch {
      return {};
    }
  }, [latestArtifact]);

  const artifactType: ArtifactType | undefined =
    latestArtifact?.type ||
    parsedContent.artifact_type ||
    parsedContent.task_type;

  const ArtifactComponent = selectArtifactComponent(artifactType);

  const normalizedArtifact: any = useMemo(
    () => ({
      ...(latestArtifact || {}),
      type: artifactType,
      title:
        latestArtifact?.title ||
        parsedContent.artifact_title ||
        parsedContent.task_title,
      payload:
        parsedContent.payload ||
        parsedContent.artifact_content ||
        parsedContent.task_content?.content ||
        (typeof parsedContent === "string" ? parsedContent : ""),
      status: latestArtifact?.status,
    }),
    [latestArtifact, artifactType, parsedContent]
  );

  const renderedArtifact = useMemo(() => {
    if (!latestArtifact) return null;

    if (
      normalizedArtifact.type === "json_form" &&
      normalizedArtifact.status === "streaming"
    ) {
      return (
        <div className={styles.formLoadingPlaceholder}>
          <div className={styles.shimmerBlock} />
          <div className={`${styles.shimmerBlock} ${styles.short}`} />
          <div className={styles.shimmerBlock} />
          <div className={`${styles.shimmerBlock} ${styles.short}`} />
        </div>
      );
    }

    return (
      <ArtifactComponent
        artifact={normalizedArtifact}
        onModified={setUpdatedArtifact}
      />
    );
  }, [latestArtifact, normalizedArtifact, ArtifactComponent]);

  useEffect(() => {
    const anchor = scrollAnchorRef.current;
    const container = artifactScrollRef.current;
    if (anchor && container) {
      anchor.scrollIntoView({ behavior: "smooth", block: "end" });
    }
  }, [renderedArtifact]);

  const onAction = async () => {
    if (loading || !user) return;
    const updated = updatedArtifact || normalizedArtifact;
    if (!updated) return;

    const token = await user.getIdToken();
    setIsActionLoading(true);
    if (nextCommand?.name === "CMD_SUBMIT_TASK_WITH_ARTIFACT") {
      clearArtifacts();
    }
    await sendMessage(
      {
        thread_id: conversationUuid,
        user_id: user.uid,
        model: "gpt-4o-mini",
        stream_tokens: true,
        message: "",
        agent_id: "kireon-agent",
        agent_config: {
          command_id: nextCommand?.id,
          artifact_content: updated,
        },
      },
      token
    );
    setIsActionLoading(false);
  };

  return (
    <div
      className={clsx(
        styles.artifact,
        "h-full flex flex-col overflow-hidden relative"
      )}
    >
      <div className={clsx(isMobile ? "mobile-header" : "")}>
        <ArtifactHeader
          tasks={taskSummary}
          currentTaskIndex={currentTaskIndex}
        />
      </div>

      <div className={styles.artifactContainer}>
        <div className={styles.fadeIn} />
        <div
          className={clsx(
            styles.artifactContent,
            "pt-[30px] overflow-y-auto h-full"
          )}
          ref={artifactScrollRef}
        >
          <div className={clsx(styles.artifactInnerContent, "pl-10 pr-10")}>
            {renderedArtifact}
            <div ref={scrollAnchorRef} />
          </div>
        </div>
        <div className={styles.fadeOut} />
        <div className={clsx(styles.artifactActionFooter, "pl-10 pr-10")}>
          <ArtifactActionButton
            label={nextCommand?.label}
            onAction={onAction}
            disabled={loading || isActionLoading}
          />
        </div>
      </div>
    </div>
  );
};

function selectArtifactComponent(artifactType?: ArtifactType) {
  switch (artifactType) {
    case ArtifactType.JsonForm:
      return ArtifactForm;
    case ArtifactType.Markdown:
    case ArtifactType.MarkdownEditor:
    case ArtifactType.TaskInstruction:
    case ArtifactType.ChatTask:
      return ArtifactMarkdown;
    case ArtifactType.TaskEvaluation:
    case ArtifactType.EvaluateAll:
      return ArtifactEval;
    default:
      return ArtifactMarkdown;
  }
}

export default ArtifactView;
</file>

<file path="src/components/ChatMessage.module.scss">
.chatMessage {
  &.user {
    background-color: var(--melon);
    color: var(--rosewood-dark);
    padding: 0 1rem 0.25rem;
    margin: 1rem 1rem 2rem;
    max-width: 70%;
    border-radius: 1rem;
  }
}
</file>

<file path="src/components/ConversationChat.tsx">
import { useState, useRef, useEffect } from "react";
import { useSearchParams } from "next/navigation";
import ChatMessage from "@/components/ChatMessage";
import ScrollDownButton from "@/components/ScrollDownButton";
import SendMessageInput, {
  SendMessageInputRef,
} from "@/components/SendMessageInput";
import { formatMarkdownHtml } from "@/domain/markdown-service";

import styles from "./ConversationChat.module.scss";

import { useNormalizedParam } from "@/lib/hooks/useNormalizedParam";
import { Role } from "@/domain/constants";
import { getConversation } from "@/domain/conversation";
import { useAuth } from "@/context/AuthContext";
import { User } from "firebase/auth";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";
import { NetworkingError } from "@/types/generic";
import { useMediaQuery } from "react-responsive";

const ConversationChat = () => {
  const isMobile = useMediaQuery({ query: "(max-width: 767px)" });

  const hasInitialized = useRef(false);

  const conversationUuid = useNormalizedParam("conversationId") as string;

  const lastMessageId = useRef<string | null>(null);

  const [isScrolledToBottom, setIsScrolledToBottom] = useState(true);
  const chatContentRef = useRef<HTMLDivElement>(null);

  const [isLoading, setIsLoading] = useState(false);
  const userRef = useRef<User | null>(null);

  const sendMessageInput = useRef<SendMessageInputRef | null>(null);

  const { sendMessage, isStreaming, chatMessages, error, loadHistory } =
    useAgentStreamContext();

  const { user } = useAuth();

  const searchParams = useSearchParams();

  useEffect(() => {
    userRef.current = user;
  }, [user]);

  function startUpdateScrollBottomRef() {
    const chatContentValue = chatContentRef.current;
    if (chatContentValue) {
      chatContentValue.onscroll = () => {
        setIsScrolledToBottom(
          chatContentValue.scrollTop + chatContentValue.clientHeight >=
            chatContentValue.scrollHeight - 600
        );
      };
    }
  }

  useEffect(() => {
    const newestMessage = chatMessages.at(-1);
    const id = newestMessage?.id;

    if (!id || id === lastMessageId.current || !isScrolledToBottom) return;

    lastMessageId.current = id;
    scrollToBottom("smooth");
  }, [chatMessages, isScrolledToBottom]);

  useEffect(() => {
    if (hasInitialized.current) return;
    hasInitialized.current = true;

    const initialize = async () => {
      setIsLoading(true);

      try {
        const conversation = await getConversation(conversationUuid);
        if (!conversation) throw new Error("Conversation not found");
        if (conversation instanceof NetworkingError) {
          throw new Error("Not history found");
        }
        loadHistory(conversation.messages);
      } catch {
        try {
          if (!user) throw new Error("User not ready");

          const token = await user.getIdToken();

          await sendMessage(
            {
              thread_id: conversationUuid,
              user_id: user.uid,
              model: "gpt-4o-mini",
              stream_tokens: true,
              message: "",
              agent_id: "kireon-agent",
              agent_config: {
                require_email:
                  searchParams.get("requireEmail")?.toLowerCase() === "true",
                email: user?.email ?? "",
              },
            },
            token
          );
        } catch (streamError) {
          console.warn("Stream error:", streamError);
        }
      } finally {
        setIsLoading(false);
        setTimeout(() => scrollToBottom("instant"), 0);
        startUpdateScrollBottomRef();
      }
    };

    initialize();

    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const scrollToBottom = (behavior: ScrollBehavior = "smooth") => {
    chatContentRef.current?.scrollTo({
      left: 0,
      top: chatContentRef.current.scrollHeight,
      behavior: behavior,
    });
  };

  return (
    <div className={styles.chatContainer}>
      <div className={styles.messagesWrapper} ref={chatContentRef}>
        <div className={styles.messagesContent}>
          {chatMessages.map((message) => (
            <div key={`${message.id}`} className="w-full flex justify-end">
              <ChatMessage
                role={message.role as Role}
                message={message}
                isStartScreen={false}
                isLoadingArtifact={false}
              >
                <div
                  className="markdown-chat text-black text-lg"
                  dangerouslySetInnerHTML={{
                    __html: formatMarkdownHtml(message.content ?? ""),
                  }}
                />
              </ChatMessage>
            </div>
          ))}

          {error && (
            <div className="text-center">
              <input
                className="container"
                type="text"
                placeholder={error}
                aria-invalid
                readOnly
              />
            </div>
          )}
          {isStreaming && (
            <ChatMessage
              role={Role.AI}
              aria-busy={isLoading}
              isStartScreen={false}
              isLoadingArtifact={false}
            />
          )}
        </div>
      </div>

      <div className={styles.inputWrapper}>
        {!isScrolledToBottom && (
          <div className={styles.scrollButtonContainer}>
            <ScrollDownButton onClick={scrollToBottom} />
          </div>
        )}
        {!isMobile && <SendMessageInput ref={sendMessageInput} />}
      </div>
    </div>
  );
};

export default ConversationChat;
</file>

<file path="src/components/Dashboard.module.scss">
.dashboardContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 3rem;
  background: #f8f9fa;
  min-height: 100vh;
}

.header {
  text-align: center;
  margin-bottom: 4rem;

  .logoContainer {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0;
    letter-spacing: -0.025em;
  }

  p {
    margin-top: 0.5rem;
    font-size: 1.125rem;
    color: #6b7280;
    font-weight: 400;
  }
}

.tileGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  width: 100%;
  max-width: 1000px;
}

.tile {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 2rem;
  border-radius: 16px;
  background: white;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-align: center;
  text-decoration: none;
  color: inherit;
  border: 2px solid transparent;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: #dc2626;
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  &:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border-color: #dc2626;

    &::before {
      transform: scaleX(1);
    }

    h3 {
      color: #dc2626;
    }
  }

  h3 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: #1f2937;
    transition: color 0.3s ease;
  }
}
</file>

<file path="src/components/ScrollDownButton.module.scss">
.textOrange {
  color: var(--rosewood);
}
</file>

<file path="src/components/SendMessageInput.tsx">
"use client";

import { forwardRef, useImperativeHandle, useRef } from "react";
import { useTranslations } from "next-intl";
import { useMediaQuery } from "react-responsive";
import TextInput, { TextInputRef } from "./TextInput";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";
import { useNormalizedParam } from "@/lib/hooks/useNormalizedParam";
import { useAuth } from "@/context/AuthContext";
import LegalLinks from "./LegalLinks";
import { useSplitViewContext } from "./SplitView";

type Props = {
  placeholder?: string;
};

export type SendMessageInputRef = {
  focusInput: () => void;
};

const SendMessageInput = forwardRef<SendMessageInputRef, Props>(
  ({ placeholder }, ref) => {
    const conversationUuid = useNormalizedParam("conversationId") as string;
    const { sendMessage, isStreaming } = useAgentStreamContext();
    const { user, loading } = useAuth();
    const textInputRef = useRef<TextInputRef>(null);
    const { isCompact } = useSplitViewContext();

    const isMobile = useMediaQuery({ query: "(max-width: 767px)" });

    const t = useTranslations();

    useImperativeHandle(ref, () => ({
      focusInput: () => {
        textInputRef.current?.focusInput();
      },
    }));

    const handleSubmit = async (message: string) => {
      if (!user || loading) {
        console.warn("User not authenticated yet.");
        return;
      }

      const token = await user.getIdToken();

      await sendMessage(
        {
          thread_id: conversationUuid,
          user_id: user.uid,
          model: "gpt-4o-mini",
          stream_tokens: true,
          message: message,
          agent_id: "kireon-agent",
        },
        token
      );
    };

    return (
      <div className="container text-center mb-2 mt-1 px-0 md:px-8">
        <div className="relative mb-2">
          <TextInput
            ref={textInputRef}
            inputEnabled={!isStreaming}
            placeholder={placeholder}
            onSubmit={handleSubmit}
          />
        </div>
        <div className="flex flex-wrap justify-center sm:justify-between items-center gap-x-4 gap-y-1 text-[0.6rem] text-gray-400">
          <span
            className={`${
              isMobile
                ? "hidden min-[480px]:inline"
                : isCompact
                ? "hidden"
                : "inline"
            } sm:text-left`}
          >
            {t("llm_disclaimer")}
          </span>
          <span
            className={`${
              isMobile
                ? "inline min-[480px]:hidden text-center"
                : isCompact
                ? "inline text-center"
                : "hidden"
            }`}
          >
            {t("llm_disclaimer_short")}
          </span>
          <LegalLinks className="shrink-0" />
        </div>
      </div>
    );
  }
);

SendMessageInput.displayName = "SendMessageInput";
export default SendMessageInput;
</file>

<file path="src/components/Sidebar.tsx">
"use client";

import { useState } from "react";
import { useTranslations } from "next-intl";
import { Link, usePathname } from "@/i18n/navigation";
import clsx from "clsx";
import styles from "./Sidebar.module.scss";
import {
  DocumentTextIcon,
  UsersIcon,
  DocumentArrowDownIcon,
  ChevronDoubleLeftIcon,
  ChevronDoubleRightIcon,
} from "@heroicons/react/24/outline";

const Sidebar = () => {
  const [isCollapsed, setIsCollapsed] = useState(true);
  const t = useTranslations("sidebar");
  const pathname = usePathname();

  const navItems = [
    {
      href: "/laws",
      label: t("laws"),
      icon: DocumentTextIcon,
      isActive: (path: string) => path === "/laws",
    },
    {
      href: "/customer",
      label: t("customer"),
      icon: UsersIcon,
      isActive: (path: string) => path === "/customer",
    },
    {
      href: "/laws/reports",
      label: t("reports"),
      icon: DocumentArrowDownIcon,
      isActive: (path: string) => path === "/laws/reports",
    },
  ];

  return (
    <nav className={clsx(styles.sidebar, isCollapsed && styles.collapsed)}>
      <div className={styles.sidebarContent}>
        <ul className={styles.navList}>
          {navItems.map((item) => {
            const Icon = item.icon;
            return (
              <li key={item.href}>
                <Link
                  href={item.href}
                  className={clsx(
                    styles.navLink,
                    item.isActive(pathname) && styles.active
                  )}
                >
                  <Icon className={styles.navIcon} />
                  <span className={styles.navLabel}>{item.label}</span>
                </Link>
              </li>
            );
          })}
        </ul>
      </div>
      <button
        onClick={() => setIsCollapsed(!isCollapsed)}
        className={styles.toggleButton}
        title={isCollapsed ? "Expand Sidebar" : "Collapse Sidebar"}
      >
        {isCollapsed ? (
          <ChevronDoubleRightIcon className="h-5 w-5" />
        ) : (
          <ChevronDoubleLeftIcon className="h-5 w-5" />
        )}
      </button>
    </nav>
  );
};

export default Sidebar;
</file>

<file path="src/components/SignIn.module.scss">
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes inputFocusGlow {
  0% { box-shadow: 0 0 0 0 rgba(232, 76, 90, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(232, 76, 90, 0); }
  100% { box-shadow: 0 0 0 0 rgba(232, 76, 90, 0); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.logoSection {
  animation: fadeInUp 0.8s ease-out;
}

.logo {
  animation: logoFloat 4s ease-in-out infinite;
  filter: drop-shadow(0 10px 30px rgba(232, 76, 90, 0.3));
  transition: transform 0.3s ease, filter 0.3s ease;

  &:hover {
    transform: scale(1.05);
    filter: drop-shadow(0 15px 40px rgba(232, 76, 90, 0.5));
  }

  @media (max-width: 767px) {
    width: 70px !important;
    height: 70px !important;
  }
}

.contentContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5rem;
  max-width: 565px;
  width: 50%;
  
  @media (max-width: 767px) {
    width: 90%;
    gap: 3rem;
  }
}

.formSection {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.formWrapper {
  animation: fadeInUp 0.8s ease-out 0.2s both;
  width: 100%;
}

.inputWrapper {
  position: relative;
}

.input {
  border: 2px solid rgba(232, 76, 90, 0.2) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  height: auto !important;
  margin: 0 !important;

  &::placeholder {
    color: var(--grey) !important;
    transition: color 0.3s ease !important;
  }

  &:hover:not(:disabled) {
    border-color: rgba(232, 76, 90, 0.4) !important;
    
    &::placeholder {
      color: rgba(255, 255, 255, 0.6) !important;
    }
  }

  &:focus {
    outline: none !important;
    border-color: var(--red-crayola) !important;
    box-shadow: 0 0 0 4px rgba(232, 76, 90, 0.1) !important;
    animation: inputFocusGlow 0.75s ease !important;

    &::placeholder {
      color: rgba(255, 255, 255, 0.7) !important;
    }
  }

  &:disabled {
    opacity: 0.6 !important;
    cursor: not-allowed !important;
    border-color: rgba(232, 76, 90, 0.1) !important;
  }
}

.inputError {
  border-color: #ff5757 !important;
  box-shadow: 0 0 0 4px rgba(255, 87, 87, 0.1) !important;
  background: linear-gradient(135deg, rgba(255, 87, 87, 0.15), rgba(255, 87, 87, 0.08)) !important;
  
  &:focus {
    border-color: #ff5757 !important;
    box-shadow: 0 0 0 4px rgba(255, 87, 87, 0.2) !important;
    background: linear-gradient(135deg, rgba(255, 87, 87, 0.2), rgba(255, 87, 87, 0.1)) !important;
  }
  
  &:hover:not(:disabled) {
    border-color: #ff5757 !important;
    background: linear-gradient(135deg, rgba(255, 87, 87, 0.18), rgba(255, 87, 87, 0.1)) !important;
  }
}

.shake {
  animation: shake 0.6s ease-in-out;
}

.passwordToggle {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--grey);
  cursor: pointer;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  opacity: 0.7;
  border-radius: 6px;

  &:hover {
    color: var(--red-crayola);
    opacity: 1;
    background: rgba(232, 76, 90, 0.1);
  }

  &:focus {
    outline: none;
    color: var(--red-crayola);
    opacity: 1;
  }

  @media (max-width: 767px) {
    right: 0.75rem;
    padding: 0.375rem;
  }
}

.errorContainer {
  width: 100%;
  height: 60px;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  margin-top: 1rem;
  z-index: 10;
}

.errorMessage {
  color: #ff5757;
  font-size: 0.875rem;
  margin: 0;
  padding: 0.75rem 1rem;
  background: rgba(255, 87, 87, 0.1);
  border-radius: 6px;
  border-left: 3px solid #ff5757;
  text-align: center;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 87, 87, 0.2);
  animation: fadeInUp 0.3s ease-out;
  width: 100%;
  max-width: 565px;
}
</file>

<file path="src/components/SignIn.tsx">
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Image from "next/image";
import { useTranslations } from "next-intl";
import { useAuth } from "@/context/AuthContext";
import { EyeIcon, EyeSlashIcon } from "@heroicons/react/24/outline";
import styles from "./SignIn.module.scss";

const SignInPage = () => {
  const router = useRouter();

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [showPassword, setShowPassword] = useState(false);

  const [authError, setAuthError] = useState<string | null>(null);
  const [signInRunning, setSignInRunning] = useState(false);
  const [hasError, setHasError] = useState(false);

  const t = useTranslations();

  const { signInWithEmail } = useAuth();

  const handleSignIn = async () => {
    setAuthError(null);
    setHasError(false);
    setSignInRunning(true);
    try {
      await signInWithEmail(email, password);
      router.replace("/start");
    } catch (error) {
      setHasError(true);
      setAuthError(error instanceof Error ? error.message : "Sign in failed");

      setTimeout(() => {
        setHasError(false);
      }, 600);
    } finally {
      setSignInRunning(false);
    }
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!signInRunning && email && password) {
      handleSignIn();
    }
  };

  return (
    <>
      <main className="w-screen h-screen flex flex-col justify-center items-center z-10 bg-white">
        <div className={styles.contentContainer}>
          <div
            className={`flex flex-col gap-4 items-center justify-center z-10 ${styles.logoSection}`}
          >
            <Image
              src="/assets/images/logo.png"
              alt="Logo"
              width={90}
              height={90}
              className={`w-[90px] ${styles.logo}`}
              priority
            />
            <span className="ava_title">Kireon GPT</span>
          </div>
          <div className={styles.formSection}>
            <article
              className={`box_blue_wrapper max-w-[565px] w-full z-10 ${styles.formWrapper}`}
            >
              <form
                onSubmit={handleSubmit}
                className="box_blue p-8 flex flex-col gap-6"
              >
                <input
                  type="email"
                  placeholder={t("email_placeholder") || "Email"}
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  style={{
                    background: "var(--gradientDarkblue)",
                  }}
                  className={`w-full rounded-[9px] p-3 text-black placeholder-gray-500 focus:outline-none ${
                    styles.input
                  } ${hasError ? styles.inputError : ""} ${
                    hasError ? styles.shake : ""
                  }`}
                  disabled={signInRunning}
                />
                <div className={styles.inputWrapper}>
                  <input
                    type={showPassword ? "text" : "password"}
                    placeholder={t("password_placeholder") || "Password"}
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    style={{
                      background: "var(--gradientDarkblue)",
                    }}
                    className={`w-full rounded-[9px] p-3 text-black placeholder-gray-500 focus:outline-none ${
                      styles.input
                    } ${hasError ? styles.inputError : ""} ${
                      hasError ? styles.shake : ""
                    }`}
                    disabled={signInRunning}
                  />
                  <button
                    type="button"
                    className={styles.passwordToggle}
                    onClick={() => setShowPassword(!showPassword)}
                    tabIndex={-1}
                    aria-label={
                      showPassword ? t("hide_password") : t("show_password")
                    }
                  >
                    {showPassword ? (
                      <EyeSlashIcon className="w-5 h-5" />
                    ) : (
                      <EyeIcon className="w-5 h-5" />
                    )}
                  </button>
                </div>
                <button
                  type="submit"
                  className="action-btn mb-0 w-full"
                  disabled={signInRunning || !email || !password}
                >
                  {signInRunning
                    ? "Signing in..."
                    : t("sign_in_button") || "Sign In"}
                </button>
              </form>
            </article>
            <div className={styles.errorContainer}>
              {authError && (
                <p className={styles.errorMessage}>
                  {t("sign_in_error") || authError}
                </p>
              )}
            </div>
          </div>
        </div>
      </main>
    </>
  );
};

export default SignInPage;
</file>

<file path="src/components/SplitView.module.scss">
@media (max-width: 767px) {
  .mobileLayout {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    background: #FFFFFF;
    transform: translateZ(0);
  }

  .mobileArtifact {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 100px;
    z-index: 1;
  }

  .mobileChatPanel {
    position: absolute;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 100px;
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(1px);
    z-index: 15;
    transition: transform 0.3s ease-in-out;
  }

  .mobileChatCollapsed {
    transform: translateY(100vh);
  }

  .mobileChatExpanded {
    transform: translateY(0);
  }

  .mobileMessagesOnly {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .mobileMessagesOnly :global([class*="inputWrapper"]) {
    display: none !important;
  }

  .mobileInputFixed {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100px;
    background: #FFFFFF;
    border-top: 1px solid var(--melon);
    z-index: 25;
    display: flex;
    align-items: center;
    padding: 0 1rem;
  }

  .mobileInputContent :global([class*="messagesWrapper"]) {
    display: none !important;
  }

  .mobileInputContent :global([class*="inputWrapper"]) {
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  .mobileInputContent {
    flex: 1;
    margin-left: 3rem;
  }

  .mobileToggle {
    position: absolute;
    top: 8px;
    left: 1rem;
    width: 32px;
    height: 32px;
    background: var(--melon);
    border: 1px solid var(--red-crayola);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 35;
  }

  .mobileChevron {
    width: 20px;
    height: 20px;
    color: var(--rosewood);
    transition: transform 0.3s ease;
  }

  .mobileChevronUp {
    transform: rotate(0deg);
  }

  .mobileChevronDown {
    transform: rotate(180deg);
  }

  .mobileCloseButton {
    position: absolute;
    top: 8px;
    right: 1rem;
    width: 32px;
    height: 32px;
    background: var(--melon);
    border: 1px solid var(--red-crayola);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 35;
  }

  .mobileCloseIcon {
    width: 16px;
    height: 16px;
    color: var(--rosewood);
  }
}
</file>

<file path="src/domain/customer.ts">
import { Country, MarketsAll } from "@/types/counties";
import { Stichwort } from "@/types/laws";

export const OTHER_TAGS = ["Hersteller", "Produzent", "Marktplatzbetreiber"];

export interface Customer {
  id: string;
  name: string;
  address: string;
  metadata: string;
  subscribedLaws: Stichwort[];
  subscribedCountries: Country[];
  otherTags: string[];
}

// Get all law values for the mock data
const ALL_LAWS: Stichwort[] = Object.values(Stichwort);

export const generateMockCustomers = (): Customer[] => {
  return [
    {
      id: "kunde-1",
      name: "Kunde 1",
      address: "Hauptstraße 1, 10115 Berlin",
      metadata: "Premium-Mitglied seit 2021",
      subscribedLaws: [...ALL_LAWS],
      subscribedCountries: [...MarketsAll],
      otherTags: ["Hersteller", "Produzent"],
    },
    {
      id: "kunde-2",
      name: "Kunde 2",
      address: "Musterweg 12, 80331 München",
      metadata: "Standard-Mitglied",
      subscribedLaws: [Stichwort.BattV, Stichwort.kodesign],
      subscribedCountries: [Country.EU],
      otherTags: ["Marktplatzbetreiber"],
    },
    {
      id: "kunde-3",
      name: "Kunde 3",
      address: "Beispielallee 7, 20095 Hamburg",
      metadata: "Test-Account",
      subscribedLaws: [Stichwort.POP, Stichwort.EUTR],
      subscribedCountries: [Country.EU],
      otherTags: ["Hersteller"],
    }
  ];
};
</file>

<file path="src/lib/hooks/useDokumentPreviews.ts">
import { useState, useEffect, useCallback } from 'react';
import { getDokumentPreviews } from '@/lib/services/pflicht-service';
import { DokumentPreview, DokumentPreviewSearchParams } from '@/types/pflicht-preview';

export function useDokumentPreviews() {
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [dokumente, setDokumente] = useState<DokumentPreview[]>([]);
  const [filteredDokumente, setFilteredDokumente] = useState<DokumentPreview[]>([]);
  const [bereichList, setBereichList] = useState<string[]>([]);
  const [bereichCounts, setBereichCounts] = useState<Map<string, number>>(new Map());
  const [filterText, setFilterText] = useState('');
  const [selectedBereich, setSelectedBereich] = useState<string | null>(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [totalCount, setTotalCount] = useState(0);
  const [itemsPerPage] = useState(50);

  const search = useCallback(async (searchText: string = '', bereich: string | null = null) => {
    try {
      if (dokumente.length === 0) {
        setLoading(true);
      } else {
        setRefreshing(true);
      }

      const params: DokumentPreviewSearchParams = {
        pagination_offset: (currentPage - 1) * itemsPerPage,
        pagination_size: itemsPerPage,
        bereich: bereich || undefined,
        thema_search: searchText || undefined,
        sort_by: 'extraction_timestamp',
        sort_order: 'desc',
      };

      const response = await getDokumentPreviews(params);
      
      setDokumente(response.data);
      setTotalPages(response.totalPages);
      setTotalCount(response.total);

      const bereiche = [...new Set(response.data.map(d => d.bereich).filter(Boolean))] as string[];
      setBereichList(bereiche);
      
      const counts = new Map<string, number>();
      response.data.forEach(dokument => {
        if (dokument.bereich) {
          counts.set(dokument.bereich, (counts.get(dokument.bereich) || 0) + 1);
        }
      });
      setBereichCounts(counts);

    } catch (error) {
      console.error('Error fetching dokument previews:', error);
      setDokumente([]);
      setTotalPages(1);
      setTotalCount(0);
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  }, [currentPage, itemsPerPage, dokumente.length]);

  const selectBereich = useCallback((bereich: string | null) => {
    setSelectedBereich(bereich);
    setCurrentPage(1);
    search(filterText, bereich);
  }, [filterText, search]);

  const goToPage = useCallback((page: number) => {
    setCurrentPage(page);
  }, []);

  useEffect(() => {
    let filtered = dokumente;

    if (filterText) {
      const searchLower = filterText.toLowerCase();
      filtered = filtered.filter(dokument => 
        dokument.thema?.toLowerCase().includes(searchLower) ||
        dokument.id.toLowerCase().includes(searchLower) ||
        dokument.gesetzgebung?.toLowerCase().includes(searchLower) ||
        dokument.pflichten.some(pflicht => 
          pflicht.thema?.toLowerCase().includes(searchLower) ||
          pflicht.folgestatus?.toLowerCase().includes(searchLower)
        )
      );
    }

    setFilteredDokumente(filtered);
  }, [dokumente, filterText]);

  useEffect(() => {
    search();
  }, [search]);

  useEffect(() => {
    if (currentPage > 1) {
      search(filterText, selectedBereich);
    }
  }, [currentPage, search, filterText, selectedBereich]);

  return {
    loading,
    refreshing,
    dokumente: filteredDokumente,
    bereichList,
    bereichCounts,
    filterText,
    selectedBereich,
    currentPage,
    totalPages,
    totalCount,
    itemsPerPage,
    setFilterText,
    selectBereich,
    goToPage,
    search,
  };
}
</file>

<file path="src/lib/hooks/useLaws.ts">
import { useState, useMemo, useCallback } from 'react';
import { Rahmengesetzgebung, subscribedLaws, Stichwort } from '@/types/laws';

export interface Bereich {
  name: string;
  stichworte: Stichwort[];
}

// Define the Bereiche (areas/categories) based on logical groupings
export const bereiche: Bereich[] = [
  {
    name: 'Produktsicherheit',
    stichworte: [
      Stichwort.APSR,
      Stichwort.APSV,
      Stichwort.ProdHR,
      Stichwort.PSA,
      Stichwort.SpielR,
      Stichwort.MSR__alt,
      Stichwort.MSV,
      Stichwort.DGRL,
      Stichwort.OutdoorR,
      Stichwort.ATEX,
    ]
  },
  {
    name: 'Elektronik & Elektrik',
    stichworte: [
      Stichwort.EMV,
      Stichwort.FuAR,
      Stichwort.FrequenzE,
      Stichwort.NSR,
      Stichwort.BattR,
      Stichwort.BattV,
      Stichwort.WEEE,
      Stichwort.RoHS,
    ]
  },
  {
    name: 'Umwelt & Nachhaltigkeit',
    stichworte: [
      Stichwort.AbfallR,
      Stichwort.EinwegkunststoffR,
      Stichwort.VerpackR,
      Stichwort.VerpackV,
      Stichwort.Abwasser,
      Stichwort.CSRD,
      Stichwort.CSDDD,
      Stichwort.EUDR,
      Stichwort.EUTR,
      Stichwort.CBAM,
      Stichwort.E_Label,
      Stichwort.ERP,
      Stichwort.kodesign,
      Stichwort.EU_Umweltzeichen,
      Stichwort.FGasV,
      Stichwort.EWKRL,
      Stichwort.OzonV,
      Stichwort.Reducing_microplastics,
      Stichwort.NachhaltigkeitsR,
      Stichwort.Umweltstrafrecht,
    ]
  },
  {
    name: 'Cybersicherheit & Digitales',
    stichworte: [
      Stichwort.CRA,
      Stichwort.KI_VO,
      Stichwort.DatenV,
      Stichwort.NIS2,
      Stichwort.ENISA,
      Stichwort.DDG,
    ]
  },
  {
    name: 'Chemikalien & Stoffe',
    stichworte: [
      Stichwort.CLP,
      Stichwort.REACh,
      Stichwort.QuecksilberV,
      Stichwort.POP,
      Stichwort.KrebsR,
    ]
  },
  {
    name: 'Bauprodukte',
    stichworte: [
      Stichwort.BauProd,
      Stichwort.BauProd__alt,
      Stichwort.BarriereFreiheitR,
    ]
  },
  {
    name: 'Fahrzeuge',
    stichworte: [
      Stichwort.TypG,
      Stichwort.FahrzTypGenV,
    ]
  },
  {
    name: 'Marktüberwachung & Compliance',
    stichworte: [
      Stichwort.M_V,
      Stichwort.WBRL,
      Stichwort.Resilienz,
      Stichwort.ZwangsarbV,
      Stichwort.UnlautereGeschPrakt,
      Stichwort.Verbraucherschutz,
    ]
  },
  {
    name: 'Spezielle Produkte',
    stichworte: [
      Stichwort.KosmetikV,
      Stichwort.LebKontV,
      Stichwort.TabProdR,
      Stichwort.TrinkwasserR,
      Stichwort.TextilKV,
      Stichwort.MessGerR,
      Stichwort.NormV,
    ]
  },
  {
    name: 'Internationale Regelungen',
    stichworte: [
      Stichwort.DualUse,
      Stichwort.RUS_SanktionsV,
    ]
  },
  {
    name: 'UK Regelungen',
    stichworte: [
      Stichwort.VK_BattR,
      Stichwort.VK_ConstrProd,
      Stichwort.VK_EMC,
      Stichwort.VK_ERP_EI,
      Stichwort.VK_ElectricalESR,
      Stichwort.VK_GPSR,
      Stichwort.VK_MessGer,
      Stichwort.VK_PSTI,
      Stichwort.VK_RER,
      Stichwort.VK_RoHS,
      Stichwort.VK_SMSR,
      Stichwort.VK_ToySR,
    ]
  },
];

export const useLaws = () => {
  const [laws] = useState<Rahmengesetzgebung[]>(subscribedLaws);
  const [filterText, setFilterText] = useState('');
  const [selectedBereich, setSelectedBereich] = useState<Bereich | null>(null);
  const [selectedLaw, setSelectedLaw] = useState<Rahmengesetzgebung | null>(null);

  const filteredLaws = useMemo(() => {
    let lawsToShow = laws;

    // 1. First, filter by the selected Bereich from the sidebar
    if (selectedBereich) {
      lawsToShow = laws.filter(law => 
        selectedBereich.stichworte.includes(law.stichwort)
      );
    }

    // 2. Then, filter by the text input on the remaining laws
    const lowercasedFilter = filterText.toLowerCase();
    if (lowercasedFilter) {
      lawsToShow = lawsToShow.filter(law =>
        law.kurztitel.toLowerCase().includes(lowercasedFilter) ||
        law.gesetz.toLowerCase().includes(lowercasedFilter) ||
        law.stichwort.toLowerCase().includes(lowercasedFilter) ||
        law.shortTitle.toLowerCase().includes(lowercasedFilter)
      );
    }
    
    return lawsToShow;
  }, [laws, filterText, selectedBereich]);

  const selectBereich = useCallback((bereich: Bereich | null) => {
    setSelectedBereich(bereich);
    setFilterText(''); // Reset text filter when changing Bereich
  }, []);

  const selectLaw = useCallback((law: Rahmengesetzgebung) => {
    setSelectedLaw(law);
  }, []);

  const closeDialog = useCallback(() => {
    setSelectedLaw(null);
  }, []);

  // Count laws per Bereich for display in sidebar
  const bereichCounts = useMemo(() => {
    const counts = new Map<string, number>();
    bereiche.forEach(bereich => {
      const count = laws.filter(law => 
        bereich.stichworte.includes(law.stichwort)
      ).length;
      counts.set(bereich.name, count);
    });
    return counts;
  }, [laws]);

  return {
    laws,
    bereiche,
    bereichCounts,
    filteredLaws,
    selectedLaw,
    filterText,
    selectedBereich,
    setFilterText,
    selectBereich,
    selectLaw,
    closeDialog,
  };
};
</file>

<file path="src/styles/globals.css">
@import 'tailwindcss';
@import 'katex/dist/katex.min.css';

:root {
  --white: #ffffff; /* Define your white color */
  --gray-1: #cccccc; /* Example for light gray */
  --gray-3: #999999; /* Example for darker gray */
  --purple: #6a0dad; /* Example purple color */
  --purple-contrast: #8b5fc0; /* Example hover purple */
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Example shadow */
  --thumbs-up-bg: #0055c0;
  --thumbs-down-bg: #a93636;
}

/* Light theme (Default) */
[data-theme='light'],
:root:not([data-theme='dark']) {
  --primary: #730C16;
  --primary-hover: #5A0B0E;
  --primary-focus: rgba(115, 12, 22, 0.125);
  --primary-inverse: #fff;
  --background-color: #ffffff;
  --secondary-bg: #F5F5F5;
  --scrollbar-color: rgba(115, 12, 22, 0.3);

  --primary-text: #000000;
  --secondary-text: #333333;
  --tertiary-text: #666666;

  /* Chat Message Variables */
  --chat-message-bg: #ffffff;
  --chat-message-color: #000000;
  --chat-message-border: #F6BDB6;

  --chat-message-user-bg: #F6BDB6;
  --chat-message-user-color: #000000;

  --chat-message-assistant-bg: #FAFAFA;
  --chat-message-assistant-color: #000000;

  --artifact-bg: #F5F5F5;
  --artifact-bg-gray: #E8E8E8;
}


/* Light-blue (Common styles) */
:root {
  --form-element-active-border-color: var(--primary);
  --form-element-focus-color: var(--primary-focus);
  --switch-color: var(--primary-inverse);
  --switch-checked-background-color: var(--primary);
}

@media (min-width: 576px) {
  :root {
    --font-size: 16px;
    --container-width: 510px;
  }
}
@media (min-width: 768px) {
  :root {
    --font-size: 16px;
    --container-width: 700px;
  }
}
@media (min-width: 992px) {
  :root {
    --font-size: 17px;
    --container-width: 920px;
  }
}
@media (min-width: 1200px) {
  :root {
    --font-size: 17px;
    --container-width: 1130px;
  }
}
.chat-message {
  color: var(--chat-message-color);
  display: flex;
  width: 100%;
  border-radius: 1rem;
}

.chat-message.user {
  background-color: var(--chat-message-user-bg);
  color: var(--chat-message-user-color);
  width: fit-content;
  padding-right: 1rem;
  min-width: 200px;
  text-align: left;
  flex-direction: row;
}

.chat-message.assistant {
  color: var(--chat-message-assistant-color);
}

.markdown-chat {
  white-space: normal;
  p {
    margin-bottom: 0.5rem;
  }
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: 1em;
    margin-bottom: 0.5em;
  }
  blockquote {
    margin: 0;
    padding: 0.5em 1em;
    border-left: 0.25em solid var(--primary-text);
  }
  a {
    color: #fe5000;
    text-decoration: underline;
    cursor: pointer;
  }
  a:hover {
    text-decoration: underline;
    opacity: 0.8;
  }
}

.markdown-chat ul {
  padding-left: 2em; /* Adjust this value to change the indentation of sublist items */
  margin-bottom: 0;
  list-style-type: disc;
}

.markdown-chat ol {
  padding-left: 2em;
  list-style: decimal;
  margin-bottom: 0;
}

.markdown-chat li {
  margin-bottom: 0.5em;
}

.markdown-chat pre {
  background: var(--gradientTurquoise) !important;
  border-radius: 10px !important;
  padding: 0 !important;
  margin: 1rem 0 2rem !important;
}

.markdown-chat pre code {
  display: block;
  color: var(--turquoise) !important;
  border-radius: 9px !important;
  background: var(--gradientDarkblue) !important;
  width: calc(100% - 3px) !important;
  height: calc(100% - 3px);
  margin: 1.5px;
  padding: 1rem;
  position: relative;
}

.hide-scrollbar {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer 10+ */
}
.hide-scrollbar::-webkit-scrollbar {
  display: none; /* WebKit */
}

.div.error {
  color: red !important;
  font-size: 0.2rem !important;
}

.shimmer-text {
  /* Put the text in an inline-block so the background can span just the text area */
  display: inline-block;
  /*
    Create a diagonal gradient with #666 for most of the text,
    except for a narrow band of #444 in the middle (the 'sweep').
    The stops at 45%–50%–55% define how wide that darker band is.
  */
  background: linear-gradient(80deg, #abaaaa 35%, #525151 50%, #abaaaa 65%);

  /* Make the gradient much wider than the text so we can animate it across */
  background-size: 200% 100%;
  background-position: 0 0;

  /*
    Normally, to see the gradient through the text, you must
    'clip' the background to the glyphs and set the text fill to transparent.
    This is okay, because the gradient includes the same gray (#666).
  */
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  /* Animate the gradient from far left to far right */
  animation: shimmer 8s linear infinite;
}

/* Move the gradient from left to right */
@keyframes shimmer {
  0% {
    background-position: 400% 0;
  }
  100% {
    background-position: -400% 0;
  }
}

input,
textarea {
  /* vertical padding = var(--pico-form-element-spacing-vertical) = 0.75rem */
  /* horizontal padding = var(--pico-form-element-spacing-horizontal) = 1rem */
  padding: 0.75rem 1rem;
}

/* Remove Pico’s focus outline/box-shadow so nothing “lights up” on focus */
input:focus,
textarea:focus {
  outline: none;
  box-shadow: none;
}
</file>

<file path="src/types/counties.ts">
export enum Country {
    EU = "EU",
    BE = "BE",
    BG = "BG",
    DK = "DK",
    DE = "DE",
    EE = "EE",
    FI = "FI",
    FR = "FR",
    GR = "GR",
    IE = "IE",
    IS = "IS",
    IT = "IT",
    HR = "HR",
    LV = "LV",
    LI = "LI",
    LT = "LT",
    LU = "LU",
    MT = "MT",
    NL = "NL",
    UK_XI = "UK-XI",
    NO = "NO",
    AT = "AT",
    PL = "PL",
    PT = "PT",
    RO = "RO",
    SE = "SE",
    CH = "CH",
    SK = "SK",
    SI = "SI",
    ES = "ES",
    CZ = "CZ",
    TR = "TR",
    HU = "HU",
    CY = "CY",
    UK = "UK"
}

export const CountryName: Record<Country, string> = {
    [Country.EU]: "EU",
    [Country.BE]: "Belgien",
    [Country.BG]: "Bulgarien",
    [Country.DK]: "Dänemark",
    [Country.DE]: "Deutschland",
    [Country.EE]: "Estland",
    [Country.FI]: "Finnland",
    [Country.FR]: "Frankreich",
    [Country.GR]: "Griechenland",
    [Country.IE]: "Irland",
    [Country.IS]: "Island",
    [Country.IT]: "Italien",
    [Country.HR]: "Kroatien",
    [Country.LV]: "Lettland",
    [Country.LI]: "Liechtenstein",
    [Country.LT]: "Litauen",
    [Country.LU]: "Luxemburg",
    [Country.MT]: "Malta",
    [Country.NL]: "Niederlande",
    [Country.UK_XI]: "Nordirland",
    [Country.NO]: "Norwegen",
    [Country.AT]: "Österreich",
    [Country.PL]: "Polen",
    [Country.PT]: "Portugal",
    [Country.RO]: "Rumänien",
    [Country.SE]: "Schweden",
    [Country.CH]: "Schweiz",
    [Country.SK]: "Slowakei",
    [Country.SI]: "Slowenien",
    [Country.ES]: "Spanien",
    [Country.CZ]: "Tschechien",
    [Country.TR]: "Türkei",
    [Country.HU]: "Ungarn",
    [Country.CY]: "Zypern",
    [Country.UK]: "Vereinigtes Königreich"
};

export const MarketsAll: Country[] = [
    Country.EU,
    Country.BE,
    Country.BG,
    Country.DK,
    Country.DE,
    Country.EE,
    Country.FI,
    Country.FR,
    Country.GR,
    Country.IE,
    Country.IS,
    Country.IT,
    Country.HR,
    Country.LV,
    Country.LI,
    Country.LT,
    Country.LU,
    Country.MT,
    Country.NL,
    Country.UK_XI,
    Country.NO,
    Country.AT,
    Country.PL,
    Country.PT,
    Country.RO,
    Country.SE,
    Country.CH,
    Country.SK,
    Country.SI,
    Country.ES,
    Country.CZ,
    Country.TR,
    Country.HU,
    Country.CY,
    Country.UK
];
</file>

<file path="src/types/laws.ts">
export enum Stichwort {
    APSR = "APSR",
    APSV = "APSV",
    ATEX = "ATEX",
    AbfallR = "AbfallR",
    Abwasser = "Abwasser",
    BarriereFreiheitR = "BarriereFreiheitR",
    BattR = "BattR",
    BattV = "BattV",
    BauProd = "BauProd",
    BauProd__alt = "BauProd (alt)",
    CBAM = "CBAM",
    CLP = "CLP",
    CRA = "CRA",
    CSDDD = "CSDDD",
    CSRD = "CSRD",
    DDG = "DDG",
    DGRL = "DGRL",
    DatenV = "DatenV",
    DualUse = "DualUse",
    E_Label = "E-Label",
    EMV = "EMV",
    ENISA = "ENISA",
    ERP = "ERP",
    EU_Umweltzeichen = "EU-Umweltzeichen",
    EUDR = "EUDR",
    EUTR = "EUTR",
    EWKRL = "EWKRL",
    EinwegkunststoffR = "EinwegkunststoffR",
    FGasV = "FGasV",
    FahrzTypGenV = "FahrzTypGenV",
    FrequenzE = "FrequenzE",
    FuAR = "FuAR",
    KI_VO = "KI-VO",
    KosmetikV = "KosmetikV",
    KrebsR = "KrebsR",
    LebKontV = "LebKontV",
    MSR__alt = "MSR (alt)",
    MSV = "MSV",
    MessGerR = "MessGerR",
    M_V = "MüV",
    NIS2 = "NIS2",
    NSR = "NSR",
    NachhaltigkeitsR = "NachhaltigkeitsR",
    NormV = "NormV",
    OutdoorR = "OutdoorR",
    OzonV = "OzonV",
    POP = "POP",
    PSA = "PSA",
    ProdHR = "ProdHR",
    QuecksilberV = "QuecksilberV",
    REACh = "REACh",
    RUS_SanktionsV = "RUS-SanktionsV",
    Reducing_microplastics = "Reducing microplastics",
    Resilienz = "Resilienz",
    RoHS = "RoHS",
    SpielR = "SpielR",
    TabProdR = "TabProdR",
    TextilKV = "TextilKV",
    TrinkwasserR = "TrinkwasserR",
    TypG = "TypG",
    Umweltstrafrecht = "Umweltstrafrecht",
    UnlautereGeschPrakt = "UnlautereGeschPrakt",
    VK_BattR = "VK-BattR",
    VK_ConstrProd = "VK-ConstrProd",
    VK_EMC = "VK-EMC",
    VK_ERP_EI = "VK-ERP&EI",
    VK_ElectricalESR = "VK-ElectricalESR",
    VK_GPSR = "VK-GPSR",
    VK_MessGer = "VK-MessGer",
    VK_PSTI = "VK-PSTI",
    VK_RER = "VK-RER",
    VK_RoHS = "VK-RoHS",
    VK_SMSR = "VK-SMSR",
    VK_ToySR = "VK-ToySR",
    Verbraucherschutz = "Verbraucherschutz",
    VerpackR = "VerpackR",
    VerpackV = "VerpackV",
    WBRL = "WBRL",
    WEEE = "WEEE",
    ZwangsarbV = "ZwangsarbV",
    kodesign = "Ökodesign"
}

export interface Rahmengesetzgebung {
    stichwort: Stichwort;
    gesetz: string;
    kurztitel: string;
    shortTitle: string;
}

export interface LawAcronym {
    id: string; // The unique 'gesetz' string
    acronym: string; // The 'stichwort'
    fullName: string; // The 'kurztitel'
    isActive: boolean; // Default to true as the model doesn't support this yet
}

export const subscribedLaws: Rahmengesetzgebung[] = [
    {
        stichwort: Stichwort.TypG,
        gesetz: "(EU) 2018/858",
        kurztitel: "Verordnung über die Genehmigung und die Marktüberwachung von Kraftfahrzeugen",
        shortTitle: "Regulation on the approval and market surveillance of motor vehicles"
    },
    {
        stichwort: Stichwort.EMV,
        gesetz: "2014/30/EG",
        kurztitel: "Richtlinie über elektromagnetische Verträglichkeit",
        shortTitle: "Electromagnetic Compatibility Directive"
    },
    {
        stichwort: Stichwort.FuAR,
        gesetz: "2014/53/EG",
        kurztitel: "Funkanlagenrichtlinie",
        shortTitle: "Radio Equipment Directive"
    },
    {
        stichwort: Stichwort.FrequenzE,
        gesetz: "Nr. 676/2002/EG",
        kurztitel: "Frequenzentscheidung",
        shortTitle: "Radio Spectrum Decision"
    },
    {
        stichwort: Stichwort.AbfallR,
        gesetz: "2008/98/EG",
        kurztitel: "Abfallrahmenrichtlinie",
        shortTitle: "Waste Framework Directive"
    },
    {
        stichwort: Stichwort.EinwegkunststoffR,
        gesetz: "(EU) 2019/904",
        kurztitel: "Einwegkunststoffverordnung",
        shortTitle: "Disposable Plastics Regulation"
    },
    {
        stichwort: Stichwort.VerpackR,
        gesetz: "94/62/EG",
        kurztitel: "Verpackungsrichtlinie",
        shortTitle: "Packaging directive"
    },
    {
        stichwort: Stichwort.VerpackV,
        gesetz: "(EU) 2025/40",
        kurztitel: "Verordnung über Verpackungen und Verpackungsabfälle",
        shortTitle: "Regulation on Packaging and Packaging Waste"
    },
    {
        stichwort: Stichwort.WEEE,
        gesetz: "2012/19/EU",
        kurztitel: "Richtlinie über Elektro- und Elektronik-Altgeräte",
        shortTitle: "Directive on waste electrical and electronic equipment"
    },
    {
        stichwort: Stichwort.Abwasser,
        gesetz: "(EU) 2024/3019",
        kurztitel: "Richtlinie über die Behandlung von kommunalem Abwasser",
        shortTitle: "Directive concerning urban wastewater treatment"
    },
    {
        stichwort: Stichwort.CRA,
        gesetz: "(EU)2024/2847",
        kurztitel: "Cybersicherheitsanforderungen für Produkte",
        shortTitle: "Cybersecurity requirements for products"
    },
    {
        stichwort: Stichwort.KI_VO,
        gesetz: "COM/2021/206 final",
        kurztitel: "Verordnung über Künstliche Intelligenz",
        shortTitle: "Artificial Intelligence Act"
    },
    {
        stichwort: Stichwort.DatenV,
        gesetz: "(EU) 2023/2854",
        kurztitel: "Datenzugang- und Datennutzungsverordnung",
        shortTitle: "Regulation on access and use of data"
    },
    {
        stichwort: Stichwort.NIS2,
        gesetz: "(EU) 2022/2555",
        kurztitel: "Netzwerk- und Informationssicherheits-Richtlinie",
        shortTitle: "Cybersecurity directive"
    },
    {
        stichwort: Stichwort.ENISA,
        gesetz: "(EU) 2019/881",
        kurztitel: "Agentur der Europäischen Union für Cybersicherheit zur Zertifizierung der Cybersicherheit",
        shortTitle: "European Union Agency for Cybersecurity for cybersecurity certification"
    },
    {
        stichwort: Stichwort.CSRD,
        gesetz: "(EU) 2022/2464",
        kurztitel: "Verordnung zur Nachhaltigkeitsberichterstattung",
        shortTitle: "Regulation on sustainability reporting"
    },
    {
        stichwort: Stichwort.CSDDD,
        gesetz: "(EU) 2024/1760",
        kurztitel: "Richtlinie über Sorgfaltspflicht im Bereich der Nachhaltigkeit",
        shortTitle: "Directive on Corporate Sustainability Due Diligence"
    },
    {
        stichwort: Stichwort.EUDR,
        gesetz: "(EU) 2023/1115",
        kurztitel: "Entwaldungsfreie Lieferketten-Verordnung",
        shortTitle: "Deforestation free Products Regulation"
    },
    {
        stichwort: Stichwort.EUTR,
        gesetz: "EU (995/2010)",
        kurztitel: "Holzhandelsverordnung",
        shortTitle: "Timber regulation"
    },
    {
        stichwort: Stichwort.ZwangsarbV,
        gesetz: "(EU) 2024/3015",
        kurztitel: "Verordnung zum Verbot von in Zwangsarbeit hergestellten Produkten",
        shortTitle: "Ordinance banning products manufactured using forced labour"
    },
    {
        stichwort: Stichwort.CBAM,
        gesetz: "(EU) 2023/956",
        kurztitel: "Verordnung zur Schaffung eines CO2-Grenzausgleichssystems",
        shortTitle: "Regulation to establishing a carbon border adjustment mechanism"
    },
    {
        stichwort: Stichwort.M_V,
        gesetz: "(EU) 2019/1020",
        kurztitel: "Marktüberwachungsverordnung",
        shortTitle: "Market Surveillance Regulation"
    },
    {
        stichwort: Stichwort.DDG,
        gesetz: "(EU) 2022/2065",
        kurztitel: "Verordnung über einen Binnenmarkt für digitale Dienste",
        shortTitle: "Regulation on a Single Market For Digital Services"
    },
    {
        stichwort: Stichwort.UnlautereGeschPrakt,
        gesetz: "2005/29/EG",
        kurztitel: "Richtlinie über unlautere Geschäftspraktiken",
        shortTitle: "Unfair Commercial Practices Directive"
    },
    {
        stichwort: Stichwort.Resilienz,
        gesetz: "(EU) 2024/2747",
        kurztitel: "Maßnahmen für einen Binnenmarkt-Notfall",
        shortTitle: "Measures related to an internal market emergency"
    },
    {
        stichwort: Stichwort.E_Label,
        gesetz: "(EU) 2017/1369",
        kurztitel: "Verordnung zu Energieverbrauchskennzeichnung",
        shortTitle: "Regulation on energy consumption labelling"
    },
    {
        stichwort: Stichwort.ERP,
        gesetz: "2009/125/EG",
        kurztitel: "Ökodesign-Richtlinie",
        shortTitle: "Ecodesign Directive"
    },
    {
        stichwort: Stichwort.kodesign,
        gesetz: "(EU) 2024/1781",
        kurztitel: "Ökodesign-Verordnung",
        shortTitle: "Ecodesign Regulation"
    },
    {
        stichwort: Stichwort.EU_Umweltzeichen,
        gesetz: "(EG) Nr. 66/2010",
        kurztitel: "Verordnung  über das EU-Umweltzeichen ",
        shortTitle: "Regulation on the EU Ecolabel"
    },
    {
        stichwort: Stichwort.FGasV,
        gesetz: "(EU) 2024/573",
        kurztitel: "Verordnung über fluorierte Treibhausgase",
        shortTitle: "Ordinance on Fluorinated Greenhouse Gases"
    },
    {
        stichwort: Stichwort.EWKRL,
        gesetz: "(EU) 2019/904",
        kurztitel: "Richtlinie über die Verringerung der Auswirkungen bestimmter Kunststoffprodukte auf die Umwelt",
        shortTitle: "Directive on the reduction of the impact of certain plastic products on the environment"
    },
    {
        stichwort: Stichwort.OzonV,
        gesetz: "(EG) Nr. 1005/2009",
        kurztitel: "Verordnung über Stoffe, die zum Abbau der Ozonschicht führen",
        shortTitle: "Regulation on substances that deplete the ozone layer"
    },
    {
        stichwort: Stichwort.Reducing_microplastics,
        gesetz: "COM(2023)645",
        kurztitel: "Umweltverschmutzung durch Mikroplastik – Maßnahmen zur Eindämmung der Umweltfolgen",
        shortTitle: "Environmental pollution by microplastics - Measures to mitigate the environmental impact"
    },
    {
        stichwort: Stichwort.NachhaltigkeitsR,
        gesetz: "(EU) 2024/1799",
        kurztitel: "Nachhaltiger Konsum von Gütern – Förderung von Reparatur und Wiederverwendung",
        shortTitle: "Sustainable consumption of goods - promoting repair and reuse"
    },
    {
        stichwort: Stichwort.APSR,
        gesetz: "2001/95/EG",
        kurztitel: "Richtlinie über die allgemeine Produktsicherheit",
        shortTitle: "General Product Safety Directive"
    },
    {
        stichwort: Stichwort.APSV,
        gesetz: "(EU) 2023/988",
        kurztitel: "Verordnung über die allgemeine Produktsicheheit",
        shortTitle: "Regulation on general product safety"
    },
    {
        stichwort: Stichwort.ATEX,
        gesetz: "2014/34/EG",
        kurztitel: "Richtlinie über Schutzsysteme in explosionsgefährdeten Bereichen",
        shortTitle: "Directive on protective systems in potentially explosive atmospheres"
    },
    {
        stichwort: Stichwort.BattR,
        gesetz: "2006/66/EG",
        kurztitel: "Batterierichtlinie",
        shortTitle: "Battery Directive"
    },
    {
        stichwort: Stichwort.BattV,
        gesetz: "(EU) 2023/1542",
        kurztitel: "Batterieverordnung",
        shortTitle: "Battery Regulation"
    },
    {
        stichwort: Stichwort.BauProd__alt,
        gesetz: "(EU) Nr. 305/2011",
        kurztitel: "Bauprodukteverordnung",
        shortTitle: "Construction Products Regulation"
    },
    {
        stichwort: Stichwort.BauProd,
        gesetz: "(EU) 2024/3110",
        kurztitel: "Bauprodukteverordnung",
        shortTitle: "Construction Products Regulation"
    },
    {
        stichwort: Stichwort.DGRL,
        gesetz: "2014/68/EU",
        kurztitel: "Druckgeräterichtlinie",
        shortTitle: "Pressure equipment directive"
    },
    {
        stichwort: Stichwort.KosmetikV,
        gesetz: "(EG) Nr. 1223/2009",
        kurztitel: "Kosmetikverordnung",
        shortTitle: "Cosmetics Regulation"
    },
    {
        stichwort: Stichwort.MSR__alt,
        gesetz: "2006/42/EG",
        kurztitel: "Maschinenrichtlinie ",
        shortTitle: "Machinery Directive "
    },
    {
        stichwort: Stichwort.MSV,
        gesetz: "(EU) 2023/1230",
        kurztitel: "Maschinenverordnung",
        shortTitle: "Machinery Regulation "
    },
    {
        stichwort: Stichwort.NSR,
        gesetz: "2014/35/EG",
        kurztitel: "Niederspannungsrichtlinie",
        shortTitle: "Low Voltage Directive"
    },
    {
        stichwort: Stichwort.OutdoorR,
        gesetz: "2000/14/EG",
        kurztitel: "Richtlinie für im Freien verwendete Geräte",
        shortTitle: "Directive for appliances used outdoors"
    },
    {
        stichwort: Stichwort.PSA,
        gesetz: "(EU) 2016/425",
        kurztitel: "Verordnung über persönliche Schutzausrüstung",
        shortTitle: "Regulation on personal protective equipment"
    },
    {
        stichwort: Stichwort.SpielR,
        gesetz: "2009/48/EG",
        kurztitel: "Spielzeugrichtlinie",
        shortTitle: "Toys Directive"
    },
    {
        stichwort: Stichwort.DualUse,
        gesetz: "(EU) 2021/821",
        kurztitel: "Kontrolle von Gütern mit doppeltem Verwendungszweck",
        shortTitle: "Control of dual-use goods"
    },
    {
        stichwort: Stichwort.WBRL,
        gesetz: "(EU) 2019/1937",
        kurztitel: "Schutz von Personen, die Verstöße gegen das Unionsrecht melden",
        shortTitle: " protection of persons who report breaches of Union law"
    },
    {
        stichwort: Stichwort.RUS_SanktionsV,
        gesetz: "(EU) Nr. 833/2014",
        kurztitel: "Restriktive Maßnahmen gegen Russland ",
        shortTitle: "Restrictive measures against Russia "
    },
    {
        stichwort: Stichwort.FahrzTypGenV,
        gesetz: "(EU) 2018/858",
        kurztitel: "Fahrzeugtypengenehmigungsverordnung",
        shortTitle: "Vehicle Type Approval Regulation"
    },
    {
        stichwort: Stichwort.MessGerR,
        gesetz: "2014/32/EU",
        kurztitel: "Messgeräterichtlinie",
        shortTitle: "Measuring Instruments Directive"
    },
    {
        stichwort: Stichwort.NormV,
        gesetz: "(EU) Nr. 1025/2012",
        kurztitel: "Normungverordnung",
        shortTitle: "Standardisation Regulation"
    },
    {
        stichwort: Stichwort.TextilKV,
        gesetz: "(EU) Nr. 1007/2011",
        kurztitel: "Textilkennzeichnungsverordnung",
        shortTitle: "Textile Labelling Regulation"
    },
    {
        stichwort: Stichwort.BarriereFreiheitR,
        gesetz: "(EU) 2019/882",
        kurztitel: "Barrierefreiheits-Richtlinie",
        shortTitle: "Accessibility Requirements for Products Directive"
    },
    {
        stichwort: Stichwort.ProdHR,
        gesetz: "(EU) 2024/2853",
        kurztitel: "Richtlinie über die Haftung für fehlerhafte Produkte",
        shortTitle: ""
    },
    {
        stichwort: Stichwort.Verbraucherschutz,
        gesetz: "(EU) 2019/771",
        kurztitel: "Richtlinie über bestimmte vertragsrechtliche Aspekte des Warenkaufs",
        shortTitle: "Directive on certain aspects concerning contracts for the sale of goods"
    },
    {
        stichwort: Stichwort.Umweltstrafrecht,
        gesetz: "(EU) 2024/1203",
        kurztitel: "Richtlinie über den strafrechtlichen Schutz der Umwelt",
        shortTitle: "Directive on the protection of the environment through criminal law"
    },
    {
        stichwort: Stichwort.CLP,
        gesetz: "(EU) 1272/2008",
        kurztitel: "Verordnung über Einstufung, Kennzeichnung und Verpackung von Stoffen und Gemischen",
        shortTitle: "Ordinance on Classification, Labelling and Packaging of Substances and Mixtures"
    },
    {
        stichwort: Stichwort.LebKontV,
        gesetz: "(EG) Nr. 1935/2004",
        kurztitel: "Verordnung über Materialien und Gegenstände die dazu bestimmt sind mit Lebensmitteln in Berührung zu kommen",
        shortTitle: "Ordinance on materials and articles intended to come into contact with foodstuffs"
    },
    {
        stichwort: Stichwort.QuecksilberV,
        gesetz: "(EU) 2017/852",
        kurztitel: "Verordnung über Quecksilber",
        shortTitle: "Mercury Ordinance"
    },
    {
        stichwort: Stichwort.POP,
        gesetz: "(EU) 2019/1021",
        kurztitel: "Verordnung über persistente organische Schadstoffe",
        shortTitle: "Regulation on Persistent Organic Pollutants"
    },
    {
        stichwort: Stichwort.REACh,
        gesetz: "(EG) Nr. 1907/2006",
        kurztitel: "Verordnung über Registrierung, Bewertung, Zulassung und Beschränkung von Chemikalien",
        shortTitle: "Regulation on the Registration, Evaluation, Authorisation and Restriction of Chemicals"
    },
    {
        stichwort: Stichwort.RoHS,
        gesetz: "2011/65/EU",
        kurztitel: "Richtlinie zur Beschränkung der Verwendung bestimmter gefährlicher Stoffe in Elektro- und Elektrogeräten",
        shortTitle: "Directive on the restriction of the use of certain hazardous substances in electrical and electronic equipment"
    },
    {
        stichwort: Stichwort.KrebsR,
        gesetz: "2004/37/EG",
        kurztitel: "Richtlinie  über den Schutz der Arbeitnehmer gegen Gefährdung durch Karzinogene oder Mutagene",
        shortTitle: "Directive on the protection of workers from the risks related to exposure to carcinogens or mutagens"
    },
    {
        stichwort: Stichwort.TabProdR,
        gesetz: "2014/40/EU",
        kurztitel: "Tabakerzeugnis-Richtlinie",
        shortTitle: "Tobacco Products Directive"
    },
    {
        stichwort: Stichwort.TrinkwasserR,
        gesetz: "(EU) 2020/2184",
        kurztitel: "Trinkwasserrichtlinie",
        shortTitle: "Drinking Water Directive"
    },
    {
        stichwort: Stichwort.VK_EMC,
        gesetz: "Electromagnetic Compatibility Regulations 2016",
        kurztitel: "Richtlinie über elektromagnetische Verträglichkeit (Vereinigtes Königreich)",
        shortTitle: "Electromagnetic Compatibility Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_RER,
        gesetz: "Radio Equipment Regulations 2017",
        kurztitel: "Funkanlagenrichtlinie (Vereinigtes Königreich)",
        shortTitle: "Radio Equipment Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_PSTI,
        gesetz: "Product Security and Telecommunication Infrastructure Act 2022",
        kurztitel: "Cybersicherheitsanforderungen für Produkte",
        shortTitle: "Cybersecurity Act (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_ERP_EI,
        gesetz: "Ecodesign and Energy Information Regulations 2020",
        kurztitel: "Ökodesign-Richtlinie (Vereinigtes Königreich)",
        shortTitle: "Ecodesign Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_BattR,
        gesetz: "Batteries and Accumulators Regulations 1994",
        kurztitel: "Batterierichtlinie (Vereinigtes Königreich)",
        shortTitle: "Battery Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_ConstrProd,
        gesetz: "Construction Products (Amendment etc.) (EU Exit) Regulations 2019",
        kurztitel: "Bauprodukteverordnung (Vereinigtes Königreich)",
        shortTitle: "Construction Products Regulation (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_ElectricalESR,
        gesetz: "Electrical Equipment (Safety) Regulations 2016",
        kurztitel: "Niederspannungsrichtlinie (Vereinigtes Königreich)",
        shortTitle: "Low Voltage Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_GPSR,
        gesetz: "General Product Safety Regulations 2005",
        kurztitel: "Richtlinie über die allgemeine Produktsicherheit (Vereinigtes Königreich)",
        shortTitle: "General Product Safety Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_SMSR,
        gesetz: "Supply of Machinery (Safety) Regulations 2008",
        kurztitel: "Maschinenrichtlinie (Vereinigtes Königreich)",
        shortTitle: "Machinery Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_ToySR,
        gesetz: "Toys(Safety)Regulations 2011",
        kurztitel: "Spielzeugrichtlinie (Vereinigtes Königreich)",
        shortTitle: "Toys Directive (United Kingdom)"
    },
    {
        stichwort: Stichwort.VK_MessGer,
        gesetz: "Weights and Measures (Prescribed Stamp) Regulations 1968",
        kurztitel: "Verordnung über Gewichte und Maße (vorgeschriebener Stempel) von 1968",
        shortTitle: "Weights and Measures (Prescribed Stamp) Regulations 1968"
    },
    {
        stichwort: Stichwort.VK_RoHS,
        gesetz: "The RoHS Regulations",
        kurztitel: "RoHS",
        shortTitle: "The RoHS Regulations"
    }
];
</file>

<file path="src/config.ts">
import type { ForwardRefExoticComponent, SVGProps, RefAttributes } from "react";
import { UserCircleIcon } from "@heroicons/react/24/solid";
import { type FirebaseOptions } from "firebase/app";

interface AppConfig {
  agent: RoleConfig;
  user: RoleConfig;
  system: RoleConfig;
  firebaseConfig: FirebaseOptions;
}

interface RoleConfig {
  icon:
    | ForwardRefExoticComponent<
        Omit<SVGProps<SVGSVGElement>, "ref"> & {
          title?: string | undefined;
          titleId?: string | undefined;
        } & RefAttributes<SVGSVGElement>
      >
    | string;
  iconColor: string;
  roleName: string;
}

const config: AppConfig = {
  agent: {
    icon: "logo.png",
    iconColor: "text-[#730C16]",
    roleName: "Kireon GPT Assistant",
  },
  user: {
    icon: UserCircleIcon,
    iconColor: "text-[#730C16]",
    roleName: "You",
  },
  system: {
    icon: "agent-logo.svg",
    iconColor: "text-[#730C16]",
    roleName: "Agent",
  },
  firebaseConfig: {
    apiKey: "AIzaSyCzsOn795kYELai6AY2HEPP848wW2bw6yU",
    authDomain: "kireon-gpt.firebaseapp.com",
    projectId: "kireon-gpt",
    storageBucket: "kireon-gpt.firebasestorage.app",
    messagingSenderId: "510702145393",
    appId: "1:510702145393:web:ebf3812c13ec965d0270d0",
    measurementId: "G-CMW9Q7H77G"
  }
};

export function setIsProduction(isProd: boolean) {
  isProduction = isProd;
}
export let isProduction = false;

export default config;
</file>

<file path=".env.local">
NEXT_PUBLIC_BACKEND_URL=http://localhost:8080
</file>

<file path="openapi-ts.config.ts">
import { defineConfig } from "@hey-api/openapi-ts";

export default defineConfig({
  input:
    `${process.env.NEXT_PUBLIC_BACKEND_URL}/openapi.json` ||
    "https://backend.niceforest-23188099.westeurope.azurecontainerapps.io/openapi.json",
  output: "src/client",
  plugins: ["@hey-api/client-fetch"],
});
</file>

<file path="messages/de.json">
{
  "start_session_button": "Session starten",
  "start_guest_message": "Nimm dir 10 Minuten Zeit um in Ruhe die Aufgaben zu lösen.",
  "start_guest_button": "Test starten!",
  "impressum": "Impressum",
  "privacy_policy": "Datenschutzerklärung",
  "input_placeholder": "Sended Sie eine Nachricht...",
  "llm_disclaimer": "Dies ist ein von einem LLM gesteuerter dynamischer Test. Denken Sie daran, dass LLMs Fehler machen können.",
  "llm_disclaimer_short": "Remember LLMs can make mistakes.",
  "email_placeholder": "user@example.com",
  "sign_in_error": "Fehler bei der Anmeldung.",
  "show_password": "Passwort anzeigen",
  "hide_password": "Passwort verbergen",
  "password_placeholder": "Passwort",
  "sign_in_button": "Sign in",
  "sidebar": {
    "laws": "Dokumente",
    "customer": "Kunden",
    "reports": "Kundenberichte"
  },
  "dashboard": {
    "laws_title": "Dokumente",
    "customer_title": "Kunden",
    "welcome_message": "Wählen Sie einen Bereich aus, um zu beginnen."
  }
}
</file>

<file path="messages/en.json">
{
  "start_session_button": "Start session",
  "start_guest_message": "Take 10 minutes to carefully complete the tasks.",
  "start_guest_button": "Start test",
  "impressum": "Imprint",
  "privacy_policy": "Privacy policy",
  "input_placeholder": "Send a message...",
  "llm_disclaimer": "This a LLM powered dynamic test. Remember LLMs can make mistakes.",
  "llm_disclaimer_short": "Remember LLMs can make mistakes.",
  "email_placeholder": "user@example.com",
  "password_placeholder": "Password",
  "sign_in_button": "Sign in",
  "sidebar": {
    "laws": "Documents",
    "customer": "Customer",
    "reports": "Customer Reports"
  },
  "dashboard": {
    "laws_title": "Documents",
    "customer_title": "Customers",
    "welcome_message": "Select an area to get started."
  }
}
</file>

<file path="src/app/[locale]/layout.tsx">
import type { Metadata } from "next";
import "@/styles/globals.css";
import "@/styles/custom.scss";
import "highlight.js/styles/github.css";

import { AuthProvider } from "@/context/AuthContext";
import { hasLocale, NextIntlClientProvider } from "next-intl";
import { routing } from "@/i18n/routing";
import { notFound } from "next/navigation";
import { AgentStreamProvider } from "@/context/AgentStreamProvider";
import { TaskProvider } from "@/context/TaskContext";

export const metadata: Metadata = {
  title: "Kireon",
  description: "Kireon",
};

export default async function RootLayout({
  children,
  params,
}: Readonly<{
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}>) {
  const { locale } = await params;
  if (!hasLocale(routing.locales, locale)) {
    notFound();
  }
  return (
    <html lang={locale}>
      <body suppressHydrationWarning>
        <NextIntlClientProvider>
          <AuthProvider>
            <TaskProvider>
              <AgentStreamProvider>{children}</AgentStreamProvider>
            </TaskProvider>
          </AuthProvider>
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
</file>

<file path="src/components/laws/CreateDokumentModal.module.scss">
.dialogContent {
  max-width: 500px;
}

.dialogTitle {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
}

.form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin-top: 1rem;
}

.fieldGroup {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.fieldLabel {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
}

.urlInput {
  font-size: 0.875rem;
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  background-color: white;
  width: 100%;
  box-sizing: border-box;
  
  &:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  &:disabled {
    background-color: #f9fafb;
    cursor: not-allowed;
  }
}

.helpText {
  font-size: 0.75rem;
  color: #6b7280;
  margin: 0;
  line-height: 1.4;
}

.alert {
  border: 1px solid #fecaca;
  background-color: #fef2f2;
  color: #dc2626;
  padding: 0.75rem;
  border-radius: 0.375rem;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;
}

.successAlert {
  border: 1px solid #bbf7d0;
  background-color: #f0fdf4;
  color: #16a34a;
  padding: 0.75rem;
  border-radius: 0.375rem;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;
}

.actions {
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.actionButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  min-width: 120px;
  justify-content: center;
}

// Batch processing styles
.progressDisplay {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 2rem;
  text-align: center;
}

.progressText {
  font-size: 1rem;
  font-weight: 500;
  color: #374151;
  margin: 0;
}

.progressStats {
  display: flex;
  gap: 1.5rem;
  font-size: 0.875rem;
  margin-top: 0.5rem;
}

.successStat {
  color: #16a34a;
  font-weight: 600;
}

.errorStat {
  color: #dc2626;
  font-weight: 600;
}

.resultsDisplay {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem 0;
}

.resultsTitle {
  font-size: 1.125rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
}

.resultsSummary {
  font-size: 0.875rem;
  color: #374151;
  margin: 0;
}

.errorsSection {
  margin-top: 1rem;
  padding: 1rem;
  background-color: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 0.375rem;
}

.errorsTitle {
  font-size: 0.875rem;
  font-weight: 600;
  color: #dc2626;
  margin: 0 0 0.75rem 0;
}

.errorsList {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 200px;
  overflow-y: auto;
}

.errorItem {
  font-size: 0.75rem;
  color: #991b1b;
  line-height: 1.4;
  padding: 0.5rem;
  background-color: white;
  border-radius: 0.25rem;
  border: 1px solid #fecaca;

  strong {
    color: #7f1d1d;
    word-break: break-all;
  }
}

@media (max-width: 768px) {
  .dialogContent {
    max-width: 95vw;
  }

  .actions {
    flex-direction: column;
    gap: 0.5rem;
  }

  .actionButton {
    width: 100%;
  }

  .progressStats {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</file>

<file path="src/components/shared/SearchableTagSelector.tsx">
"use client";

import * as React from "react";
import { Check, ChevronsUpDown, X } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from "@/components/ui/command";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover";
import { Badge } from "@/components/ui/badge";

interface SearchableTagSelectorProps {
  label: string;
  options: readonly string[];
  optionNames?: Record<string, string>;
  selected: string[];
  onChange: (newSelected: string[]) => void;
}

export function SearchableTagSelector({
  label,
  options,
  optionNames,
  selected,
  onChange,
}: SearchableTagSelectorProps) {
  const [open, setOpen] = React.useState(false);
  const [searchValue, setSearchValue] = React.useState("");

  const handleSelect = (currentValue: string) => {
    const newSelected = selected.includes(currentValue)
      ? selected.filter((item) => item !== currentValue)
      : [...selected, currentValue];
    onChange(newSelected);
  };

  const handleRemove = (valueToRemove: string) => {
    onChange(selected.filter((item) => item !== valueToRemove));
  };

  const getDisplayName = React.useCallback((value: string) =>
    optionNames ? optionNames[value] || value : value,
    [optionNames]
  );

  const filteredOptions = React.useMemo(() => {
    if (!searchValue) return options;
    const search = searchValue.toLowerCase();
    return options.filter((option) => {
      const displayName = getDisplayName(option).toLowerCase();
      return displayName.includes(search) || option.toLowerCase().includes(search);
    });
  }, [options, searchValue, getDisplayName]);

  return (
    <div className="flex flex-col gap-2">
      <label className="text-sm font-medium text-gray-700">{label}</label>
      
      <Popover open={open} onOpenChange={setOpen}>
        <PopoverTrigger asChild>
          <Button
            variant="outline"
            role="combobox"
            aria-expanded={open}
            className="w-full justify-between bg-white hover:bg-gray-50 border-gray-300"
          >
            <span className="truncate text-gray-700">
              {selected.length === 0
                ? "Wählen Sie Tags aus..."
                : `${selected.length} ausgewählt`}
            </span>
            <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-[400px] p-0 bg-white border-gray-200">
          <Command>
            <CommandInput
              placeholder={`Suche ${label.toLowerCase()}...`}
              value={searchValue}
              onValueChange={setSearchValue}
            />
            <CommandList>
              <CommandEmpty>Keine Ergebnisse gefunden.</CommandEmpty>
              <CommandGroup>
                {filteredOptions.map((option) => (
                  <CommandItem
                    key={option}
                    value={option}
                    onSelect={() => handleSelect(option)}
                    className="cursor-pointer"
                  >
                    <Check
                      className={cn(
                        "mr-2 h-4 w-4",
                        selected.includes(option) ? "opacity-100" : "opacity-0"
                      )}
                    />
                    <span className="truncate">{getDisplayName(option)}</span>
                  </CommandItem>
                ))}
              </CommandGroup>
            </CommandList>
          </Command>
        </PopoverContent>
      </Popover>

      {selected.length > 0 && (
        <div className="flex flex-wrap gap-1.5 p-3 bg-gray-50 rounded-md border border-gray-200">
          {selected.map((item) => (
            <Badge
              key={item}
              variant="secondary"
              className="cursor-pointer bg-white hover:bg-red-50 hover:text-red-600 hover:border-red-200 transition-colors"
              onClick={() => handleRemove(item)}
            >
              {getDisplayName(item)}
              <X className="ml-1 h-3 w-3" />
            </Badge>
          ))}
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/ArtifactHeader.tsx">
"use client";

import {
  ArrowRightStartOnRectangleIcon,
  PencilSquareIcon,
} from "@heroicons/react/24/outline";
import { useRouter } from "next/navigation";
import { useAuth } from "@/context/AuthContext";
import ArtifactTimeline from "./ArtifactTimeline";
import Image from "next/image";
import clsx from "clsx";
import { v4 as uuidv4 } from "uuid";
import { useAgentStreamContext } from "@/context/AgentStreamProvider";

import styles from "./ArtifactHeader.module.scss";

interface ArtifactHeaderProps {
  tasks?: {
    original_index: number;
    task_title: string;
    task_type: string;
    task_icon: string;
  }[];
  currentTaskIndex: number;
}

const ArtifactHeader = ({
  tasks = [],
  currentTaskIndex,
}: ArtifactHeaderProps) => {
  const router = useRouter();
  const { signOut } = useAuth();
  const { reset } = useAgentStreamContext();

  const handleNewConversation = () => {
    const newThreadId = uuidv4();
    reset();

    router.push(`/conversation/${newThreadId}`);
  };

  const handleLogout = async () => {
    reset();
    await signOut();
    router.replace("/signin");
  };
  return (
    <div
      className={clsx(
        styles.artifactHeader,
        "flex flex-col gap-2 px-5 md:px-10 py-4 bg-[var(--artifact-bg)]"
      )}
    >
      <div className="flex flex-row justify-between items-center min-h-[55px]">
        <div className="flex flex-row gap-4 items-center justify-center">
          <span className="ava_title">Kireon GPT</span>
        </div>

        <div className="flex flex-row items-center gap-0 md:gap-6">
          <button
            onClick={handleNewConversation}
            title="Neuer Chat"
            className={styles.headerButton}
          >
            <PencilSquareIcon className="h-6 w-6 text-gray-500" />
          </button>
          <button
            onClick={handleLogout}
            title="Logout"
            className={styles.headerButton}
          >
            <ArrowRightStartOnRectangleIcon className="h-6 w-6 text-gray-500" />
          </button>
          <Image
            src="/images/logo.png"
            alt="Kireon Logo"
            width={40}
            height={40}
          />
        </div>
      </div>

      {tasks.length > 0 && (
        <ArtifactTimeline
          tasks={tasks}
          currentTask={currentTaskIndex}
          totalTasks={tasks.length}
        />
      )}
    </div>
  );
};

export default ArtifactHeader;
</file>

<file path="src/components/Dashboard.tsx">
"use client";

import { useTranslations } from "next-intl";
import { Link } from "@/i18n/navigation";
import styles from "./Dashboard.module.scss";
import Image from "next/image";

const Dashboard = () => {
  const t = useTranslations("sidebar");
  const tDashboard = useTranslations("dashboard");

  return (
    <div className={styles.dashboardContainer}>
      <div className={styles.header}>
        <div className={styles.logoContainer}>
          <Image
            src="/images/logo.png"
            alt="Kireon Logo"
            width={80}
            height={80}
            priority
          />
          <h1 className={styles.title}>Kireon</h1>
        </div>
        <p>{tDashboard("welcome_message")}</p>
      </div>
      <div className={styles.tileGrid}>
        <Link href="/laws" className={styles.tile}>
          <h3>{t("laws")}</h3>
        </Link>
        <Link href="/customer" className={styles.tile}>
          <h3>{t("customer")}</h3>
        </Link>
        <Link href="/laws/reports" className={styles.tile}>
          <h3>{t("reports")}</h3>
        </Link>
      </div>
    </div>
  );
};

export default Dashboard;
</file>

<file path="src/context/AgentStreamProvider.tsx">
"use client";

import { useAgentStream } from "@/lib/hooks/useAgentStream";
import React, { createContext, useContext, ReactNode } from "react";

const StreamContext = createContext<ReturnType<typeof useAgentStream> | null>(
  null
);

export const useAgentStreamContext = () => {
  const context = useContext(StreamContext);
  if (!context) {
    throw new Error(
      "useAgentStreamContext must be used within an AgentStreamProvider"
    );
  }
  return context;
};

interface AgentStreamProviderProps {
  children: ReactNode;
}

export const AgentStreamProvider = ({ children }: AgentStreamProviderProps) => {
  const stream = useAgentStream(
    `${process.env.NEXT_PUBLIC_BACKEND_URL}/api/stream` ||
    "https://backend.niceforest-23188099.westeurope.azurecontainerapps.io/api/stream"
  );

  return (
    <StreamContext.Provider value={stream}>{children}</StreamContext.Provider>
  );
};
</file>

<file path="src/lib/hooks/useCustomerData.ts">
"use client";

import { useState, useCallback, useMemo } from "react";
import { Customer, generateMockCustomers } from "@/domain/customer";

export interface UseCustomerDataReturn {
  customers: Customer[];
  selectedCustomerId: string | null;
  selectedCustomer: Customer | null;
  searchQuery: string;
  filteredCustomers: Customer[];
  selectCustomer: (customerId: string) => void;
  updateCustomer: (customerId: string, updates: Partial<Pick<Customer, "subscribedLaws" | "subscribedCountries" | "otherTags">>) => void;
  setSearchQuery: (query: string) => void;
}

export function useCustomerData(): UseCustomerDataReturn {
  const [customers, setCustomers] = useState<Customer[]>(() => generateMockCustomers());
  const [selectedCustomerId, setSelectedCustomerId] = useState<string | null>(null);
  const [searchQuery, setSearchQuery] = useState("");

  const selectedCustomer = useMemo(
    () => customers.find((c) => c.id === selectedCustomerId) || null,
    [customers, selectedCustomerId]
  );

  const filteredCustomers = useMemo(() => {
    if (!searchQuery) return customers;
    const query = searchQuery.toLowerCase();
    return customers.filter(
      (customer) =>
        customer.name.toLowerCase().includes(query) ||
        customer.address.toLowerCase().includes(query) ||
        customer.metadata.toLowerCase().includes(query)
    );
  }, [customers, searchQuery]);

  const selectCustomer = useCallback((customerId: string) => {
    setSelectedCustomerId(customerId);
  }, []);

  const updateCustomer = useCallback(
    (
      customerId: string,
      updates: Partial<Pick<Customer, "subscribedLaws" | "subscribedCountries" | "otherTags">>
    ) => {
      setCustomers((prevCustomers) =>
        prevCustomers.map((customer) =>
          customer.id === customerId
            ? { ...customer, ...updates }
            : customer
        )
      );
    },
    []
  );

  return {
    customers,
    selectedCustomerId,
    selectedCustomer,
    searchQuery,
    filteredCustomers,
    selectCustomer,
    updateCustomer,
    setSearchQuery,
  };
}
</file>

<file path="src/lib/services/laws-service.ts">
import { subscribedLaws, LawAcronym } from '@/types/laws';

/**
 * Service for managing law acronyms (Gesetzeskürzel)
 */

/**
 * Fetches all defined law acronyms.
 * Initially returns mock data derived from types/laws.ts,
 * replace with actual API call when ready.
 */
export async function getLawAcronyms(): Promise<LawAcronym[]> {
  // Map the existing Rahmengesetzgebung[] to the new LawAcronym[] format
  const acronyms: LawAcronym[] = subscribedLaws.map(law => ({
    id: law.gesetz, // Use 'gesetz' as a unique ID
    acronym: law.stichwort,
    fullName: law.kurztitel,
    isActive: true, // Default to true as this is not in the source model
  }));

  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 500));

  return Promise.resolve(acronyms);
}
</file>

<file path="src/lib/api.ts">
import { createClient, createConfig } from "@hey-api/client-fetch";
import { type ClientOptions } from "@/client/types.gen";
import { auth } from "@/lib/auth";

let authToken: string | undefined = undefined;

let tokenReadyResolver: (() => void) | null = null;
const tokenReady = new Promise<void>((resolve) => {
  tokenReadyResolver = resolve;
});

auth.onIdTokenChanged(async (user) => {
  if (user) {
    try {
      authToken = await user.getIdToken();
    } catch (err) {
      console.error("Failed to refresh token", err);
      authToken = undefined;
    }
  } else {
    authToken = undefined;
  }

  if (tokenReadyResolver) {
    tokenReadyResolver();
    tokenReadyResolver = null;
  }
});

const baseUrl =
  process.env.NEXT_PUBLIC_BACKEND_URL ||
  "https://backend.niceforest-23188099.westeurope.azurecontainerapps.io";

export const customClient = createClient(
  createConfig<ClientOptions>({
    baseUrl,
    async fetch(request: Request): Promise<Response> {
      await tokenReady;

      const headers = new Headers(request.headers);
      if (authToken) {
        headers.set("Authorization", `Bearer ${authToken}`);
      }

      const modifiedRequest = new Request(request, {
        headers,
        credentials: "include",
      });

      return fetch(modifiedRequest);
    },
  })
);
</file>

<file path="src/styles/custom.scss">
/* -------------------------------
   Theme Variables
-------------------------------- */
:root {
  /* Brand Colors */
  --rosewood: #730C16;
  --rosewood-dark: #5A0B0E;
  --melon: #F6BDB6;
  --red-crayola: #E84C5A;
  
  /* Legacy color mappings for compatibility */
  --darkblue: #FFFFFF;  /* Was #051543 */
  --orange: #730C16;    /* Was #FE5000 - now rosewood */
  --purple: #E84C5A;    /* Was #9b82ff - now red */
  --turquoise: #E84C5A; /* Was #58d8ff - now red */
  --blue: #F6BDB6;      /* Was #6090f4 - now melon */
  --grey: #666666;      /* Keeping neutral grey */

  --deepNavy: #FFFFFF;           /* Was #030e2e */
  --deepNavyTransparent: #FFFFFFee; /* Was #030e2ecc */
  --royalIndigo: #F6BDB6;        /* Was #0c1a42 - now melon */

  /* Gradients */
  --gradientHeadline: linear-gradient(
    45deg,
    var(--rosewood),
    var(--red-crayola),
    var(--melon)
  );
  --gradientTurquoise: linear-gradient(0deg, var(--melon), var(--red-crayola));
  --gradientOrange: linear-gradient(0deg, var(--red-crayola), var(--rosewood));
  --gradientDarkblue: linear-gradient(0deg, #FFFFFF, #FAFAFA);

  /* Component specific */
  --color: #000000 !important;
  --artifact-bg: #F5F5F5;
  --form-element-spacing-vertical: 0.5rem;
  
  /* Scrollbar */
  --scrollbar-color: rgba(115, 12, 22, 0.3);
}

/* -------------------------------
   Fonts
-------------------------------- */
@font-face {
  font-display: swap;
  font-family: "Lato";
  font-style: normal;
  font-weight: 300;
  src: url("/assets/fonts/lato-v24-latin-300.woff2") format("woff2");
}

@font-face {
  font-display: swap;
  font-family: "Lato";
  font-style: normal;
  font-weight: 400;
  src: url("/assets/fonts/lato-v24-latin-regular.woff2") format("woff2");
}

@font-face {
  font-display: swap;
  font-family: "Lato";
  font-style: normal;
  font-weight: 700;
  src: url("/assets/fonts/lato-v24-latin-700.woff2") format("woff2");
}

body,
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Lato", sans-serif;
}

p {
  margin-bottom: 2rem;
}

body {
  background-color: #FFFFFF;
  color: #000000;
}

/* -------------------------------
   Utility Classes
-------------------------------- */
.w-1 {
  width: 7px;
  border-right: 3px solid var(--darkblue);
  border-left: 3px solid var(--deepNavy);
}

.text-gray-400 {
  color: var(--grey) !important;
}

.text-orange {
  color: var(--orange);
}

[role="link"],
a,
[role="link"]:is([aria-current], :hover, :active, :focus),
a:is([aria-current], :hover, :active, :focus) {
  --color: var(--rosewood);
}

/* -------------------------------
   Chat + any Styles
-------------------------------- */
.chat-message {
  &.user {
    background-color: var(--melon);
    color: var(--rosewood-dark);
    padding: 0 1rem 0.25rem;
    margin: 1rem 1rem 2rem;
    max-width: 70%;
    border-radius: 1rem;
  }
}

.tiptap {
  outline: none;
  border: none;

  a {
    color: var(--orange);
    text-decoration: underline;
    cursor: pointer;

    &:hover {
      text-decoration: underline;
      opacity: 0.8;
    }
  }

  ul {
    list-style-type: disc;
    padding-left: 2em;
    margin-bottom: 1rem;
  }

  ol {
    list-style-type: decimal;
    padding-left: 2em;
    margin-bottom: 1rem;
  }

  li {
    margin-bottom: 0.5em;
  }

  pre {
    & code {
      color: var(--rosewood-dark);
      border-radius: 9px !important;
      background: linear-gradient(0deg, #FAFAFA, #FFFFFF) !important;
      width: calc(100% - 3px) !important;
      height: calc(100% - 3px);
      margin: 1.5px;
    }

    &:has(code) {
      margin-bottom: 2rem !important;
    }
  }
}

.artifact-action-footer {
  margin-bottom: -2px !important;
}

.ava_title {
  font-size: 0.8125rem;
  font-weight: 500;
  letter-spacing: 0.203125rem;
  text-transform: uppercase;

  @media (max-width: 767px) {
    font-size: 0.65rem;
  }
}

/* -------------------------------
   Heading Styles
-------------------------------- */
h1 {
  color: #1a1a1a;
  display: inline-block;
  --font-size: 1.625rem;
  --font-weight: 400;
}

.ProseMirror {
  h1 {
    color: #1a1a1a !important;
    display: inline-block;
  }
}

h2 {
  --font-size: 1.4rem;
  --font-weight: 400;
  color: #000000;
  margin-bottom: 1rem;
}

h3 {
  --font-size: 1.2rem;
  --font-weight: 400;
  color: #000000;
  margin-bottom: 1rem;
}

/* -------------------------------
   Form Styles
-------------------------------- */
textarea,
input,
.box_blue,
.tiptap pre code,
pre code {
  border-radius: 9px !important;
  border: 0;
  background: var(--gradientDarkblue) !important;
  width: calc(100% - 3px) !important;
  height: calc(100% - 3px);
  margin: 1.5px;
  position: relative;
}

select {
  border: 1px solid var(--red-crayola) !important;
  border-radius: 9px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  padding: 0.75rem 1rem;
  color: var(--rosewood-dark);
  background: linear-gradient(0deg, #FFFFFF, #FAFAFA) !important;
  width: 100%;
  height: 100%;
  position: relative;
  margin: 1rem 0 0.2rem;
}

textarea {
  padding-right: 2.5rem;

  @supports (-webkit-appearance: none) and (not (-moz-appearance: none)) {
    margin-bottom: -4px;
  }

  &::placeholder {
    color: #666666;
  }

  &:disabled {
    opacity: 1;
  }
}

/* Form Wrappers */

.wrapper:has(select),
.box_blue_wrapper,
.tiptap pre:has(code),
.input_wrapper {
  opacity: 1 !important;
  background: linear-gradient(0deg, var(--melon), var(--red-crayola)) !important;
  border-radius: 10px;
  margin: 0;
  padding: 0;

  @media (max-width: 767px) {
    width: calc(100% - 2rem);
    margin: 0 auto;
  }
}

.wrapper:has(select) {
  position: relative;

  &::after {
    content: "\f078";
    font-family: "Font Awesome 6 Free";
    font-weight: 600;
    font-size: 0.8rem;
    color: var(--rosewood);
    position: absolute;
    right: 1rem;
    top: 0.8rem;
  }
}

/* -------------------------------
   Buttons
-------------------------------- */
.action-btn {
  border-radius: 10px;
  border: 0;
  background: linear-gradient(0deg, var(--red-crayola), var(--rosewood)) !important;
  color: white !important;
  z-index: 1;
  position: relative;
  height: 54.5px;

  &::before {
    content: "";
    position: absolute;
    left: 1.5px;
    top: 1px;
    z-index: -1;
    display: block !important;
    width: calc(100% - 3px);
    height: calc(100% - 3px);
    background-color: var(--rosewood) !important;
    border-radius: 9px;
    opacity: 1 !important;
    margin: 0;
  }
}

/* -------------------------------
   Layout Utilities
-------------------------------- */
.vertical-layout-item {
  margin: 1.25rem 0;

  label {
    margin-bottom: 0.5rem;
    font-weight: 700;
  }

  .error {
    margin-top: 0.5rem;
    font-size: 0.8125rem;
    color: #e20004;
  }
}

.validation_error {
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  color: #e20004;
}

.validation {
  transition: all 0.3s ease;
  overflow: hidden;
}

.validation:empty {
  max-height: 0;
  opacity: 0;
  margin-top: 0;
}

.validation:not(:empty) {
  max-height: 100px;
  opacity: 1;
  margin-top: 0.5rem;
}

// Pico style overrides

@layer base {
  // Typography (h1–h6)
  h1 {
    font-size: 2rem;
    font-weight: 600;
    line-height: 1.2;
    margin: 0 0 1rem;
  }

  h2 {
    font-size: 1.75rem;
    font-weight: 600;
    line-height: 1.3;
    margin: 0 0 0.75rem;
  }

  h3 {
    font-size: 1.5rem;
    font-weight: 500;
    line-height: 1.4;
    margin: 0 0 0.5rem;
  }

  h4 {
    font-size: 1.25rem;
    font-weight: 500;
    margin: 0 0 0.5rem;
  }

  h5 {
    font-size: 1rem;
    font-weight: 500;
    margin: 0 0 0.5rem;
  }

  h6 {
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0 0 0.5rem;
  }

  // Form elements
  input,
  textarea,
  select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--gray-3, #999);
    border-radius: 0.375rem;
    font-size: 1rem;
    line-height: 1.5;
    background-color: var(--white, #fff);
    color: inherit;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  textarea {
    resize: vertical;
  }

  input:focus,
  textarea:focus,
  select:focus {
    outline: none;
    border-color: var(--primary, #009de0);
    box-shadow: 0 0 0 3px var(--primary-focus, rgba(3, 155, 229, 0.125));
  }

  button:hover {
    background-color: var(--primary-hover, #0288d1);
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  // Misc elements
  blockquote {
    padding: 1rem;
    border-left: 0.25rem solid var(--gray-3, #999);
    margin: 1rem 0;
    font-style: italic;
    color: #666;
  }

  ul,
  ol {
    padding-left: 1.5rem;
    margin-bottom: 1rem;
  }

  code {
    background-color: #f5f5f5;
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;
    font-family: monospace;
    font-size: 0.9em;
    color: var(--code-color, #333);
  }
}

pre {
  background-color: #f6f8fa;
  color: #333;
  padding: 1rem;
  border-radius: 0.375rem;
  overflow-x: auto;
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
  font-size: 0.9rem;
  line-height: 1.5;
  margin: 1rem 0 2rem;
  border: 1px solid rgba(0, 0, 0, 0.05);

  code {
    display: block;
    padding: 1em;
    font-size: inherit;
    color: inherit;
    background: var(--gradientDarkblue);
  }
}

// Mobile styles
@media (max-width: 767px) {
  .mobile-chat-content {
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
}

/* Radio Button */

.radio {
  gap: 1.5rem;
  padding-top: 1rem;
  @media (max-width: 767px) {
    flex-direction: column;
    gap: 1rem;
  }
}

.radio-option {
  position: relative;
  cursor: pointer;
}

.radio-input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
  margin: 0;
}

.radio-label {
  display: flex;
  align-items: center;
  padding: var(--form-element-spacing-vertical) 1.25rem
    var(--form-element-spacing-vertical) 3rem;
  border-radius: 10px;
  background: var(--gradientDarkblue);
  border: 2px solid transparent;
  color: #333333;
  font-weight: 500;
  font-size: 0.9rem;
  cursor: pointer;
  position: relative;
  min-height: 3rem;
  user-select: none;
  background-clip: padding-box;
  box-sizing: border-box;
  outline: none;

  &::after {
    content: "";
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    border: 2px solid var(--grey);
    border-radius: 50%;
    background: transparent;
    transition: all 0.2s ease;
  }
}

.radio-option:hover .radio-label {
  color: var(--red-crayola);

  &::after {
    border-color: var(--red-crayola);
  }
}

.radio-input:checked + .radio-label {
  color: #000000;
  font-weight: 600;
  border: 2px solid var(--red-crayola) !important;

  &::after {
    border-color: var(--red-crayola);
    background: var(--red-crayola);
    background-image: radial-gradient(
      circle,
      var(--deepNavy) 35%,
      transparent 35%
    );
  }
}

.radio-input:focus + .radio-label {
  outline: none !important;
}

.group-layout-item {
  margin-bottom: 2rem;
}

@media (max-width: 767px) {
  .radio-label {
    font-size: 0.95rem;
    min-height: 3.5rem;
  }

  .radio-option {
    width: 100%;
  }
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# repomix
repomix-output.xml
memory/*
**/source_code.xml

# RepoMix
repomix-output.xml
memory/*
**/source_code.xml
</file>

<file path="package.json">
{
  "name": "d7-hiring-frontend-react",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "generate-types": "openapi-ts"
  },
  "dependencies": {
    "@heroicons/react": "2.2.0",
    "@hey-api/client-fetch": "0.10.0",
    "@jsonforms/core": "3.5.1",
    "@jsonforms/react": "3.5.1",
    "@jsonforms/vanilla-renderers": "3.5.1",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-popover": "^1.1.15",
    "@radix-ui/react-scroll-area": "^1.2.10",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.13",
    "@tiptap/extension-code-block": "2.12.0",
    "@tiptap/extension-code-block-lowlight": "^2.24.0",
    "@tiptap/extension-image": "2.22.0",
    "@tiptap/extension-link": "2.22.0",
    "@tiptap/extension-table": "2.12.0",
    "@tiptap/extension-table-cell": "2.12.0",
    "@tiptap/extension-table-header": "2.12.0",
    "@tiptap/extension-table-row": "2.12.0",
    "@tiptap/react": "2.12.0",
    "@tiptap/starter-kit": "2.12.0",
    "chart.js": "4.4.9",
    "class-variance-authority": "^0.7.1",
    "cmdk": "^1.1.1",
    "date-fns": "^4.1.0",
    "firebase": "11.7.1",
    "framer-motion": "12.13.0",
    "highlight.js": "^11.11.1",
    "katex": "0.16.22",
    "lowlight": "^3.3.0",
    "lucide-react": "^0.540.0",
    "markdown-it": "14.1.0",
    "mitt": "3.0.1",
    "next": "15.3.2",
    "next-intl": "4.1.0",
    "react": "19.0.0",
    "react-chartjs-2": "5.3.0",
    "react-dom": "19.0.0",
    "react-responsive": "^10.0.1",
    "sass": "1.89.0",
    "tailwind-merge": "^3.3.1",
    "turndown": "7.2.0",
    "uuid": "11.1.0",
    "zustand": "5.0.4"
  },
  "devDependencies": {
    "@eslint/eslintrc": "3",
    "@hey-api/openapi-ts": "0.67.3",
    "@tailwindcss/postcss": "4.1.7",
    "@types/lowlight": "^2.0.1",
    "@types/node": "20",
    "@types/react": "19",
    "@types/react-dom": "19",
    "@types/turndown": "5.0.5",
    "clsx": "^2.1.1",
    "eslint": "9",
    "eslint-config-next": "15.3.2",
    "tailwindcss": "4.1.7",
    "typescript": "5"
  }
}
</file>

<file path="src/components/laws/CreateDokumentModal.tsx">
import React, { useState, useEffect } from 'react';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { Textarea } from '@/components/ui/textarea';
import { AlertCircle, CheckCircle, Loader2 } from 'lucide-react';
import { createDokumentFromUrl } from '@/lib/services/pflicht-service';
import styles from './CreateDokumentModal.module.scss';

interface CreateDokumentModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess: () => void;
}

type ProcessStatus = 'idle' | 'processing' | 'finished';

const CreateDokumentModal: React.FC<CreateDokumentModalProps> = ({
  isOpen,
  onClose,
  onSuccess,
}) => {
  // Single mode state
  const [url, setUrl] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  // Tab state
  const [activeTab, setActiveTab] = useState<'single' | 'batch'>('single');

  // Batch mode state
  const [batchUrls, setBatchUrls] = useState('');
  const [processStatus, setProcessStatus] = useState<ProcessStatus>('idle');
  const [totalCount, setTotalCount] = useState(0);
  const [successCount, setSuccessCount] = useState(0);
  const [errorCount, setErrorCount] = useState(0);
  const [errors, setErrors] = useState<{ url: string; message: string }[]>([]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (loading) return;

    if (activeTab === 'single') {
      // Single URL submission logic
      if (!url.trim()) {
        setError('Bitte geben Sie eine URL ein.');
        return;
      }

      setLoading(true);
      setError(null);
      setSuccess(false);

      try {
        await createDokumentFromUrl(url.trim());
        setSuccess(true);
        setUrl('');

        setTimeout(() => {
          onSuccess();
          handleClose();
        }, 1500);
      } catch (err) {
        console.error('Failed to create dokument:', err);
        let errorMessage = 'Fehler beim Erstellen des Dokuments.';

        if (err instanceof Error) {
          errorMessage = err.message;
        }

        setError(errorMessage);
      } finally {
        setLoading(false);
      }
    } else {
      // Batch URLs submission logic
      const urls = batchUrls
        .split(/[\n,]+/)
        .map(u => u.trim())
        .filter(u => u.startsWith('http'));

      if (urls.length === 0) {
        setError('Bitte geben Sie mindestens eine gültige URL ein.');
        return;
      }

      setProcessStatus('processing');
      setLoading(true);
      setTotalCount(urls.length);
      setSuccessCount(0);
      setErrorCount(0);
      setErrors([]);
      setError(null);

      for (const currentUrl of urls) {
        try {
          await createDokumentFromUrl(currentUrl);
          setSuccessCount(prev => prev + 1);
        } catch (err) {
          setErrorCount(prev => prev + 1);
          setErrors(prev => [...prev, {
            url: currentUrl,
            message: err instanceof Error ? err.message : 'Unbekannter Fehler'
          }]);
        }
      }

      setProcessStatus('finished');
      setLoading(false);
    }
  };

  const resetState = () => {
    setUrl('');
    setBatchUrls('');
    setError(null);
    setSuccess(false);
    setLoading(false);
    setProcessStatus('idle');
    setTotalCount(0);
    setSuccessCount(0);
    setErrorCount(0);
    setErrors([]);
    setActiveTab('single');
  };

  const handleClose = () => {
    if (!loading) {
      onClose();
      setTimeout(resetState, 300);
    }
  };

  useEffect(() => {
    if (isOpen) {
      resetState();
    }
  }, [isOpen]);

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className={styles.dialogContent}>
        <DialogHeader>
          <DialogTitle className={styles.dialogTitle}>
            Neues Dokument erstellen
          </DialogTitle>
        </DialogHeader>

        <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as 'single' | 'batch')} className="w-full">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="single">Einzeln</TabsTrigger>
            <TabsTrigger value="batch">Batch</TabsTrigger>
          </TabsList>

          {/* Single URL Tab Content */}
          <TabsContent value="single">
            <form onSubmit={handleSubmit} className={styles.form}>
              <div className={styles.fieldGroup}>
                <Label htmlFor="url" className={styles.fieldLabel}>
                  URL der Gesetzesquelle
                </Label>
                <Input
                  id="url"
                  type="url"
                  value={url}
                  onChange={(e) => setUrl(e.target.value)}
                  placeholder="https://eur-lex.europa.eu/legal-content/..."
                  className={styles.urlInput}
                  disabled={loading}
                  required
                />
                <p className={styles.helpText}>
                  Geben Sie die URL des Gesetzestextes ein, aus dem ein neues Dokument und die dazugehörigen Pflichten erstellt werden sollen
                </p>
              </div>

              {error && (
                <Alert className={styles.alert}>
                  <div className="flex items-center gap-2">
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>{error}</AlertDescription>
                  </div>
                </Alert>
              )}

              {success && (
                <Alert className={styles.successAlert}>
                  <div className="flex items-center gap-2">
                    <CheckCircle className="h-4 w-4" />
                    <AlertDescription>
                      Das Dokument konnte erfolgreich erstellt werden! <br /> Die Übersicht wird aktualisiert...
                    </AlertDescription>
                  </div>
                </Alert>
              )}

              <div className={styles.actions}>
                <Button
                  type="button"
                  variant="outline"
                  onClick={handleClose}
                  disabled={loading}
                  className={styles.actionButton}
                >
                  Abbrechen
                </Button>
                <Button
                  type="submit"
                  variant="outline"
                  disabled={loading || !url.trim()}
                  className={styles.actionButton}
                >
                  {loading ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      Dokument wird erstellt...
                    </>
                  ) : (
                    'Dokument erstellen'
                  )}
                </Button>
              </div>
            </form>
          </TabsContent>

          {/* Batch URLs Tab Content */}
          <TabsContent value="batch">
            <form onSubmit={handleSubmit} className={styles.form}>
              {processStatus === 'idle' && (
                <>
                  <div className={styles.fieldGroup}>
                    <Label htmlFor="batch-urls" className={styles.fieldLabel}>
                      URL-Liste
                    </Label>
                    <Textarea
                      id="batch-urls"
                      value={batchUrls}
                      onChange={(e) => setBatchUrls(e.target.value)}
                      placeholder="Fügen Sie URLs ein, getrennt durch Kommas oder Zeilenumbrüche..."
                      className={styles.urlInput}
                      rows={8}
                      disabled={loading}
                    />
                    <p className={styles.helpText}>
                      Jede URL wird als separates Dokument importiert.
                    </p>
                  </div>

                  {error && (
                    <Alert className={styles.alert}>
                      <div className="flex items-center gap-2">
                        <AlertCircle className="h-4 w-4" />
                        <AlertDescription>{error}</AlertDescription>
                      </div>
                    </Alert>
                  )}

                  <div className={styles.actions}>
                    <Button
                      type="button"
                      variant="outline"
                      onClick={handleClose}
                      className={styles.actionButton}
                    >
                      Abbrechen
                    </Button>
                    <Button
                      type="submit"
                      variant="outline"
                      disabled={!batchUrls.trim()}
                      className={styles.actionButton}
                    >
                      Dokumente erstellen
                    </Button>
                  </div>
                </>
              )}

              {processStatus === 'processing' && (
                <div className={styles.progressDisplay}>
                  <Loader2 className="h-8 w-8 animate-spin text-blue-500" />
                  <p className={styles.progressText}>
                    Dokument {successCount + errorCount + 1} von {totalCount} wird erstellt...
                  </p>
                  <div className={styles.progressStats}>
                    <span className={styles.successStat}>Erfolgreich: {successCount}</span>
                    <span className={styles.errorStat}>Fehlgeschlagen: {errorCount}</span>
                  </div>
                </div>
              )}

              {processStatus === 'finished' && (
                <div className={styles.resultsDisplay}>
                  <h4 className={styles.resultsTitle}>Batch-Verarbeitung abgeschlossen</h4>
                  <p className={styles.resultsSummary}>
                    Erfolgreich erstellt: <strong>{successCount}</strong> von <strong>{totalCount}</strong>
                  </p>

                  {errors.length > 0 && (
                    <div className={styles.errorsSection}>
                      <h5 className={styles.errorsTitle}>Fehlerdetails ({errorCount}):</h5>
                      <ul className={styles.errorsList}>
                        {errors.map((err, i) => (
                          <li key={i} className={styles.errorItem}>
                            <strong>{err.url}</strong>: {err.message}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}

                  <div className={styles.actions}>
                    <Button
                      type="button"
                      variant="outline"
                      onClick={() => {
                        onSuccess();
                        handleClose();
                      }}
                      className={styles.actionButton}
                    >
                      Schließen
                    </Button>
                  </div>
                </div>
              )}
            </form>
          </TabsContent>
        </Tabs>
      </DialogContent>
    </Dialog>
  );
};

export default CreateDokumentModal;
</file>

<file path="src/components/laws/PflichtDetailDialog.module.scss">
.dialogContent {
  max-width: 900px;
  max-height: 85vh;
  overflow-y: auto;
}

.dialogHeader {
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 1.5rem;
  position: relative;
}

.dialogTitle {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  padding-right: 3rem; // Space for close button
  line-height: 1.4;
  word-wrap: break-word;
  hyphens: auto;
}

.dialogBody {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.compactGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  padding: 1rem;
  background-color: #fafafa;
  border-radius: 0.5rem;
  border: 1px solid #e5e7eb;
}

.bottomRow {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.fieldGroupFullWidth {
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag {
  font-size: 0.75rem;
}


.loadingContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  text-align: center;
}

.loadingSpinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  text-align: center;
}

.errorIcon {
  width: 3rem;
  height: 3rem;
  color: #ef4444;
  margin-bottom: 1rem;
}

.errorMessage {
  color: #ef4444;
  margin-bottom: 1rem;
  font-weight: 500;
}

.statusSection {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.mainStatusRow {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.statusRow {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.bereichBadge {
  background-color: #dbeafe;
  color: #1e40af;
  font-weight: 500;
}

.kuerzelBadge {
  background-color: #fef3c7;
  color: #92400e;
  border-color: #f59e0b;
}

.statusBadge {
  font-size: 0.75rem;
}

.statusChips {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}


.iconValue {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section {
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  padding: 1.5rem;
  background-color: #fafafa;
}

.sectionTitle {
  font-size: 1.125rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 1rem 0;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e5e7eb;
}

.fieldGroup {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.fieldLabel {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.fieldValue {
  font-size: 0.875rem;
  color: #1f2937;
  line-height: 1.5;
  word-break: break-word;
}

.produkteList {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  max-width: 100%;
  overflow: hidden;
}

.produktBadge {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.75rem;
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex-shrink: 0;
}

.actions {
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
  margin-top: 1rem;
}

.actionButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

// Responsive design
@media (max-width: 768px) {
  .dialogContent {
    max-width: 95vw;
    max-height: 95vh;
  }

  .dialogHeader {
    padding-bottom: 0.75rem;
    margin-bottom: 1rem;
  }

  .dialogTitle {
    font-size: 1.125rem;
  }

  .dialogBody {
    gap: 1.5rem;
  }

  .section {
    padding: 1rem;
  }

  .compactGrid {
    grid-template-columns: 1fr;
    gap: 1rem;
    padding: 0.75rem;
  }

  .fieldLabel {
    font-size: 0.8125rem;
  }

  .fieldValue {
    font-size: 0.8125rem;
  }

  .actions {
    flex-direction: column;
    gap: 0.5rem;
  }

  .actionButton {
    width: 100%;
    justify-content: center;
  }

  .statusSection {
    justify-content: center;
  }

  .produktBadge {
    max-width: 150px;
    font-size: 0.7rem;
  }
}
</file>

<file path="src/lib/services/dokument-feedback-service.ts">
import { auth } from "@/lib/auth";
import { DokumentFeedback } from "@/types/pflicht";

export const submitDokumentFeedback = async (dokumentId: string, feedback: DokumentFeedback): Promise<void> => {
  try {
    const token = await auth.currentUser?.getIdToken();
    const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

    const response = await fetch(`${baseUrl}/api/dokument/${dokumentId}/feedback`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(feedback),
    });

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`HTTP error! status: ${response.status} ${errorText}`);
    }
  } catch (error) {
    console.error("Error submitting dokument feedback:", error);
    throw error;
  }
};
</file>

<file path="src/types/pflicht-preview.ts">
export interface PflichtPreview {
  id: number;
  dokument_id: string | null;
  thema: string | null;
  stichtag: string | null;
  folgestatus: string | null;
  produkte: string[] | null;
  laenderkuerzel: string[] | null;
}

export interface DokumentPreview {
  id: string;
  bereich: string | null;
  gesetzeskuerzel: string | null;
  gesetzgebung: string | null;
  dokument_status: string | null;
  verfahren_status: string | null;
  extraction_timestamp: string;
  thema: string | null;
  url: string | null;
  pflichten: PflichtPreview[];
}

export interface DokumentPreviewSearchParams {
  pagination_offset?: number;
  pagination_size?: number;
  bereich?: string | null;
  gesetzeskuerzel?: string | null;
  gesetzgebung?: string | null;
  thema_search?: string | null;
  sort_by?: string;
  sort_order?: "asc" | "desc";
}

export interface DokumentPreviewResponse {
  data: DokumentPreview[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
}

export interface SearchResultResponse {
  results: DokumentPreview[];
  total_count: number;
}
</file>

<file path="docker-compose.yaml">
version: '3.8'

services:
  hiring-frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_BACKEND_URL: "http://localhost:8000"
    image: kireon-frontend:latest
    ports:
      - "3000:8080"
    restart: unless-stopped
</file>

<file path="src/components/laws/PflichtDetailDialog.tsx">
import React, { useState, useEffect, useCallback } from 'react';
import { Pflicht, Beleg } from '@/types/pflicht';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Calendar, Users, AlertCircle, BookOpenIcon, MessageSquare } from 'lucide-react';
import { useRightPanelStore } from '@/stores/rightPanelStore';
import { getPflichtDetails } from '@/lib/services/pflicht-service';
import styles from './PflichtDetailDialog.module.scss';

interface PflichtDetailDialogProps {
  pflichtId: number | null;
  onClose: () => void;
  onEdit?: () => void;
  onShowBelege: (belege: Beleg[], pflichtThema: string) => void;
}

const PflichtDetailView: React.FC<PflichtDetailDialogProps> = ({
  pflichtId,
  onClose,
  onEdit,
  onShowBelege,
}) => {
  const [pflicht, setPflicht] = useState<Pflicht | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const { openPanel } = useRightPanelStore();

  const loadPflichtDetails = useCallback(async () => {
    if (!pflichtId) return;

    try {
      setLoading(true);
      setError(null);
      const data = await getPflichtDetails(pflichtId);
      setPflicht(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Fehler beim Laden der Pflicht-Details');
    } finally {
      setLoading(false);
    }
  }, [pflichtId]);

  useEffect(() => {
    if (pflichtId) {
      loadPflichtDetails();
    }
  }, [pflichtId, loadPflichtDetails]);


  const formatDate = (dateString: string | null) => {
    if (!dateString) return 'Nicht verfügbar';
    try {
      return new Date(dateString).toLocaleDateString('de-DE');
    } catch {
      return dateString;
    }
  };

  if (!pflichtId) return null;

  if (loading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.loadingSpinner} />
        <p>Lade Pflicht-Details...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className={styles.errorContainer}>
        <AlertCircle className={styles.errorIcon} />
        <p className={styles.errorMessage}>{error}</p>
        <Button onClick={loadPflichtDetails} variant="outline">
          Erneut versuchen
        </Button>
      </div>
    );
  }

  if (!pflicht) return null;


  return (
        <div className={styles.dialogBody}>
          <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '0.5rem' }}>
            <Button
              variant="outline"
              size="sm"
              onClick={() => openPanel({ documentId: pflicht.dokument_id, pflichtId })}
              title="Law Monitor Chat öffnen"
            >
              <MessageSquare className="h-4 w-4 mr-2" />
              Chat öffnen
            </Button>
          </div>
          <div className={styles.compactGrid}>
            <div className={styles.fieldGroup}>
              <label className={styles.fieldLabel}>Stichtag</label>
              <div className={styles.fieldValue}>
                <div className={styles.iconValue}>
                  <Calendar className="h-4 w-4" />
                  {formatDate(pflicht.stichtag)}
                </div>
              </div>
            </div>

            <div className={styles.fieldGroup}>
              <label className={styles.fieldLabel}>Folgestatus</label>
              <div className={styles.fieldValue}>{pflicht.folgestatus || 'Nicht verfügbar'}</div>
            </div>

            <div className={styles.fieldGroup}>
              <label className={styles.fieldLabel}>Markt</label>
              <div className={styles.fieldValue}>
                {pflicht.laenderkuerzel && pflicht.laenderkuerzel.length > 0 ? (
                  <div className={styles.tags}>
                    {pflicht.laenderkuerzel.map((kuerzel, index) => (
                      <Badge key={index} variant="outline" className={styles.tag}>
                        {kuerzel}
                      </Badge>
                    ))}
                  </div>
                ) : (
                  'Nicht verfügbar'
                )}
              </div>
            </div>

            {pflicht.produkte && pflicht.produkte.length > 0 && (
              <div className={styles.fieldGroup}>
                <label className={styles.fieldLabel}>Produkte</label>
                <div className={styles.fieldValue}>
                  <div className={styles.produkteList}>
                    {pflicht.produkte.map((produkt, index) => (
                      <Badge key={index} variant="outline" className={styles.produktBadge}>
                        {produkt}
                      </Badge>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {pflicht.information && (
              <div className={styles.fieldGroupFullWidth}>
                <label className={styles.fieldLabel}>Informationen</label>
                <div className={styles.fieldValue}>{pflicht.information}</div>
              </div>
            )}

            {pflicht.verweise && (
              <div className={styles.fieldGroupFullWidth}>
                <label className={styles.fieldLabel}>Verweise</label>
                <div className={styles.fieldValue}>{pflicht.verweise}</div>
              </div>
            )}

            {pflicht.rechtsgrundlage_ref && (
              <div className={styles.fieldGroupFullWidth}>
                <label className={styles.fieldLabel}>Rechtsgrundlage Ref.</label>
                <div className={styles.fieldValue}>{pflicht.rechtsgrundlage_ref}</div>
              </div>
            )}

            {(pflicht.betroffene || pflicht.ausblick) && (
              <div className={styles.bottomRow}>
                {pflicht.ausblick && (
                  <div className={styles.fieldGroup}>
                    <label className={styles.fieldLabel}>Ausblick</label>
                    <div className={styles.fieldValue}>{pflicht.ausblick}</div>
                  </div>
                )}

                {pflicht.betroffene && (
                  <div className={styles.fieldGroup}>
                    <label className={styles.fieldLabel}>Betroffene Akteure</label>
                    <div className={styles.fieldValue}>
                      <div className={styles.iconValue}>
                        <Users className="h-4 w-4" />
                        {pflicht.betroffene}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>

          <div className={styles.actions}>
            {pflicht.belege && pflicht.belege.length > 0 && (
              <Button
                variant="outline"
                onClick={() => onShowBelege(pflicht.belege!, pflicht.thema || 'Unbekannte Pflicht')}
                className={styles.actionButton}
              >
                <BookOpenIcon className="h-4 w-4 mr-2" />
                Quellen anzeigen
              </Button>
            )}
            <Button
              variant="outline"
              onClick={onClose}
              className={styles.actionButton}
            >
              Schließen
            </Button>
            {onEdit && (
              <Button
                variant="outline"
                onClick={onEdit}
                className={styles.actionButton}
              >
                Bearbeiten
              </Button>
            )}
          </div>
          <div className={styles.actions}>
            {pflicht.belege && pflicht.belege.length > 0 && (
              <Button
                variant="outline"
                onClick={() => onShowBelege(pflicht.belege!, pflicht.thema || 'Unbekannte Pflicht')}
                className={styles.actionButton}
              >
                <BookOpenIcon className="h-4 w-4 mr-2" />
                Quellen anzeigen
              </Button>
            )}
            <Button
              variant="outline"
              onClick={onClose}
              className={styles.actionButton}
            >
              Schließen
            </Button>
            {onEdit && (
              <Button
                variant="outline"
                onClick={onEdit}
                className={styles.actionButton}
              >
                Bearbeiten
              </Button>
            )}
          </div>
        </div>
  );
};

export default PflichtDetailView;
</file>

<file path="src/components/laws/PflichtEditDialog.tsx">
import React, { useState, useEffect, useCallback } from 'react';
import { Pflicht } from '@/types/pflicht';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Calendar, Users, AlertCircle } from 'lucide-react';
import { getPflichtDetails, updatePflicht } from '@/lib/services/pflicht-service';
import styles from './PflichtEditDialog.module.scss';

interface PflichtEditDialogProps {
  pflichtId: number | null;
  onClose: () => void;
  onSave: (updatedPflicht: Pflicht) => void;
}

const PflichtEditDialog: React.FC<PflichtEditDialogProps> = ({
  pflichtId,
  onClose,
  onSave,
}) => {
  const [pflicht, setPflicht] = useState<Pflicht | null>(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const loadPflichtDetails = useCallback(async () => {
    if (!pflichtId) return;
    setLoading(true);
    setError(null);
    try {
      const data = await getPflichtDetails(pflichtId);
      setPflicht(data);
    } catch (err) {
      console.error('Failed to load pflicht details:', err);
      setError(err instanceof Error ? err.message : 'Fehler beim Laden der Pflicht-Details.');
    } finally {
      setLoading(false);
    }
  }, [pflichtId]);

  useEffect(() => {
    loadPflichtDetails();
  }, [pflichtId, loadPflichtDetails]);

  const handleInputChange = (field: keyof Pflicht, value: any) => {
    if (!pflicht) return;

    setPflicht(prev => prev ? { ...prev, [field]: value } : prev);
  };

  const handleArrayChange = (field: keyof Pflicht, value: string) => {
    if (!pflicht) return;

    const arrayValue = value.split(',').map(item => item.trim()).filter(item => item);
    setPflicht(prev => prev ? { ...prev, [field]: arrayValue } : prev);
  };

  const handleSave = async () => {
    if (!pflicht || !pflichtId) {
      console.error('Missing pflicht or pflichtId:', { pflicht, pflichtId });
      return;
    }

    setSaving(true);
    setError(null);

    try {
      const updatedPflicht = await updatePflicht(pflichtId, pflicht);
      onSave(updatedPflicht);
      onClose();
    } catch (err) {
      console.error('Failed to update pflicht:', err);
      setError(err instanceof Error ? err.message : 'Fehler beim Speichern der Änderungen.');
    } finally {
      setSaving(false);
    }
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return '';
    try {
      return new Date(dateString).toISOString().split('T')[0];
    } catch {
      return '';
    }
  };

  if (!pflichtId) return null;

  if (loading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.loadingSpinner} />
        <p>Lade Pflicht-Details...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className={styles.errorContainer}>
        <AlertCircle className={styles.errorIcon} />
        <p className={styles.errorMessage}>{error}</p>
        <Button onClick={loadPflichtDetails} variant="outline">
          Erneut versuchen
        </Button>
      </div>
    );
  }

  if (!pflicht) return null;

  return (
        <div className={styles.dialogBody}>
          <div className={styles.compactGrid}>
            <div className={styles.fieldGroup}>
              <Label className={styles.fieldLabel}>Stichtag</Label>
              <div className={styles.fieldValue}>
                <div className={styles.iconValue}>
                  <Calendar className="h-4 w-4" />
                  <Input
                    type="date"
                    value={formatDate(pflicht.stichtag)}
                    onChange={(e) => handleInputChange('stichtag', e.target.value ? new Date(e.target.value).toISOString() : null)}
                    className={styles.fieldInput}
                  />
                </div>
              </div>
            </div>

            <div className={styles.fieldGroup}>
              <Label className={styles.fieldLabel}>Stichtag Typ</Label>
              <Input
                value={pflicht.stichtag_typ || ''}
                onChange={(e) => handleInputChange('stichtag_typ', e.target.value)}
                className={styles.fieldInput}
              />
            </div>

            <div className={styles.fieldGroup}>
              <Label className={styles.fieldLabel}>Folgestatus</Label>
              <Input
                value={pflicht.folgestatus || ''}
                onChange={(e) => handleInputChange('folgestatus', e.target.value)}
                className={styles.fieldInput}
              />
            </div>

            <div className={styles.fieldGroup}>
              <Label className={styles.fieldLabel}>Markt (kommagetrennt)</Label>
              <Input
                value={pflicht.laenderkuerzel?.join(', ') || ''}
                onChange={(e) => handleArrayChange('laenderkuerzel', e.target.value)}
                className={styles.fieldInput}
              />
            </div>

            {pflicht.produkte && pflicht.produkte.length > 0 && (
              <div className={styles.fieldGroup}>
                <Label className={styles.fieldLabel}>Produkte (kommagetrennt)</Label>
                <Input
                  value={pflicht.produkte.join(', ') || ''}
                  onChange={(e) => handleArrayChange('produkte', e.target.value)}
                  className={styles.fieldInput}
                />
              </div>
            )}

            {pflicht.information && (
              <div className={styles.fieldGroupFullWidth}>
                <Label className={styles.fieldLabel}>Informationen</Label>
                <Textarea
                  value={pflicht.information || ''}
                  onChange={(e) => handleInputChange('information', e.target.value)}
                  className={styles.textarea}
                  rows={4}
                />
              </div>
            )}

            <div className={styles.fieldGroupFullWidth}>
              <Label className={styles.fieldLabel}>Verweise</Label>
              <Input
                value={pflicht.verweise || ''}
                onChange={(e) => handleInputChange('verweise', e.target.value)}
                className={styles.fieldInput}
              />
            </div>

            <div className={styles.fieldGroupFullWidth}>
              <Label className={styles.fieldLabel}>Rechtsgrundlage Ref.</Label>
              <Input
                value={pflicht.rechtsgrundlage_ref || ''}
                onChange={(e) => handleInputChange('rechtsgrundlage_ref', e.target.value)}
                className={styles.fieldInput}
              />
            </div>

            {(pflicht.betroffene || pflicht.ausblick) && (
              <div className={styles.bottomRow}>
                {pflicht.ausblick && (
                  <div className={styles.fieldGroup}>
                    <Label className={styles.fieldLabel}>Ausblick</Label>
                    <Textarea
                      value={pflicht.ausblick || ''}
                      onChange={(e) => handleInputChange('ausblick', e.target.value)}
                      className={styles.textarea}
                      rows={3}
                    />
                  </div>
                )}

                {pflicht.betroffene && (
                  <div className={styles.fieldGroup}>
                    <Label className={styles.fieldLabel}>Betroffene Akteure</Label>
                    <div className={styles.fieldValue}>
                      <div className={styles.iconValue}>
                        <Users className="h-4 w-4" />
                        <Input
                          value={pflicht.betroffene || ''}
                          onChange={(e) => handleInputChange('betroffene', e.target.value)}
                          className={styles.fieldInput}
                        />
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>

          <div className={styles.actions}>
            <Button
              variant="outline"
              onClick={onClose}
              className={styles.actionButton}
              disabled={saving}
            >
              Abbrechen
            </Button>
            <Button
              variant="outline"
              onClick={handleSave}
              className={styles.actionButton}
              disabled={saving}
            >
              {saving ? 'Speichern...' : 'Speichern'}
            </Button>
          </div>
          <div className={styles.actions}>
            <Button
              variant="outline"
              onClick={onClose}
              className={styles.actionButton}
              disabled={saving}
            >
              Abbrechen
            </Button>
            <Button
              variant="outline"
              onClick={handleSave}
              className={styles.actionButton}
              disabled={saving}
            >
              {saving ? 'Speichern...' : 'Speichern'}
            </Button>
          </div>
        </div>
  );
};

export default PflichtEditDialog;
</file>

<file path="src/lib/hooks/useAgentStream.ts">
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-nocheck
import { useCallback, useRef, useState } from "react";
import { useLocale } from "./useLocale";
import { useTaskContext } from "@/context/TaskContext";
import { ChatHistory, ChatMessage } from "@/client";

export interface StreamOptions {
  agent_id?: string;
  message?: string;
  model?: string;
  thread_id: string;
  user_id: string;
  agent_config?: Record<string, unknown>;
  stream_tokens?: boolean;
  run_id?: string;
  // Optional context payload for agent-specific metadata
  context?: { document_id?: string; obligation_id?: number };
}

export interface Artifact {
  id: string;
  node?: string;
  type?: string;
  title?: string;
  content: any;
  status?: string;
  meta?: Record<string, unknown>;
}

type ExtendedChatMessage = ChatMessage & {
  id: string;
  role?: string;
  meta?: ChatMessage["custom_data"];
} & Omit<ChatMessage, "type">;

function getParsedArtifactContent(artifact: Artifact): any {
  try {
    if (
      typeof artifact?.content === "string" &&
      !artifact.id.startsWith("streaming_")
    ) {
      const trimmed = artifact.content.trim();
      const isLikelyJson =
        (trimmed.startsWith("{") && trimmed.endsWith("}")) ||
        (trimmed.startsWith("[") && trimmed.endsWith("]"));
      if (isLikelyJson) {
        return JSON.parse(trimmed);
      }
    }

    return artifact?.content ?? {};
  } catch (err) {
    console.warn("Failed to parse artifact content:", artifact?.content, err);
    return artifact?.content ?? {};
  }
}

export function useAgentStream(endpoint: string) {
  const [chatMessages, setChatMessages] = useState<ExtendedChatMessage[]>([]);
  const [artifacts, setArtifacts] = useState<Artifact[]>([]);
  const [isStreaming, setIsStreaming] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const chatRef = useRef<Record<string, string>>({});
  const artifactRef = useRef<Record<string, string>>({});
  const localUserMessages = useRef<ExtendedChatMessage[]>([]);
  const messageBufferRef = useRef("");

  const locale = useLocale();
  const { updateTasks } = useTaskContext();

  const reset = () => {
    chatRef.current = {};
    artifactRef.current = {};
    localUserMessages.current = [];
    messageBufferRef.current = "";
    setChatMessages([]);
    setArtifacts([]);
  };

  const sendUserMessage = (text: string) => {
    const message = {
      id: `human_${Date.now()}`,
      role: "human",
      content: text,
    } as ExtendedChatMessage;
    localUserMessages.current.push(message);
    setChatMessages((prev) => [...prev, message]);
  };

  const loadHistory = (messages: ChatHistory["messages"]) => {
    const loadedMessagesMap: Record<string, ExtendedChatMessage> = {};
    const loadedArtifactsMap: Record<string, Artifact> = {};

    for (const [index, message] of messages.entries()) {
      if (!message.content?.trim()) continue;

      if (message.type === "tool") {
        try {
          let toolData: any;
          const isJson =
            message.content.trim().startsWith("{") ||
            message.content.trim().startsWith("[");

          if (isJson) {
            toolData = JSON.parse(message.content);
          } else {
            toolData = {
              artifact_type: "markdown",
              artifact_title: "Task Instructions",
              artifact_content: message.content,
            };
          }

          const artifactContent =
            toolData.artifact_content?.trim?.() ||
            toolData.task_content?.content?.trim?.();

          if (artifactContent) {
            const id = message.tool_call_id ?? `history_tool_${index}`;
            loadedArtifactsMap[id] = {
              id,
              type: toolData.artifact_type ?? toolData.task_type ?? "unknown",
              title:
                toolData.artifact_title ?? toolData.task_title ?? "Untitled",
              content: toolData,
              status: toolData.status,
            };
          }
        } catch (err) {
          console.warn(
            "Failed to parse or use tool message from history:",
            message.content,
            err
          );
        }
        continue;
      }

      const id = (message.custom_data?.run_id as string) ?? `history_${index}`;
      const role = message.type === "human" ? "human" : "ai";
      const isChat = message.custom_data?.metadata?.type === "chat";

      if (isChat || role === "human") {
        const chat: ExtendedChatMessage = {
          id,
          role,
          content: message.content,
          meta: message.custom_data ?? {},
        };

        loadedMessagesMap[id] = chat;
        if (role === "human") localUserMessages.current.push(chat);
      }
    }

    const lastAiWithTasks = Object.values(loadedMessagesMap)
      .reverse()
      .find((m) => m.role === "ai" && m.meta?.all_tasks_summary);

    if (lastAiWithTasks) {
      updateTasks(
        lastAiWithTasks?.meta?.all_tasks_summary,
        lastAiWithTasks.meta.current_task_index_at_response ?? 0
      );
    }

    setChatMessages(Object.values(loadedMessagesMap));
    setArtifacts(Object.values(loadedArtifactsMap));
  };

  const clearArtifacts = () => {
    setArtifacts([]);
  };

  const stream = useCallback(
    async (options: StreamOptions, token?: string) => {
      setIsStreaming(true);
      setError(null);
      chatRef.current = {};
      artifactRef.current = {};
      messageBufferRef.current = "";

      if (options.message) sendUserMessage(options.message);

      try {
        const res = await fetch(
          endpoint + `?agent_id=${options.agent_id ?? ""}`,
          {
            method: "POST",
            headers: {
              Accept: "text/event-stream",
              "Content-Type": "application/json",
              ...(token && { Authorization: `Bearer ${token}` }),
            },
            body: JSON.stringify({
              user_input: {
                ...options,
                agent_config: {
                  ...options?.agent_config,
                  language: locale,
                },
              },
            }),
          }
        );

        if (!res.ok || !res.body)
          throw new Error(`Stream error: ${res.statusText}`);

        const reader = res.body.getReader();
        const decoder = new TextDecoder("utf-8");
        let buffer = "";

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split("\n");
          buffer = lines.pop() || "";

          for (const line of lines) {
            if (!line.startsWith("data: ")) continue;
            const raw = line.slice(6).trim();
            if (raw === "[DONE]") {
              setIsStreaming(false);
              return;
            }

            try {
              const payload = JSON.parse(raw);

              if (payload.type === "token") {
                const node = payload.langgraph_node || "default";
                // Append token content to a draft assistant message regardless of metadata
                chatRef.current[node] =
                  (chatRef.current[node] || "") + payload.content;
                const draft = {
                  id: "streaming_" + node,
                  role: "ai",
                  content: chatRef.current[node],
                } as ExtendedChatMessage;
                setChatMessages((prev) => [
                  ...prev.filter(
                    (m) => m.id !== draft.id && !m.id.startsWith("streaming_")
                  ),
                  draft,
                ]);
              }

              if (payload.type === "message") {
                handleFinalMessage(payload.content, payload.custom_data);
              }
            } catch {
              messageBufferRef.current += raw;
              try {
                const payload = JSON.parse(messageBufferRef.current);
                handleFinalMessage(payload.content, payload.custom_data);
                messageBufferRef.current = "";
              } catch {
                // still incomplete
              }
            }
          }
        }
      } catch (err: any) {
        setIsStreaming(false);
        setError(err.message ?? "Unknown error");
      }
    },
    // eslint-disable-next-line react-hooks/exhaustive-deps
    [endpoint, locale, updateTasks]
  );

  const handleFinalMessage = (final: any, sseMeta: any) => {
    const role = final.type === "ai" ? "ai" : final.type;

    if (role === "ai") {
      if (!final.content?.trim()) {
        console.debug("Skipped empty AI message", final);
        return;
      }

      const finalChat: ExtendedChatMessage = {
        id: final.run_id,
        role,
        content: final.content,
        meta: final.custom_data,
      };

      if (final?.custom_data?.all_tasks_summary) {
        updateTasks(
          final.custom_data.all_tasks_summary,
          final.custom_data.current_task_index_at_response ?? 0
        );
      }

      setChatMessages((prev) => {
        const filtered = prev.filter(
          (m) => m.id !== final.run_id && !m.id.startsWith("streaming_")
        );
        return [...filtered, finalChat];
      });

      // Clear any streaming buffer for this node if present
      const node = sseMeta?.node ?? sseMeta?.langgraph_node ?? "default";
      delete chatRef.current[node];
    } else if (role === "tool") {
      try {
        const isJson =
          typeof final.content === "string" &&
          (final.content.trim().startsWith("{") ||
            final.content.trim().startsWith("["));
        const toolData = isJson
          ? JSON.parse(final.content)
          : {
            artifact_type: "markdown",
            artifact_title: "Tool Output",
            artifact_content: final.content,
          };

        const isForm = toolData.artifact_type === "json_form";
        const artifactCompleteContent = isForm
          ? toolData
          : toolData.artifact_content?.trim?.() ||
          toolData.task_content?.content?.trim?.();

        if (!artifactCompleteContent) {
          console.debug("Skipped empty tool artifact", toolData);
          return;
        }

        const node = sseMeta.node ?? sseMeta.langgraph_node;
        const draftId = `streaming_${node}`;
        const finalId = final.tool_call_id || draftId;

        const complete: Artifact = {
          id: finalId,
          node,
          type: toolData.artifact_type ?? toolData.task_type ?? "unknown",
          title: toolData.artifact_title ?? toolData.task_title ?? "Untitled",
          content: artifactCompleteContent,
          status: "complete",
          meta: toolData,
        };

        setArtifacts((prev) => {
          const draftExists = prev.some((a) => a.id === draftId);
          if (draftExists) {
            // If a streaming draft exists, map and update it.
            return prev.map((a) => (a.id === draftId ? complete : a));
          } else {
            // Otherwise, add the new complete artifact to the array.
            return [...prev, complete];
          }
        });
        delete artifactRef.current[node];
      } catch (err) {
        console.warn("Failed to finalize tool artifact:", final, err);
      }
    }
  };

  return {
    chatMessages,
    artifacts,
    isStreaming,
    error,
    sendMessage: stream,
    reset,
    loadHistory,
    getParsedArtifactContent,
    clearArtifacts,
  };
}
</file>

<file path="Dockerfile">
FROM node:20-alpine AS deps

ARG NEXT_PUBLIC_BACKEND_URL

ENV NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL:-https://backend.niceforest-23188099.westeurope.azurecontainerapps.io}
ARG NEXT_PUBLIC_ALLOW_ANONYMOUS=true
ENV NEXT_PUBLIC_ALLOW_ANONYMOUS=$NEXT_PUBLIC_ALLOW_ANONYMOUS
RUN echo "NEXT_PUBLIC_BACKEND_URL is: $NEXT_PUBLIC_BACKEND_URL"

WORKDIR /app

COPY package.json yarn.lock ./

# Create .env file from build argument
RUN echo "NEXT_PUBLIC_BACKEND_URL=$NEXT_PUBLIC_BACKEND_URL" > .env && \
    echo "NEXT_PUBLIC_ALLOW_ANONYMOUS=$NEXT_PUBLIC_ALLOW_ANONYMOUS" >> .env

RUN yarn install --frozen-lockfile

FROM node:20-alpine AS builder

ARG NEXT_PUBLIC_BACKEND_URL
ARG NEXT_PUBLIC_ALLOW_ANONYMOUS=true
ENV NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL:-https://backend.niceforest-23188099.westeurope.azurecontainerapps.io}
ENV NEXT_PUBLIC_ALLOW_ANONYMOUS=$NEXT_PUBLIC_ALLOW_ANONYMOUS

WORKDIR /app

COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Create .env file from build argument
RUN echo "NEXT_PUBLIC_BACKEND_URL=$NEXT_PUBLIC_BACKEND_URL" > .env && \
    echo "NEXT_PUBLIC_ALLOW_ANONYMOUS=$NEXT_PUBLIC_ALLOW_ANONYMOUS" >> .env

RUN yarn build

FROM node:20-alpine AS runner

WORKDIR /app

ENV NODE_ENV=production
ENV PORT=3000
ENV HOSTNAME=0.0.0.0
ENV NEXT_PUBLIC_ALLOW_ANONYMOUS=true

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copy the standalone output
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/public ./public

# Set permissions
USER nextjs

EXPOSE 3000

CMD ["node", "server.js"]
</file>

<file path="src/components/laws/LawAcronymsView.tsx">
'use client';

import { useState, useEffect } from 'react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import {
  Table,
  TableBody,
  TableCaption,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Search, Plus, Edit } from 'lucide-react';
import { getLawAcronyms } from '@/lib/services/laws-service';
import { LawAcronym } from '@/types/laws';

export function LawAcronymsView() {

  const [acronyms, setAcronyms] = useState<LawAcronym[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    const loadAcronyms = async () => {
      try {
        setLoading(true);
        const data = await getLawAcronyms();
        setAcronyms(data);
      } catch (error) {
        console.error('Failed to load law acronyms:', error);
      } finally {
        setLoading(false);
      }
    };
    loadAcronyms();
  }, []);

  const filteredAcronyms = acronyms.filter(
    (acronym) =>
      acronym.acronym.toLowerCase().includes(searchTerm.toLowerCase()) ||
      acronym.fullName.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const handleEdit = () => {
    // TODO: Implement edit functionality with modal
  };

  const handleAdd = () => {
    // TODO: Implement add functionality with modal
  };

  if (loading) {
    return (
      <Card>
        <CardContent className="flex items-center justify-center h-64">
          <div className="text-muted-foreground">Lade Gesetzeskürzel...</div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>Gesetzeskürzel verwalten</CardTitle>
        <CardDescription>
          Verwaltung von Abkürzungen und Kurzbezeichnungen für Gesetze und Verordnungen
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="flex justify-between items-center mb-6">
          <div className="flex items-center space-x-2 flex-1 max-w-sm">
            <Search className="w-4 h-4 text-muted-foreground" />
            <Input
              placeholder="Suche nach Stichwort, Gesetz oder Titel..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="flex-1"
            />
          </div>
          <Button onClick={handleAdd}>
            <Plus className="w-4 h-4 mr-2" />
            Neues Kürzel
          </Button>
        </div>

        <Table>
          <TableCaption>
            {filteredAcronyms.length} von {acronyms.length} Gesetzeskürzeln
          </TableCaption>
          <TableHeader>
            <TableRow>
              <TableHead>Kürzel</TableHead>
              <TableHead>Vollständiger Name</TableHead>
              <TableHead>Status</TableHead>
              <TableHead className="text-right">Aktionen</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {filteredAcronyms.map((acronym) => (
              <TableRow key={acronym.id}>
                <TableCell className="font-medium">{acronym.acronym}</TableCell>
                <TableCell>{acronym.fullName}</TableCell>
                <TableCell>
                  <Badge variant={acronym.isActive ? 'default' : 'secondary'}>
                    {acronym.isActive ? 'Aktiv' : 'Inaktiv'}
                  </Badge>
                </TableCell>
                <TableCell className="text-right">
                  <div className="flex justify-end space-x-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleEdit()}
                    >
                      <Edit className="w-4 h-4" />
                    </Button>
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/types/pflicht.ts">
import { Country } from './counties';

export type LaenderKuerzel = Country;

export interface Dokument {
  id: string;
  dokument_status: string | null;
  verfahren_status: string | null;
  bereich: string | null;
  gesetzeskuerzel: string | null;
  gesetzgebung: string | null;
  produktbereich: string | null;
  thema: string | null;
  zusammenfassung: string | null;
  titel: string | null;
  url: string | null;
  trace_id: string | null;
  extra_info: Record<string, any> | null;
  extraction_timestamp: string;
  pflichten: Pflicht[];
}

export interface DokumentDebugInfo {
  bereich: string | null;
  gesetzeskuerzel: string | null;
  gesetzgebung: string | null;
  dokument_status: string | null;
  verfahren_status: string | null;
}

export interface Pflicht {
  dokument_id: string;
  stichtag: string | null;
  stichtag_typ: string | null;
  folgestatus: string | null;
  thema: string | null;
  information: string | null;
  produkte: string[] | null;
  betroffene: string | null;
  ausblick: string | null;
  laenderkuerzel: Country[] | null;
  verweise: string | null;
  rechtsgrundlage_ref: string | null;
  belege: Beleg[] | null;
  extra_info: Record<string, any> | null;
}

export interface PflichtDebugInfo {
  stichtag_entscheidung: string | null;
  stichtag_kandidaten: string[] | null;
  stichtag_typen: string[] | null;
  normanker_belege: Beleg[] | null;
  folgestatus_belege: Beleg[] | null;
  laenderkuerzel_begruendung: string | null;
  produkte_belege: Beleg[] | null;
  betroffene_belege: Beleg[] | null;
  ausblick_belege: Beleg[] | null;
}

export interface Beleg {
  text: string;
  quelle: string;
  relevanz: number;
  anker?: string;
  textauszug?: string;
}

export interface DokumentFeedback {
  feedback_type: "positive" | "negative";
  message?: string | null;
}
</file>

<file path="src/components/customer/CustomerReportView.tsx">
"use client";

import React, { useState } from "react";
import { useCustomerData } from "@/lib/hooks/useCustomerData";
import { Customer } from "@/domain/customer";
import { Button } from "@/components/ui/button";
import { DocumentArrowDownIcon, ChevronDownIcon, ChevronRightIcon } from "@heroicons/react/24/outline";
import styles from "./CustomerReportView.module.scss";

export function CustomerReportView() {
  const { customers } = useCustomerData();
  const [expandedRows, setExpandedRows] = useState<Set<string>>(new Set());

  const toggleRow = (customerId: string) => {
    setExpandedRows(prev => {
      const newSet = new Set(prev);
      if (newSet.has(customerId)) {
        newSet.delete(customerId);
      } else {
        newSet.add(customerId);
      }
      return newSet;
    });
  };

  const handleDownloadReport = async (customer: Customer) => {
    try {
      const { auth } = await import('@/lib/auth');
      const token = await auth.currentUser?.getIdToken();

      const gesetzeskuerzel = customer.subscribedLaws.join(',');
      const laenderkuerzel = customer.subscribedCountries.join(',');
      
      const params = new URLSearchParams({
        kundenname: customer.name,
        gesetzeskuerzel: gesetzeskuerzel,
        laenderkuerzel: laenderkuerzel,
        stichtag_from: '',
        stichtag_to: '',
        betroffene: '',
        produkte: ''
      });

      const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL
      const response = await fetch(`${baseUrl}/api/pflicht/report?${params.toString()}`, {
        method: 'GET',
        headers: {
          'Accept': 'application/pdf',
          ...(token && { 'Authorization': `Bearer ${token}` }),
        },
      });

      if (!response.ok) {
        throw new Error('Failed to generate PDF');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;

      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
      const cleanName = customer.name.replace(/[^a-zA-Z0-9\s-_]/g, '').replace(/\s+/g, '_');
      link.download = `Legal_Monitoring_${cleanName}_${timestamp}.pdf`;

      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);
    } catch (error) {
      console.error('Error downloading report:', error);
      alert('Fehler beim Herunterladen des Berichts. Bitte versuchen Sie es erneut.');
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <h1>Kundenberichte</h1>
        <p>PDF-Berichte für alle Kunden herunterladen</p>
      </div>

      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th></th>
              <th>Kundenname</th>
              <th>Adresse</th>
              <th>Anmerkungen</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {customers.map((customer) => {
              const isExpanded = expandedRows.has(customer.id);
              return (
                <React.Fragment key={customer.id}>
                  <tr className={styles.mainRow}>
                    <td className={styles.expandCell}>
                      <button
                        onClick={() => toggleRow(customer.id)}
                        className={styles.expandButton}
                      >
                        {isExpanded ? (
                          <ChevronDownIcon className={styles.chevronIcon} />
                        ) : (
                          <ChevronRightIcon className={styles.chevronIcon} />
                        )}
                      </button>
                    </td>
                    <td className={styles.customerName}>{customer.name}</td>
                    <td className={styles.address}>{customer.address}</td>
                    <td className={styles.metadata}>{customer.metadata}</td>
                    <td className={styles.actions}>
                      <Button
                        onClick={() => handleDownloadReport(customer)}
                        variant="outline"
                        size="sm"
                      >
                        <DocumentArrowDownIcon className={styles.icon} />
                        Bericht herunterladen
                      </Button>
                    </td>
                  </tr>
                  {isExpanded && (
                    <tr className={styles.detailRow}>
                      <td></td>
                      <td colSpan={4} className={styles.detailCell}>
                        <div className={styles.detailsContainer}>
                          <div className={styles.detailSection}>
                            <h4>Abonnierte Rahmengesetze</h4>
                            <div className={styles.tags}>
                              {customer.subscribedLaws.map((law, index) => (
                                <span key={index} className={styles.tag}>
                                  {law}
                                </span>
                              ))}
                            </div>
                          </div>
                          <div className={styles.detailSection}>
                            <h4>Abonnierte Länder</h4>
                            <div className={styles.tags}>
                              {customer.subscribedCountries.map((country, index) => (
                                <span key={index} className={styles.tag}>
                                  {country}
                                </span>
                              ))}
                            </div>
                          </div>
                          <div className={styles.detailSection}>
                            <h4>Weitere Tags</h4>
                            <div className={styles.tags}>
                              {customer.otherTags.map((tag, index) => (
                                <span key={index} className={styles.tag}>
                                  {tag}
                                </span>
                              ))}
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  )}
                </React.Fragment>
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
}
</file>

<file path="src/components/laws/DokumentPreviewTable.module.scss">
.container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.searchContainer {
  flex: 1;
  min-width: 300px;
}

.searchInputWrapper {
  position: relative;
  display: flex;
  align-items: center;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  background-color: white;
}

.searchIcon {
  position: absolute;
  left: 0.75rem;
  width: 1rem;
  height: 1rem;
  color: #6b7280;
  z-index: 1;
}

.searchInput {
  padding-left: 2.5rem;
  width: 100%;
  border: none;
  background: transparent;
  
  &:focus {
    outline: none;
  }
}

.addButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.addIcon {
  width: 1rem;
  height: 1rem;
}

.resultsInfo {
  color: #6b7280;
  font-size: 0.875rem;
}

.tableContainer {
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  overflow: hidden;
  background: white;
}

.table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.table th {
  background-color: #f9fafb;
  padding: 0.75rem;
  text-align: left;
  font-weight: 600;
  color: #374151;
  border-bottom: 1px solid #e5e7eb;
}

.table th:nth-child(4), .table th:nth-child(5) {
  text-align: center;
}

.table td {
  padding: 0.75rem;
  border-bottom: 1px solid #f3f4f6;
}

.expandColumn {
  width: 3rem;
}

.actionColumn {
  width: 3rem;
}

.table th:nth-child(2), .table td:nth-child(2) {
  width: 15%;
}

.table th:nth-child(3), .table td:nth-child(3) {
  width: 30%;
}

.table th:nth-child(4), .table td:nth-child(4) {
  width: 15%;
}

.table th:nth-child(5), .table td:nth-child(5) {
  width: 15%;
}

.table th:nth-child(6), .table td:nth-child(6) {
  width: 15%;
}

.table th:nth-child(7), .table td:nth-child(7) {
  width: 3rem;
}

.pflichtHeaderCell {
  padding: 0.5rem 0.75rem !important;
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
  text-align: center;
  
  &:nth-child(2), &:nth-child(3), &:nth-child(6) {
    text-align: left;
  }
}

.expandCell {
  text-align: center;
  padding: 0.5rem !important;
}

.actionCell {
  text-align: center;
  padding: 0.5rem !important;
}

.deleteButton {
  background: none;
  border: none;
  padding: 0.25rem;
  border-radius: 0.25rem;
  cursor: pointer;
  color: #6b7280;
  transition: all 0.2s;
  
  &:hover {
    background-color: #fef2f2;
    color: #dc2626;
  }
}

.deleteIcon {
  width: 1rem;
  height: 1rem;
}

.expandButton {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 0.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;

  &:hover {
    background-color: #f3f4f6;
  }
}

.chevronIcon {
  width: 1rem;
  height: 1rem;
  color: #6b7280;
}

.dokumentRow {
  cursor: default;
  transition: background-color 0.2s;

  &:hover {
    background-color: #f9fafb;
  }

  &:last-child td {
    border-bottom: none;
  }
}

.dokumentRowExpanded {
  border-left: 1px solid #d1d5db;
  border-right: 1px solid #d1d5db;
  border-top: 2px solid #d1d5db;
  border-radius: 0.375rem 0.375rem 0 0;
}

.expandedSectionRow {
  border-left: 1px solid #d1d5db;
  border-right: 1px solid #d1d5db;
  
  &:last-child {
    border-bottom: 1px solid #d1d5db;
    border-radius: 0 0 0.375rem 0.375rem;
  }
}

.pflichtRow {
  background-color: #fafafa;
  cursor: pointer;
  
  &:hover {
    background-color: #f0f0f0;
    
    td {
      background-color: #f0f0f0;
    }    
  }
  
  &:last-child td {
    border-bottom: none;
  }
}



.pflichtHeader {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.pflichtId {
  font-weight: 600;
  color: #374151;
  font-size: 0.875rem;
}

.pflichtThema {
  color: #6b7280;
  font-size: 0.875rem;
}

.pflichtHeaderRow {
  background-color: #f8f9fa;
  border-bottom: 1px solid #e5e7eb;
}


.pflichtCell {
  padding: 0.75rem !important;
  vertical-align: middle;
  text-align: center;
  font-size: 0.875rem;
  line-height: 1.5;

  &:nth-child(2), &:nth-child(3), &:nth-child(6) {
    text-align: left;
  }

  .tags {
    justify-content: center;
  }
}

.pflichtStichtag {
  color: #374151;
  font-size: 0.875rem;
  font-weight: 500;
  display: inline-block;
  line-height: 1.5;
}

.pflichtThema {
  color: #374151;
  font-size: 0.875rem;
  font-weight: 400;
  display: inline-block;
  line-height: 1.5;
}

.pflichtFolgestatus {
  color: #374151;
  font-size: 0.875rem;
  font-weight: 400;
  display: inline-block;
  line-height: 1.5;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.tag {
  background-color: #e5e7eb;
  color: #374151;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
}

.moreBadge {
  background-color: #d1d5db;
  color: #6b7280;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
  cursor: pointer;
  border: 1px solid #9ca3af;
  transition: all 0.2s ease;
  user-select: none;
  
  &:hover {
    background-color: #9ca3af;
    color: #374151;
    border-color: #6b7280;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  &:active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
}


.noPflichtenMessage {
  color: #6b7280;
  font-style: italic;
  text-align: center;
  padding: 1rem;
}


.bereichBadge {
  background-color: #dbeafe;
  color: #1e40af;
}

.kuerzelBadge {
  background-color: #fef3c7;
  color: #92400e;
  border-color: #f59e0b;
}

.pflichtenCount {
  text-align: center;
}

.dokumentId {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 0.875rem;
  color: #6b7280;
  word-break: break-all;
  line-height: 1.4;
  white-space: normal;
}

.dokumentLink {
  color: #3b82f6;
  text-decoration: none;
  display: inline;
  vertical-align: middle;
  
  &:hover {
    text-decoration: underline;
  }
}

.externalLinkIcon {
  width: 0.875rem;
  height: 0.875rem;
  margin-left: 0.25rem;
  display: inline-block;
  vertical-align: text-top;
}

.thema {
  font-weight: 500;
  color: #374151;
}

.bereich {
  text-align: center;
}

.gesetzeskuerzel {
  text-align: center;
}

.gesetzgebung {
  color: #6b7280;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  margin-top: 1rem;
}

.pageButton {
  min-width: 2.5rem;
}

.refreshingOverlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.8);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  z-index: 10;
}

.refreshingSpinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Responsive design
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: stretch;
  }

  .searchContainer {
    min-width: auto;
  }

  .table {
    font-size: 0.875rem;
  }

  .table th,
  .table td {
    padding: 0.5rem;
  }
}

.feedbackRow {
  background-color: #fefce8;
  border-top: 2px solid #fde047;
  border-bottom: 2px solid #d1d5db;
  
  &:hover {
    background-color: #fef9c3;
  }
}

.feedbackCell {
  padding: 1rem !important;
  vertical-align: top;
}

.feedbackContainer {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.feedbackContent {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}

.metadataContainer {
  display: flex;
  gap: 1.5rem;
}

.metadataItem {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.metadataLabel {
  font-size: 0.75rem;
  font-weight: 600;
  color: #6b7280;
}

.metadataValue {
  font-size: 0.875rem;
  color: #374151;
  font-weight: 500;
}

.feedbackButtons {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.feedbackQuestion {
  font-size: 0.875rem;
  color: #6b7280;
  font-weight: 500;
  margin-right: 0.25rem;
}

.feedbackButton {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  background-color: white;
  color: #374151;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 2.5rem;
  
  &:hover:not(:disabled) {
    background-color: #f9fafb;
    border-color: #9ca3af;
  }
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.feedbackButton.positive:hover:not(:disabled) {
  background-color: #dcfce7;
  border-color: #16a34a;
  color: #15803d;
}

.feedbackButton:last-child:hover:not(:disabled) {
  background-color: #fef2f2;
  border-color: #f87171;
  color: #dc2626;
}

.feedbackButtonActive.positive {
  background-color: #22c55e;
  border-color: #16a34a;
  color: white;
  
  &:hover:not(:disabled) {
    background-color: #16a34a;
    border-color: #15803d;
    color: white;
  }
}

.feedbackButtonActive.negative {
  background-color: #dc2626;
  border-color: #b91c1c;
  color: white;
  
  &:hover:not(:disabled) {
    background-color: #b91c1c;
    border-color: #991b1b;
    color: white;
  }
}

.feedbackButtonExpanded {
  background-color: #fef2f2;
  border-color: #f87171;
  color: #dc2626;
  
  &:hover:not(:disabled) {
    background-color: #fee2e2;
    border-color: #fca5a5;
    color: #b91c1c;
  }
}

.feedbackIcon {
  width: 1rem;
  height: 1rem;
}

.negativeFeedbackForm {
  margin-top: 0.5rem;
}

.feedbackTextarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-family: inherit;
  resize: vertical;
  min-height: 2.5rem;
  
  &:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  &::placeholder {
    color: #9ca3af;
  }
}

.feedbackFormActions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
  justify-content: flex-end;
}

.submitFeedbackButton {
  padding: 0.5rem 1rem;
  background-color: #dc2626;
  color: white;
  border: none;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
  
  &:hover:not(:disabled) {
    background-color: #b91c1c;
  }
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.cancelFeedbackButton {
  padding: 0.5rem 1rem;
  background-color: white;
  color: #6b7280;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    background-color: #f9fafb;
    border-color: #9ca3af;
  }
}
</file>

<file path="src/components/laws/DokumentPreviewTable.tsx">
import React, { useState } from 'react';
import { DokumentPreview } from '@/types/pflicht-preview';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { ChevronDownIcon, ChevronRightIcon, PlusIcon, MagnifyingGlassIcon, TrashIcon, HandThumbUpIcon, HandThumbDownIcon } from '@heroicons/react/24/outline';
import { ArrowTopRightOnSquareIcon } from '@heroicons/react/24/outline';
import { deletePflicht } from '@/lib/services/pflicht-service';
import { submitDokumentFeedback } from '@/lib/services/dokument-feedback-service';
import styles from './DokumentPreviewTable.module.scss';
// Chat trigger moved to Pflicht dialog; no panel trigger in table

interface DokumentPreviewTableProps {
  dokumente: DokumentPreview[];
  filterText: string;
  onFilterChange: (text: string) => void;
  onSelectDokument?: (dokumentId: string) => void;
  onSelectPflicht?: (pflichtId: number) => void;
  onAddNew: () => void;
  onDeleteDokument?: (dokumentId: string) => void;
  onDeletePflicht?: (pflichtId: number) => void;
  currentPage: number;
  totalPages: number;
  totalCount: number;
  itemsPerPage: number;
  onPageChange: (page: number) => void;
  refreshing?: boolean;
}

const DokumentPreviewTable: React.FC<DokumentPreviewTableProps> = ({
  dokumente,
  filterText,
  onFilterChange,
  onSelectDokument,
  onSelectPflicht,
  onAddNew,
  onDeleteDokument,
  onDeletePflicht,
  currentPage,
  totalPages,
  totalCount,
  itemsPerPage,
  onPageChange,
  refreshing = false,
}) => {
  const [expandedDokumente, setExpandedDokumente] = useState<Set<string>>(new Set());
  const [expandedTags, setExpandedTags] = useState<Set<string>>(new Set());
  const [showNegativeFeedback, setShowNegativeFeedback] = useState<Set<string>>(new Set());
  const [negativeFeedbackMessage, setNegativeFeedbackMessage] = useState<Record<string, string>>({});
  const [feedbackLoading, setFeedbackLoading] = useState<Set<string>>(new Set());
  const [feedbackStates, setFeedbackStates] = useState<Record<string, 'positive' | 'negative' | null>>({});

  const toggleDokument = (dokumentId: string) => {
    setExpandedDokumente(prev => {
      const newSet = new Set(prev);
      if (newSet.has(dokumentId)) {
        newSet.delete(dokumentId);
      } else {
        newSet.add(dokumentId);
      }
      return newSet;
    });
  };

  const toggleTags = (tagKey: string) => {
    setExpandedTags(prev => {
      const newSet = new Set(prev);
      if (newSet.has(tagKey)) {
        newSet.delete(tagKey);
      } else {
        newSet.add(tagKey);
      }
      return newSet;
    });
  };

  const handleDeleteDokument = (dokumentId: string, dokumentThema: string) => {
    if (confirm(`Sind Sie sicher, dass Sie das Dokument "${dokumentThema}" löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.`)) {
      onDeleteDokument?.(dokumentId);
    }
  };

  const handleDeletePflicht = async (pflichtId: number, pflichtThema: string) => {
    if (confirm(`Sind Sie sicher, dass Sie die Pflicht "${pflichtThema}" löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.`)) {
      try {
        await deletePflicht(pflichtId);
        onDeletePflicht?.(pflichtId);
      } catch (error) {
        console.error('Fehler beim Löschen der Pflicht:', error);
        alert(`Fehler beim Löschen der Pflicht: ${error instanceof Error ? error.message : 'Unbekannter Fehler'}`);
      }
    }
  };

  const handlePositiveFeedback = async (dokumentId: string) => {
    setFeedbackLoading(prev => new Set(prev).add(dokumentId));
    try {
      await submitDokumentFeedback(dokumentId, {
        feedback_type: "positive"
      });
      
      setFeedbackStates(prev => ({
        ...prev,
        [dokumentId]: 'positive'
      }));
      setShowNegativeFeedback(prev => {
        const newSet = new Set(prev);
        newSet.delete(dokumentId);
        return newSet;
      });
      
      alert("Vielen Dank für Ihr positives Feedback!");
    } catch (error) {
      console.error('Fehler beim Senden des positiven Feedbacks:', error);
      alert(`Fehler beim Senden des Feedbacks: ${error instanceof Error ? error.message : 'Unbekannter Fehler'}`);
    } finally {
      setFeedbackLoading(prev => {
        const newSet = new Set(prev);
        newSet.delete(dokumentId);
        return newSet;
      });
    }
  };

  const handleNegativeFeedback = async (dokumentId: string) => {
    const message = negativeFeedbackMessage[dokumentId]?.trim();
    if (!message) {
      alert("Bitte geben Sie eine Nachricht ein.");
      return;
    }

    setFeedbackLoading(prev => new Set(prev).add(dokumentId));
    try {
      await submitDokumentFeedback(dokumentId, {
        feedback_type: "negative",
        message: message
      });
      
      setFeedbackStates(prev => ({
        ...prev,
        [dokumentId]: 'negative'
      }));
      setShowNegativeFeedback(prev => {
        const newSet = new Set(prev);
        newSet.delete(dokumentId);
        return newSet;
      });
      setNegativeFeedbackMessage(prev => ({
        ...prev,
        [dokumentId]: ""
      }));
      
      alert("Vielen Dank für Ihr Feedback!");
    } catch (error) {
      console.error('Fehler beim Senden des negativen Feedbacks:', error);
      alert(`Fehler beim Senden des Feedbacks: ${error instanceof Error ? error.message : 'Unbekannter Fehler'}`);
    } finally {
      setFeedbackLoading(prev => {
        const newSet = new Set(prev);
        newSet.delete(dokumentId);
        return newSet;
      });
    }
  };

  const toggleNegativeFeedback = (dokumentId: string) => {
    setShowNegativeFeedback(prev => {
      const newSet = new Set(prev);
      if (newSet.has(dokumentId)) {
        newSet.delete(dokumentId);
        setNegativeFeedbackMessage(prev => ({
          ...prev,
          [dokumentId]: ""
        }));
      } else {
        newSet.add(dokumentId);
      }
      return newSet;
    });
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return '-';
    try {
      return new Date(dateString).toLocaleDateString('de-DE', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    } catch {
      return dateString;
    }
  };

  const formatDateTime = (dateString: string | null) => {
    if (!dateString) return '-';
    try {
      return new Date(dateString).toLocaleString('de-DE', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch {
      return dateString;
    }
  };

  const renderLimitedTags = (tags: string[], tagKey: string, maxVisible: number = 2) => {
    if (!tags || tags.length === 0) return null;
    
    const isExpanded = expandedTags.has(tagKey);
    const visibleTags = isExpanded ? tags : tags.slice(0, maxVisible);
    const remainingCount = tags.length - maxVisible;
    
    return (
      <div className={styles.tags}>
        {visibleTags.map((tag, index) => (
          <span key={index} className={styles.tag}>
            {tag}
          </span>
        ))}
        {remainingCount > 0 && !isExpanded && (
          <span 
            className={styles.moreBadge} 
            title={`Weitere ${remainingCount} ${remainingCount === 1 ? 'Element' : 'Elemente'} anzeigen`}
            onClick={(e) => {
              e.stopPropagation();
              toggleTags(tagKey);
            }}
          >
            ...
          </span>
        )}
      </div>
    );
  };

  const renderLimitedProduktTags = (produkte: string[], tagKey: string, maxVisible: number = 2) => {
    if (!produkte || produkte.length === 0) return null;
    
    const isExpanded = expandedTags.has(tagKey);
    const visibleProdukte = isExpanded ? produkte : produkte.slice(0, maxVisible);
    const remainingCount = produkte.length - maxVisible;
    
    return (
      <div className={styles.tags}>
        {visibleProdukte.map((produkt, index) => {
          const truncatedProdukt = produkt.length > 25 ? produkt.substring(0, 25) + '...' : produkt;
          return (
            <span 
              key={index} 
              className={styles.tag}
              title={produkt}
            >
              {truncatedProdukt}
            </span>
          );
        })}
        {remainingCount > 0 && !isExpanded && (
          <span 
            className={styles.moreBadge} 
            title={`Weitere ${remainingCount} ${remainingCount === 1 ? 'Produkt' : 'Produkte'} anzeigen`}
            onClick={(e) => {
              e.stopPropagation();
              toggleTags(tagKey);
            }}
          >
            ...
          </span>
        )}
      </div>
    );
  };

  const renderPagination = () => {
    if (totalPages <= 1) return null;

    const pages = [];
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    const endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage + 1 < maxVisiblePages) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    for (let i = startPage; i <= endPage; i++) {
      pages.push(
        <Button
          key={i}
          variant={i === currentPage ? "default" : "outline"}
          size="sm"
          onClick={() => onPageChange(i)}
          className={styles.pageButton}
        >
          {i}
        </Button>
      );
    }

    return (
      <div className={styles.pagination}>
        <Button
          variant="outline"
          size="sm"
          onClick={() => onPageChange(currentPage - 1)}
          disabled={currentPage === 1}
          className={styles.pageButton}
        >
          Vorherige
        </Button>
        {pages}
        <Button
          variant="outline"
          size="sm"
          onClick={() => onPageChange(currentPage + 1)}
          disabled={currentPage === totalPages}
          className={styles.pageButton}
        >
          Nächste
        </Button>
      </div>
    );
  };

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <div className={styles.searchContainer}>
          <div className={styles.searchInputWrapper}>
            <MagnifyingGlassIcon className={styles.searchIcon} />
            <Input
              type="text"
              placeholder="Dokumente durchsuchen..."
              value={filterText}
              onChange={(e) => onFilterChange(e.target.value)}
              className={styles.searchInput}
            />
          </div>
        </div>
        <Button variant="outline" onClick={onAddNew} className={styles.addButton}>
          <PlusIcon className={styles.addIcon} />
          Neues Dokument
        </Button>
      </div>

      {/* Results info */}
      <div className={styles.resultsInfo}>
        {totalCount > 0 ? (
          <span>
            Zeige {((currentPage - 1) * itemsPerPage) + 1} bis {Math.min(currentPage * itemsPerPage, totalCount)} von {totalCount} Dokumenten
          </span>
        ) : (
          <span>Keine Dokumente gefunden</span>
        )}
      </div>

      {/* Table */}
      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th className={styles.expandColumn}></th>
              <th>Dokument-ID</th>
              <th>Thema</th>
              <th>Bereich</th>
              <th>Gesetzeskürzel</th>
              <th>Gesetzgebung</th>
              <th className={styles.actionColumn}></th>
            </tr>
          </thead>
          <tbody>
            {dokumente.map((dokument) => {
              const isExpanded = expandedDokumente.has(dokument.id);
              return (
                <React.Fragment key={dokument.id}>
                  {/* Dokument Row */}
                  <tr
                    className={`${styles.dokumentRow} ${isExpanded ? styles.dokumentRowExpanded : ''}`}
                    onClick={() => onSelectDokument?.(dokument.id)}
                  >
                    <td className={styles.expandCell}>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          toggleDokument(dokument.id);
                        }}
                        className={styles.expandButton}
                      >
                        {isExpanded ? (
                          <ChevronDownIcon className={styles.chevronIcon} />
                        ) : (
                          <ChevronRightIcon className={styles.chevronIcon} />
                        )}
                      </button>
                    </td>
                    <td className={styles.dokumentId}>
                      {dokument.url ? (
                        <a 
                          href={dokument.url} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className={styles.dokumentLink}
                          onClick={(e) => e.stopPropagation()}
                        >
                          {dokument.id}
                          <ArrowTopRightOnSquareIcon className={styles.externalLinkIcon} />
                        </a>
                      ) : (
                        dokument.id
                      )}
                    </td>
                    <td className={styles.thema}>{dokument.thema || 'Nicht verfügbar'}</td>
                    <td className={styles.bereich}>
                      {dokument.bereich && (
                        <Badge variant="secondary" className={styles.bereichBadge}>
                          {dokument.bereich}
                        </Badge>
                      )}
                    </td>
                    <td className={styles.gesetzeskuerzel}>
                      {dokument.gesetzeskuerzel && (
                        <Badge variant="outline" className={styles.kuerzelBadge}>
                          {dokument.gesetzeskuerzel}
                        </Badge>
                      )}
                    </td>
                    <td className={styles.gesetzgebung}>{dokument.gesetzgebung || 'Nicht verfügbar'}</td>
                    <td className={styles.actionCell}>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          handleDeleteDokument(dokument.id, dokument.thema || 'Unbekanntes Dokument');
                        }}
                        className={styles.deleteButton}
                        title="Dokument löschen"
                      >
                        <TrashIcon className={styles.deleteIcon} />
                      </button>
                    </td>
                  </tr>

                  {isExpanded && (
                    <>
                      <tr className={`${styles.pflichtHeaderRow} ${isExpanded ? styles.expandedSectionRow : ''}`}>
                        <td></td>
                        <td className={styles.pflichtHeaderCell}>Stichtag</td>
                        <td className={styles.pflichtHeaderCell}>Thema</td>
                        <td className={styles.pflichtHeaderCell}>Länder</td>
                        <td className={styles.pflichtHeaderCell}>Produkte</td>
                        <td className={styles.pflichtHeaderCell}>Folgestatus</td>
                        <td></td>
                      </tr>
                      {dokument.pflichten.length > 0 ? (
                        [...dokument.pflichten]
                          .sort((a, b) => {
                            if (!a.stichtag && !b.stichtag) return 0;
                            if (!a.stichtag) return 1;
                            if (!b.stichtag) return -1;
                            return new Date(a.stichtag).getTime() - new Date(b.stichtag).getTime();
                          })
                          .map((pflicht) => (
                                <tr 
                                  key={pflicht.id} 
                                  className={`${styles.pflichtRow} ${isExpanded ? styles.expandedSectionRow : ''}`}
                                  onClick={() => onSelectPflicht?.(pflicht.id)}
                                >
                              <td></td>
                              <td className={styles.pflichtCell}>
                                <span className={styles.pflichtStichtag}>{formatDate(pflicht.stichtag)}</span>
                              </td>
                              <td className={styles.pflichtCell}>
                                <span className={styles.pflichtThema}>{pflicht.thema || 'Nicht verfügbar'}</span>
                              </td>
                              <td className={styles.pflichtCell}>
                                {pflicht.laenderkuerzel && pflicht.laenderkuerzel.length > 0 && (
                                  renderLimitedTags(pflicht.laenderkuerzel, `laender-${pflicht.id}`)
                                )}
                              </td>
                              <td className={styles.pflichtCell}>
                                {pflicht.produkte && pflicht.produkte.length > 0 && (
                                  renderLimitedProduktTags(pflicht.produkte, `produkte-${pflicht.id}`)
                                )}
                              </td>
                              <td className={styles.pflichtCell}>
                                <span className={styles.pflichtFolgestatus}>
                                  {pflicht.folgestatus || '-'}
                                </span>
                              </td>
                              <td className={styles.pflichtCell}>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    handleDeletePflicht(pflicht.id, pflicht.thema || 'Unbekannte Pflicht');
                                  }}
                                  className={styles.deleteButton}
                                  title="Pflicht löschen"
                                >
                                  <TrashIcon className={styles.deleteIcon} />
                                </button>
                              </td>
                            </tr>
                          ))
                      ) : (
                            <tr className={`${styles.pflichtRow} ${isExpanded ? styles.expandedSectionRow : ''}`}>
                          <td></td>
                          <td colSpan={6} className={styles.pflichtCell}>
                            <div className={styles.noPflichtenMessage}>
                              Keine Pflichten für dieses Dokument vorhanden.
                            </div>
                          </td>
                        </tr>
                      )}
                      
                      {/* Feedback Row */}
                      <tr className={`${styles.feedbackRow} ${isExpanded ? styles.expandedSectionRow : ''}`}>
                        <td></td>
                        <td colSpan={6} className={styles.feedbackCell}>
                          <div className={styles.feedbackContainer}>
                            <div className={styles.feedbackContent}>
                              <div className={styles.feedbackButtons}>
                                <span className={styles.feedbackQuestion}>Feedback?</span>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    handlePositiveFeedback(dokument.id);
                                  }}
                                  disabled={feedbackLoading.has(dokument.id)}
                                  className={`${styles.feedbackButton} ${styles.positive} ${feedbackStates[dokument.id] === 'positive' ? styles.feedbackButtonActive : ''}`}
                                  title="Positives Feedback geben"
                                >
                                  <HandThumbUpIcon className={styles.feedbackIcon} />
                                </button>
                                
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    toggleNegativeFeedback(dokument.id);
                                  }}
                                  disabled={feedbackLoading.has(dokument.id)}
                                  className={`${styles.feedbackButton} ${
                                    feedbackStates[dokument.id] === 'negative' 
                                      ? `${styles.feedbackButtonActive} ${styles.negative}` 
                                      : showNegativeFeedback.has(dokument.id) 
                                        ? styles.feedbackButtonExpanded 
                                        : ''
                                  }`}
                                  title="Negatives Feedback geben"
                                >
                                  <HandThumbDownIcon className={styles.feedbackIcon} />
                                </button>
                              </div>
                              
                              <div className={styles.metadataContainer}>
                                <div className={styles.metadataItem}>
                                  <span className={styles.metadataLabel}>Dokumentenstatus:</span>
                                  <span className={styles.metadataValue}>{dokument.dokument_status || '-'}</span>
                                </div>
                                <div className={styles.metadataItem}>
                                  <span className={styles.metadataLabel}>Verfahrensstatus:</span>
                                  <span className={styles.metadataValue}>{dokument.verfahren_status || '-'}</span>
                                </div>
                                <div className={styles.metadataItem}>
                                  <span className={styles.metadataLabel}>Erstellt:</span>
                                  <span className={styles.metadataValue}>{formatDateTime(dokument.extraction_timestamp)}</span>
                                </div>
                              </div>
                            </div>
                            
                            {showNegativeFeedback.has(dokument.id) && (
                              <div className={styles.negativeFeedbackForm}>
                                <textarea
                                  value={negativeFeedbackMessage[dokument.id] || ''}
                                  onChange={(e) => setNegativeFeedbackMessage(prev => ({
                                    ...prev,
                                    [dokument.id]: e.target.value
                                  }))}
                                  placeholder="Bitte beschreiben Sie, was verbessert werden könnte..."
                                  className={styles.feedbackTextarea}
                                  rows={3}
                                />
                                <div className={styles.feedbackFormActions}>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      handleNegativeFeedback(dokument.id);
                                    }}
                                    disabled={feedbackLoading.has(dokument.id) || !negativeFeedbackMessage[dokument.id]?.trim()}
                                    className={styles.submitFeedbackButton}
                                  >
                                    {feedbackLoading.has(dokument.id) ? 'Sende...' : 'Feedback senden'}
                                  </button>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      toggleNegativeFeedback(dokument.id);
                                    }}
                                    className={styles.cancelFeedbackButton}
                                  >
                                    Abbrechen
                                  </button>
                                </div>
                              </div>
                            )}
                          </div>
                        </td>
                      </tr>
                    </>
                  )}
                </React.Fragment>
              );
            })}
          </tbody>
        </table>
      </div>

      {renderPagination()}

      {refreshing && (
        <div className={styles.refreshingOverlay}>
          <div className={styles.refreshingSpinner} />
          <span>Aktualisiere...</span>
        </div>
      )}
    </div>
  );
};

export default DokumentPreviewTable;
</file>

<file path="src/lib/services/pflicht-service.ts">
import { DokumentPreviewSearchParams, DokumentPreviewResponse, SearchResultResponse } from '@/types/pflicht-preview';
import { Pflicht, Dokument } from '@/types/pflicht';
import { auth } from '@/lib/auth';

export async function deleteDokument(dokumentId: string): Promise<void> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const response = await fetch(`${baseUrl}/api/dokument/${dokumentId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
  });

  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
  }
}

export async function getDokumentPreviews(params: DokumentPreviewSearchParams = {}): Promise<DokumentPreviewResponse> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const searchParams = new URLSearchParams();

  if (params.pagination_offset !== undefined) searchParams.append('pagination_offset', params.pagination_offset.toString());
  if (params.pagination_size !== undefined) searchParams.append('pagination_size', params.pagination_size.toString());
  if (params.bereich) searchParams.append('bereich', params.bereich);
  if (params.gesetzeskuerzel) searchParams.append('gesetzeskuerzel', params.gesetzeskuerzel);
  if (params.gesetzgebung) searchParams.append('gesetzgebung', params.gesetzgebung);
  if (params.thema_search) searchParams.append('thema_search', params.thema_search);
  if (params.sort_by) searchParams.append('sort_by', params.sort_by);
  if (params.sort_order) searchParams.append('sort_order', params.sort_order);

  const requestUrl = `${baseUrl}/api/dokument/search?${searchParams.toString()}`;

  const response = await fetch(requestUrl, {
    method: 'GET',
    headers: {
      'accept': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
  });

  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  const result = await response.json();

  if (result.results && typeof result.total_count === 'number') {
    const backendResponse: SearchResultResponse = result;
    const pagination_size = params.pagination_size || 50;
    const pagination_offset = params.pagination_offset || 0;
    const page = Math.floor(pagination_offset / pagination_size) + 1;
    const totalPages = Math.ceil(backendResponse.total_count / pagination_size);

    return {
      data: backendResponse.results,
      total: backendResponse.total_count,
      page,
      limit: pagination_size,
      totalPages
    };
  } else {
    const pagination_size = params.pagination_size || 50;
    const pagination_offset = params.pagination_offset || 0;
    const page = Math.floor(pagination_offset / pagination_size) + 1;

    return {
      data: [],
      total: 0,
      page,
      limit: pagination_size,
      totalPages: 1
    };
  }
}

export async function getPflichtDetails(pflichtId: number): Promise<Pflicht> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const requestUrl = `${baseUrl}/api/pflicht/${pflichtId}`;

  const response = await fetch(requestUrl, {
    method: 'GET',
    headers: {
      'accept': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
  });

  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  return response.json();
}

export async function getDokumentDetails(dokumentId: string): Promise<Dokument> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const requestUrl = `${baseUrl}/api/dokument/${dokumentId}`;

  const response = await fetch(requestUrl, {
    method: 'GET',
    headers: {
      'accept': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
  });

  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  return response.json();
}

export async function updatePflicht(pflichtId: number, pflicht: Pflicht): Promise<Pflicht> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const requestUrl = `${baseUrl}/api/pflicht/${pflichtId}`;

  const response = await fetch(requestUrl, {
    method: 'PUT',
    headers: {
      'accept': 'application/json',
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
    body: JSON.stringify(pflicht),
  });

  if (!response.ok) {
    const errorText = await response.text();
    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  return response.json();
}

export async function createDokumentFromUrl(url: string): Promise<Dokument> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const requestUrl = `${baseUrl}/api/dokument?url=${encodeURIComponent(url)}`;

  const response = await fetch(requestUrl, {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
    cache: 'no-cache',
  });

  if (!response.ok) {
    const errorText = await response.text();

    if (response.status === 409) {
      throw new Error(`Zu dieser URL wurde bereits ein Dokument erstellt`);
    } else if (response.status === 400) {
      throw new Error(`Für diese URL kann kein Dokument erstellt werden`);
    } else if (response.status === 500) {
      throw new Error(`Ein unerwarteter Fehler ist aufgetreten`);
    }

    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  const result = await response.json();
  return result;
}

export async function deletePflicht(pflichtId: number): Promise<{ message: string }> {
  const token = await auth.currentUser?.getIdToken();
  const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL;

  const requestUrl = `${baseUrl}/api/pflicht/${pflichtId}`;

  const response = await fetch(requestUrl, {
    method: 'DELETE',
    headers: {
      'accept': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
    },
  });

  if (!response.ok) {
    const errorText = await response.text();

    if (response.status === 404) {
      throw new Error('Pflicht nicht gefunden');
    } else if (response.status === 400) {
      throw new Error(`Ungültige Anfrage: ${errorText}`);
    }

    throw new Error(`API Error: ${response.status} ${errorText}`);
  }

  return response.json();
}
</file>

<file path="src/app/[locale]/(main)/laws/page.tsx">
"use client";

import { useState } from 'react';
import { useDokumentPreviews } from '@/lib/hooks/useDokumentPreviews';
// Removed LawsSplitView and BereicheSidebar in favor of ResizableSplitView
import DokumentPreviewTable from '@/components/laws/DokumentPreviewTable';
import PflichtDetailView from '@/components/laws/PflichtDetailDialog';
import PflichtEditView from '@/components/laws/PflichtEditDialog';
import CreateDokumentModal from '@/components/laws/CreateDokumentModal';
import DokumentSummaryView from '@/components/laws/DokumentSummaryDialog';
import RightSidebar from '@/components/shared/RightSidebar';
import { useRightPanelStore } from '@/stores/rightPanelStore';
import { AgentStreamProvider } from '@/context/AgentStreamProvider';
import LawMonitorChatPanel from '@/components/laws/LawMonitorChatPanel';
import { deleteDokument } from '@/lib/services/pflicht-service';
import { Beleg } from '@/types/pflicht';
import ResizableSplitView from '@/components/ResizableSplitView';
import DetailPanel from '@/components/shared/DetailPanel';

export default function LawsPage() {
  const {
    loading,
    refreshing,
    dokumente,
    filterText,
    currentPage,
    totalPages,
    totalCount,
    itemsPerPage,
    setFilterText,
    goToPage,
    search,
  } = useDokumentPreviews();

  const [selectedPflichtId, setSelectedPflichtId] = useState<number | null>(null);
  const [selectedDokumentId, setSelectedDokumentId] = useState<string | null>(null);
  const [editingPflichtId, setEditingPflichtId] = useState<number | null>(null);
  const [showCreateDokumentModal, setShowCreateDokumentModal] = useState(false);
  const [sidebarContent, setSidebarContent] = useState<{ title: string; belege: Beleg[] } | null>(null);
  const [detailPanelTitle, setDetailPanelTitle] = useState('');

  const { isOpen, closePanel } = useRightPanelStore();



  const handleDokumentClick = (dokumentId: string) => {
    const doc = dokumente.find(d => d.id === dokumentId);
    setDetailPanelTitle(doc?.thema || 'Dokument Zusammenfassung');
    setSelectedDokumentId(dokumentId);
  };

  // Deprecated: handled by handleCloseDetailPanel

  const handlePflichtClick = (pflichtId: number) => {
    const pflicht = dokumente.flatMap(d => d.pflichten).find(p => p.id === pflichtId);
    setDetailPanelTitle(pflicht?.thema || 'Pflicht-Details');
    setSelectedPflichtId(pflichtId);
  };

  // Deprecated: handled by handleCloseDetailPanel


  const handleEditPflichtClick = () => {
    if (selectedPflichtId) {
      const pflicht = dokumente.flatMap(d => d.pflichten).find(p => p.id === selectedPflichtId);
      setDetailPanelTitle(`Bearbeite: ${pflicht?.thema}` || 'Pflicht bearbeiten');
      setEditingPflichtId(selectedPflichtId);
      setSelectedPflichtId(null);
    }
  };

  // Deprecated: handled by handleCloseDetailPanel

  const handleDeleteDokument = async (dokumentId: string) => {
    try {
      await deleteDokument(dokumentId);
      search(filterText);
    } catch (error) {
      console.error('Failed to delete dokument:', error);
      alert('Fehler beim Löschen des Dokuments. Bitte versuchen Sie es erneut.');
    }
  };

  const handlePflichtSaved = () => {
    setEditingPflichtId(null);
    search(filterText);
  };

  const handlePflichtDeleted = () => {
    search(filterText);
  };

  const handleCreateDokumentSuccess = () => {
    search(filterText);
  };

  const handleFilterChange = (text: string) => {
    setFilterText(text);
    search(text);
  };

  const handleShowBelege = (belege: Beleg[], pflichtThema: string) => {
    setSidebarContent({
      title: `Quellen für: "${pflichtThema}"`,
      belege: belege,
    });
  };

  const handleCloseBelegeSidebar = () => {
    setSidebarContent(null);
  };

  if (loading && dokumente.length === 0 && !refreshing) {
    return <div>Lade Dokumente...</div>;
  }
  
  const handleCloseDetailPanel = () => {
    setSelectedPflichtId(null);
    setEditingPflichtId(null);
    setSelectedDokumentId(null);
    setDetailPanelTitle('');
  };

  const mainContent = (
    <div style={{ position: 'relative', height: '100%', overflow: 'hidden' }}>
      <div style={{ padding: '2rem', height: '100%', overflowY: 'auto' }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
        <h1>Dokumente</h1>
        <div style={{ display: 'flex', gap: '0.5rem' }}>
          <button
            onClick={() => {
              // Open chat panel without specific context; Pflicht dialog provides precise context
              useRightPanelStore.getState().openPanel({});
            }}
            className="inline-flex items-center rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50"
            title="Law Monitor Chat öffnen"
          >
            Law Monitor Chat
          </button>
        </div>
      </div>
        <p style={{ marginBottom: '2rem', color: '#666' }}>Alle Dokumente anzeigen</p>

        <DokumentPreviewTable
        dokumente={dokumente}
        filterText={filterText}
        onFilterChange={handleFilterChange}
        onSelectDokument={handleDokumentClick}
        onSelectPflicht={handlePflichtClick}
        onAddNew={() => setShowCreateDokumentModal(true)}
        onDeleteDokument={handleDeleteDokument}
        onDeletePflicht={handlePflichtDeleted}
        currentPage={currentPage}
        totalPages={totalPages}
        totalCount={totalCount}
        itemsPerPage={itemsPerPage}
        onPageChange={goToPage}
        refreshing={refreshing}
        />
      </div>

      <DetailPanel
        isOpen={!!selectedPflichtId || !!editingPflichtId || !!selectedDokumentId}
        onClose={handleCloseDetailPanel}
        title={detailPanelTitle}
      >
        {selectedPflichtId && (
          <PflichtDetailView
            pflichtId={selectedPflichtId}
            onClose={handleCloseDetailPanel}
            onEdit={handleEditPflichtClick}
            onShowBelege={handleShowBelege}
          />
        )}
        {editingPflichtId && (
          <PflichtEditView
            pflichtId={editingPflichtId}
            onClose={handleCloseDetailPanel}
            onSave={handlePflichtSaved}
          />
        )}
        {selectedDokumentId && (
          <DokumentSummaryView dokumentId={selectedDokumentId} />
        )}
      </DetailPanel>
    </div>
  );

  const sidePanelContent = (
    <AgentStreamProvider>
      <LawMonitorChatPanel />
    </AgentStreamProvider>
  );

  return (
    <div style={{ height: 'calc(100vh - 5rem)', display: 'flex', flexDirection: 'column' }}>
      <ResizableSplitView
        mainContent={mainContent}
        sidePanelContent={sidePanelContent}
        isSidePanelOpen={isOpen}
        onSidePanelClose={closePanel}
      />

      {showCreateDokumentModal && (
        <CreateDokumentModal
          isOpen={showCreateDokumentModal}
          onClose={() => setShowCreateDokumentModal(false)}
          onSuccess={handleCreateDokumentSuccess}
        />
      )}

      <RightSidebar
        isOpen={!!sidebarContent}
        onClose={handleCloseBelegeSidebar}
        title={sidebarContent?.title || ''}
      >
        {sidebarContent?.belege.map((beleg, index) => (
          <div key={index} style={{ marginBottom: '1.5rem' }}>
            <h4 style={{ fontWeight: 600, color: '#374151', marginBottom: '0.5rem' }}>
              {beleg.anker || beleg.quelle}
            </h4>
            <p style={{ color: '#4b5563', lineHeight: 1.6, margin: 0, whiteSpace: 'pre-wrap' }}>
              {beleg.textauszug || beleg.text}
            </p>
          </div>
        ))}
      </RightSidebar>

    </div>
  );
}
</file>

</files>
